<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Xataface: Adding Custom Javascripts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xataface-logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xataface
   &#160;<span id="projectnumber">2.0alpha2</span>
   </div>
   <div id="projectbrief">Xataface Application Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Adding Custom Javascripts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>Return to <a class="el" href="module_developer_guide.html">Module Developer's Guide</a></li>
<li>Previous: <a class="el" href="module_developer_guide_actions.html">Creating a Module With an Action</a></li>
<li>Next: <a class="el" href="module_developer_guide_css.html">Adding Custom CSS Files</a></li>
</ul>
<p>As of Xataface 2.0, there is a much greater emphasis on Web 2.0 and Javascript. The <a class="el" href="class_dataface___javascript_tool.html">Dataface_JavascriptTool</a> now allows you to build complex javascript applications with dependencies and have them compiled (and cached) at run-time. You can develop your own Javascript libraries and include them with your module easily. This tutorial describes how to bundle your javascripts, and how to make them available to your actions (and other actions too if you so desire).</p>
<h1><a class="anchor" id="module_developer_guide_dataface_javascripttool"></a>
Dataface_JavascriptTool Primer</h1>
<p>The <a class="el" href="class_dataface___javascript_tool.html">Dataface_JavascriptTool</a> class provides all of the functionality necessary to build javascript applications. We are going to make use of 3 main methods of this class for this tutorial:</p>
<ol type="1">
<li><a class="el" href="class_dataface___javascript_tool.html#a8bc471b19f24aea65a4b5c1466c81937">Dataface_JavascriptTool::getInstance()</a> - To obtain a reference to the request's JavascriptTool object.</li>
<li><a class="el" href="class_dataface___javascript_tool.html#a28f130070d771ecaccdbfcbd846db44e">Dataface_JavascriptTool::addPath()</a> - To register our module's <code>js</code> directory as a location where Javascript files can be found.</li>
<li><a class="el" href="class_dataface___javascript_tool.html#a8e54c10e39f413e6623e7f56a2e4f166">Dataface_JavascriptTool::import()</a> - To load a particular javascript file with the functionality that we want to use for our action.</li>
</ol>
<h1><a class="anchor" id="module_developer_guide_javascript_goal"></a>
Goal for This Tutorial</h1>
<p>In this tutorial we are going to use Javascript to turn our "Hello World" action into a more interactive action where the user can type in their own name and have the text changed to "Hello &amp;lt;Their Name&amp;gt;" depending on what they enter into the text field.</p>
<dl class="section user"><dt>Step 1 Modifying the Template</dt><dd></dd></dl>
<p>First let's modify our template to prepare for interactivity. We need to do two things:</p>
<ol type="1">
<li>Add a <code>span</code> tag to the heading so that we can reference and change the "Hello World" text more easily.</li>
<li>Add a text field for the user to enter their name</li>
</ol>
<p>The resulting template now looks like: </p>
<div class="fragment"><div class="line">{use_macro file=<span class="stringliteral">&quot;Dataface_Main_Template.html&quot;</span>}</div>
<div class="line">    {fill_slot name=<span class="stringliteral">&quot;main_section&quot;</span>}</div>
<div class="line">        </div>
<div class="line">        &lt;h1&gt;Hello &lt;span <span class="keywordtype">id</span>=<span class="stringliteral">&quot;user-name&quot;</span>&gt;world&lt;/a&gt;&lt;/h1&gt;</div>
<div class="line">        </div>
<div class="line">        &lt;p&gt;</div>
<div class="line">            Please enter your name </div>
<div class="line">            &lt;input type=<span class="stringliteral">&quot;text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;user-name-field&quot;</span>/&gt;</div>
<div class="line">            &lt;button <span class="keywordtype">id</span>=<span class="stringliteral">&quot;update-user-name-btn&quot;</span>&gt;Update&lt;/button&gt;</div>
<div class="line">        &lt;/p&gt;</div>
<div class="line">    </div>
<div class="line">    {/fill_slot}</div>
<div class="line">{/use_macro}</div>
</div><!-- fragment --><p>Notice that we referenced the <code>span</code>, <code>input</code>, and <code>button</code> tags with <code>id</code> attributes so that they are easy to reference from Javascript.</p>
<dl class="section user"><dt>Step 2 Create a Directory For Javascripts</dt><dd></dd></dl>
<p>We're going to store all of our javascript files inside a directory named <code>js</code> inside our module's directory. I.e. </p>
<div class="fragment"><div class="line">modules/hello_world/js</div>
</div><!-- fragment --><p>Further, we're going to follow the best practice of creating a sort of namespace for our scripts (just like we did with our templates from the previous section) so that we don't conflict with the script locations in other modules or Xataface itself. Hence underneath our <code>js</code> directory we're going to create a directory: <code>xataface/modules/hello_world</code> and place our javascript file inside that. I.e. the full path within our module's directory to our javascript file will be: </p>
<div class="fragment"><div class="line">js/xataface/modules/hello_world/hello_world.js</div>
</div><!-- fragment --><dl class="section user"><dt>Step 3 Create the Javascript File</dt><dd></dd></dl>
<p>Inside the hello_world.js file add the following: </p>
<div class="fragment"><div class="line"><span class="comment">//require &lt;jquery.packed.js&gt;</span></div>
<div class="line">(<span class="keyword">function</span>(){</div>
<div class="line">        </div>
<div class="line">        var $ = jQuery;</div>
<div class="line">        $(document).ready(<span class="keyword">function</span>(){</div>
<div class="line">        </div>
<div class="line">                $(<span class="stringliteral">&#39;#update-user-name-btn&#39;</span>).click(<span class="keyword">function</span>(){</div>
<div class="line">                    <span class="comment">// On click handler for the button with id update-user-name-btn</span></div>
<div class="line">                    </div>
<div class="line">                    <span class="comment">// Take the value of the user-name-field and place it in the </span></div>
<div class="line">                    <span class="comment">// user-name span:</span></div>
<div class="line">                    $(<span class="stringliteral">&#39;#user-name&#39;</span>).text($(<span class="stringliteral">&#39;#user-name-field&#39;</span>).val());</div>
<div class="line">                        </div>
<div class="line">                });</div>
<div class="line">        });</div>
<div class="line"></div>
<div class="line">})();</div>
</div><!-- fragment --><p>Now there are a few things to notice about this Javascript segment:</p>
<ol type="1">
<li>The first line is a declaration that it requires the file <code>jquery.packed.js</code> . This declaration is handled by the <a class="el" href="class_dataface___javascript_tool.html">Dataface_JavascriptTool</a> at runtime to ensure that the jquery.packed.js file has been loaded. This ensures that jQuery is available to use in this file. The jquery.packed.js is located in the xataface/js directory which is automatically and always included in the Javascript Tool's list of javascript paths so that you can always reference files from it.</li>
<li>The enter contents of this file (except the <code>require</code> statement) is wrapped in a <code>function</code> structure. This is a javascript technique for makeing namespaces so that variables that we create inside this file do not pollute the global namespace. See <a href="http://stackoverflow.com/questions/1841916/how-to-avoid-global-variables-in-javascript">This thread</a> for more information about this technique. It is best practice to always use this technique in your own javascript files to make the source base more manageable.</li>
<li>We listen for the <code>click()</code> event on the <code>update-user-name-btn</code> <code>button</code> and then change the "world" text to whatever text is entered into the text field.</li>
</ol>
<dl class="section user"><dt>Step 4 Load the Javascript File</dt><dd></dd></dl>
<p>Now that you have created your javascript file, let's modify the <code>hello_world</code> action to use this javascript file.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>actions_hello_world {</div>
<div class="line"></div>
<div class="line">        <span class="keyword">function</span> handle($params){</div>
<div class="line">        </div>
<div class="line">                $javascriptTool = <a class="code" href="class_dataface___javascript_tool.html#a8bc471b19f24aea65a4b5c1466c81937">Dataface_JavascriptTool::getInstance</a>();</div>
<div class="line">                $javascriptTool-&gt;addPath(</div>
<div class="line">                        dirname(__FILE__).<span class="stringliteral">&#39;/../js&#39;</span>,  <span class="comment">// The Path to the js dir</span></div>
<div class="line">                        DATAFACE_SITE_URL.<span class="stringliteral">&#39;/modules/hello_world/js&#39;</span>   <span class="comment">// The URL to the js dir</span></div>
<div class="line">                );</div>
<div class="line">                $javascriptTool-&gt;import(<span class="stringliteral">&#39;xataface/modules/hello_world/hello_world.js&#39;</span>);</div>
<div class="line">                </div>
<div class="line">                </div>
<div class="line">                <span class="comment">// Rest of the file is unchanged</span></div>
<div class="line">                df_register_skin(<span class="stringliteral">&#39;hello world skin&#39;</span>, dirname(__FILE__).<span class="stringliteral">&#39;/../templates&#39;</span>);</div>
<div class="line">                df_display(</div>
<div class="line">                    array(),</div>
<div class="line">                    <span class="stringliteral">&#39;xataface/modules/hello_world/hello_world_template.html&#39;</span></div>
<div class="line">                );</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The only change that we made was to register our <code>js</code> directory with the Javascript Tool so that it knows to look there for Javascript files. Next we just import our hello_world.js file so that it will be executed on page load.</p>
<dl class="section user"><dt>Step 5 Try the Action Again</dt><dd></dd></dl>
<p>At this point we're ready to try out our action. Just point the browser to your hello_world action again (e.g. <code>index.php</code>?-action=hello_world</p>
<div class="image">
<img src="http://media.weblite.ca/files/photos/Screen_shot_2011-11-28_at_3.02.30_PM.png?max_width=640" />
</div>
<h1><a class="anchor" id="module_developer_guide_javascript_troubleshooting"></a>
Troubleshooting</h1>
<p>Shifting from a PHP-centric application to a javascript-centric application can present a bit of a learning curve while you get used to the new environment. Sometimes debugging Javascript can get a little tricky. The trick is to use the right tools and know where to look. If you are debugging your application or developing it, the first thing you should do is turn on debugging in the Dataface_Javscript tool. You can do this by adding the following section to your application's conf.ini file:</p>
<div class="fragment"><div class="line">[<a class="code" href="class_dataface___javascript_tool.html" title="A Class that manages, builds, and maintains dependencies of javacripts.">Dataface_JavascriptTool</a>]</div>
<div class="line">        debug=1</div>
</div><!-- fragment --><p>This will prevent the Javascript Tool from minimizing the code. It will also turn off the cache. Once you have finished debugging you should remove this directive again (or comment it out) as it will cause performance to be much slower.</p>
<p>Once you have enabled debugging, the next step is to use your preferred Javascript debugging tool to debug your application. I generally just use <a href="http://www.apple.com/safari/features.html#developer">Safari with the Develop menu enabled</a>, but most of the modern browsers now include some mechanism to debug javascript.</p>
<ul>
<li>Return to <a class="el" href="module_developer_guide.html">Module Developer's Guide</a></li>
<li>Previous: <a class="el" href="module_developer_guide_actions.html">Creating a Module With an Action</a></li>
<li>Next: <a class="el" href="module_developer_guide_css.html">Adding Custom CSS Files</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2013 09:40:35 for Xataface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
