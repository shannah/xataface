Index: DB/Sync.php
===================================================================
--- DB/Sync.php	(revision 4694)
+++ DB/Sync.php	(working copy)
@@ -248,4 +248,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: changes.txt
===================================================================
--- changes.txt	(revision 4694)
+++ changes.txt	(working copy)
@@ -1,1064 +1,11 @@
-Xataface 2.0.0 4582
-May 13, 2013
-
-    - Fixed bug in creation of modification times table - empty query.
-    - Added class to related result stats to make it easier for javascript to determine 
-        if a result controller is for a related set of the whole result set.
-    - Improved lookup widget so that it only queries the server for the latest change to 
-        the filter.  It used to make an ajax request after each letter, but in slower 
-        servers this would cause all kinds of problems.  Now it waits 500ms before 
-        sending the ajax request to ensure that the user is finished typing.
-    - Fixed issue with saving forms with tabs described at 
-        http://xataface.com/forum/?place=msg%2Fxataface%2F783PPFvWTp8%2FIPhoNTO2GWcJ
-    - Fixed warning PHP Strict Standards:  Only variables should be assigned by reference 
-        in Dataface/Relationship.php on line 1312
-    - Forced lookup widget icon images to be displayed inline.
-    - Added actionPerformed action to the ListView that is fired when a user clicks on a 
-        row of the list view.  It passes both the view and model as part of the event data.
-    - Fixed fatal error when copy selected related records.
-    - Fixed pass by reference warning in Dataface/RelatedRecord.php class.
-    - Fixed Javascript ListView so that it retains selections on update now.
-    - Fixed bug with data-kvc dot notation in the xataface.model.Model javascript class.
-    - Added parameter to the Dataface_IO::write() method to force inserting a new record. 
-         This is to fix an issue with the new record form overwriting an existing record 
-         if the keys match.
-    - Added override to fix bug related to related lists whereby fields that have the 
-        same name as a field in the source table are hidden by default.  This is still 
-        the default, but now it can be overridden by adding visibility:colname=visible 
-        to the relationships.ini file definition.
-    - Updated doc directory to be more self contained.
-    - Fixed longstanding bug with the activate action if the user was registering from a 
-        URL that didn't have a ? in it, it would redirect to an invalid page because it 
-        would form the url with a & instead of ?.
-    - Changed list view to show only 50 characters by default in the cell of a list view.  
-    Added support for list:maxcols directive in the fields.ini file to override this
-     number on a field to field basis.  Added data-fulltext attribute to the span tag to 
-     store the full text (well only the first 255 characters) so that javascript can be 
-     used to show the full text on request.  In a separate commit, the g2 theme has been
-      modified to take advantage of this - adding a 'show more' button on fields that 
-      have been truncated.
-    - Fixed export_json action so that field-level permissions are properly handled now.
-    - Added documentation for the css__tableHeaderCellClass() and css__tableRowClass() 
-        delegate class methods.
-    - Added support for css__tableHeaderCellClass() delegate class method to provide 
-        custom css class for a table header cell.
-    - Fixed internationalization of copy_replace action.  Numbers were incorrectly 
-        included with sprintf().
-    - Fixed attempt to use dataface__record_mtimes without first creating the 
-        record_mtimes table.
-    - Internationalized strings in copy_replace action.  Updated translations to 
-        latest from translations spreadsheet.  This includes new languages ca and nl.
-    - Fixed security issue that caused columns in json_export to be included even if 
-        they have been disabled by field security
-    - Fixed bug in multilingual databases with many-to-many relationships.
-    - Added a commit action for comitting changes to multiple records.
-    - Added initial support for record versioning.  You need to specify the field that is 
-        to store the record versions in the fields.ini file via the version=1 directive.  
-        Then if you try to save a record but the database version isn't the same, it 
-        will fail with a version error.
-    - Added the whoami action that allows webservices to ping the app to see if they are 
-        logged in.  Also added support for the --no-prompt parameter that prevents 
-        redirection to the login form.  Instead it will just issue a 401 HTTP response 
-        code to indicate that the user should log in.
-    - Added support for failedLogin trigger.
-    - Fixed PHP warning filemtime() stat failed in JavascriptTool
-    - Fixed typo from  change in Relationship introduced from previous update.
-    - Added support for ListModel.getQuery()
-    - Changed relationships to truncate text fields in the query.  Added relationships.ini
-         file directive: field:fieldname:max_length=1024  to set max length of field in the 
-         query.  It also respects the struct directive of the target table.
-    - Fixed warnings in php 5.4
-    - Handle empty cookie path
-    - Updated Document.js to work with the export_json action.
-    - Added support for --single parameter in export_json to return data as a single 
-        object instead of as an array of records.
-    - Added better compatibility with the export_json action in ResultSet js class.
-     - Added support for --var parameter in the export_json action that essentially 
-        causes the response to be wrapped in an object and the key specified by query[--var] 
-        contains the rows of the response.
-    - Set time limit to 0 in export csv
-    - Removed ob_gzhandler due to PHP bug 55544
-    - Fixed to handle empty date fields properly
-    - Small fix to calendar.php so that it will work on forms where the field name differs
-     from the table's field name.
-    - Added improved support for the widget:ifFormat directive on the calendar widget.  
-        Now it explicitly parses the value when putting value into the calendar widget and 
-        converts it back with pushing value to the model.
-        http://xataface.com/forum/viewtopic.php?f=4&t=5345
-    - Fixed php warning PHP Notice:  Array to string conversion in 
-        lib/jscalendar/calendar.php on line 103
-    - Fixed parse error with date widget. PHP Parse error:  syntax error, unexpected 
-        '(', expecting ')' in lib/HTML/QuickForm/date.php on line 77
-        http://bugs.weblite.ca/view.php?id=1169
-
-Xataface 1.3rc4 2458
-July 20, 2011
-
-	- Turned off indexing on tables that don't have the index enabled.
-	- Added support for timediff MySQL function.  Added tests also.
-	- Changed so that session timeout refers to logout after inactivity rather 
-	  than logout after time after session created.
-	- Changed session_timeout to an integer just in case this was causing problems before.
-	- Removed some bits that draw strict warnings in PHP 5.3
-	- Fixed bug that was caused by allowing actions to override the relationships.ini file 
-	  action definitions.  The problem was that all related actions were being overridden by 
-	  relationships.ini action definitions.  The fix was to add a directive for the 
-	  actions.ini file to explicitly set an action as overridable by the relationships.ini file.
-	- The related_records_list action has been given the directive:
-		allow_override=relationships.ini
-	  which says that any settings placed in the relationships.ini action: definition 
-	  will override details of this action.
-	- Added support for disable_session_ip_check in conf.ini file.
-	- Fixed updating but with multiple dataface__version records being added
-	- Changed errors when inserting new related record of type foreign key constraint 
-	  failures to be a notice instead of a fatal error so it will give the user a 
-	  friendlier error message.
-	- Changed session to just log the user out if their session has the wrong session id.
-	- Removed 'here' debugging text that shouldn't have been there in main template.
-	- Fixed error with overriding PEAR::raiseError (a static method) with a non-static 
-	  method.  Now XML_Parser::raiseError is static.
-	- Improved relationship labeling on find form
-	- Added support for visibility:find in relationships to hide a relationship from 
-	  the find form.
-	
-
-
-
-
-Xataface 1.3rc3 2167
-April 13, 2011
-
-	- Changed search results to show portions of page that match query
-	- Increased time limit on manage_build_index to unlimited - and closed session at 
-	  beginning of action to prevent user from being locked out.
-	- Fixed up the pluggable architecture for searches.
-	- Added IP address check in the session to prevent people from spoofing sessions
-	- Fixed search index to index entire record contents instead of just previews.
-	- Added optimize table command when building index.
-	- Improved site search options by making it so that you no longer need to have 2 types of 
-	  find_actions in order for the site search to work.  Also removed the 'filter by' option at 
-	  the top of the search results if there is only one type of record in the found set.
-	- Fixed error in IE when clicking '+' sign next to record in list view - undefined variable 
-	  df_add_editable_awareness
-
-Xataface 1.3rc2 2139
-April 9, 2011
-
-	- Fixed serious issue with outputcache that caused users to be able to log in as other users.  
-	  If using output caching you MUST update.
-	- Fixed issue with output cache - warnings on HTTP_IF_NONE_MATCH
-	- Added support for passwordTwice css class that can be applied to a password field to make 
-		users enter the password twice - and forces it to match in order to submit the form.
-	- Added clear_views action and permission to control panel
-	- Added change_password action to actions.ini file so it will show up next to My Profile in the 
-	  UI
-	- Added setPassword method to the authentication tool.  This is used by the change password 
-	  function... Adding this to the authentication tool allows us to tie the functionality to the 
-	  authentication plugin which is the way it should be.
-	- REmoved debugging code from config.inc.php
-	- Fixed issue on 5.3 with output cache... a warning about missing key.
-	- Fixed issue with function options containing arithmetic expressions.
-	- Added support for literals and string arithmetic in the SQL parser.  This has been badly 
-	  needed for a long time.   Still may be lacking support in where clause or function parameters.
-
-Xataface 1.3rc1 2092
-March 31, 2011
-
-	-Fixed path separators and directory separators to be platform independent in installer.
-	-Fixed notice of undefined variable in PHP 5.3.5
-	-Added support for the getNavItem and isNavItemSelected delegate class methods to provide more 
-	 flexibility for the navigation menus.  Now the navigation menu can contain more than just 
-	 tables.
-	-Fixed E_STRICT warning messages (PHP 5.3)
-	-Added support for the --no-query request parameter which prevents the application from 
-	 loading the record set matching the query.  If this parameter is set, then the
-	 Dataface_Application::getRecord() method will return null and the 
-	 Dataface_Application::getResultSet() will return an empty result set.  Similarly the 
-	 Dataface_QueryTool::loadResult() method will return an empty result set if passed the 
-	 --no-query parameter as part of the query in its third parameter.   THis is part of the 
-	 solution to the problem reported at http://xataface.com/forum/viewtopic.php?f=4&t=5983.
-	-Fixed issue with record dialog when adding new records... javascript was being run twice.  
-	 Now it is not
-	-Added user feedback of which column the result set is currently sorted on
-	-Added fix for windows cached file names in getBlob action.
-	 http://www.xataface.com/forum/viewtopic.php?f=4&t=4149
-	-Added support saveMessage() and @@ message notation.  This allows you to pass the 
-	 --msg parameter in the session instead of through the GET url.  You would then use 
-	 the --msg=@@ to indicate that the ['--msg'] property should be used for the message
-	-Added support for the beforeCopy() and afterCopy() triggers
-	-Added some css classes to items in login prompt
-	-Added username to the default reset password email so that the user knows which username's 
-	 password is to be reset
-	-Fixed Calendar positioning problem in IE.  Still needs some more testing but appears to work 
-	 in IE 6 and IE 8.
-	-Added permission 'clear views' specifically for the clear views action.  By default no role 
-	 has access to this.  So only if users with ALL() permission can use the clear views action
-	-Added action to clear the xataface auto-generated views.  This is necessary often when the 
-	 database is modified (in structure only).
-	-Added support for visibility:update directive which allows you to hide fields from the update 
-	 form
-	-Added new blocks before_login_username, after_login_username, after_login_password, and 
-	 after_login_submit on the Dataface_Login_Prompt.html template.  This allows us to add some custom content in those places of the login form.
-	-Fixed style for column-legend so it doesn't overflow
-	-Fixed support for column:label directive.  Added support for column:legend directive to add 
-	 legend for columns in result list and related list
-	-Added support for column:label directive in related list (was already supported in regular list)
-	-Fixed intermittent problem with parse_repeated in case it is called with a blank delimiter.
-	-Fixed strict warning on line 41 of ModuleTool
-	-Added check to ensure that application has a templates_c directory that is writable by the web 
-	 server --- new restriction for 1.3
-	-Fixed installer to use replace instead of update so that first time update works properly
-	-Removed plone_javascript_variables.js.php and plone menu javascript... these aren't used at all so it just added to bloat
-	-Updated getProxyView to work with tables that aren't set up for multilingual content even if 
-	 app is set to use multilingual content.  Proxy views dramatically improve performance when 
-	 tables define the __sql__ directive in the fields.ini file.
-	-Changed url of the Xataface forum to the current address.. This just popped up on some error screens
-	-Fixed a number of E_STRICT warnings.  Refactored LanguageTool and PermissionsTool so that all 
-	 methods can be called either statically or as member methods... Had to create second classes 
-	 for both of these so that getInstance() returns instance of the alternative class... and all 
-	 methods are declared static on the existing class.  This will best maintain compatibility with 
-	 existing source code.  Also fixed a number of assign by reference warnings.  Tested small set 
-	 of main actions in strict mode.  Still much work to be done
-	-Updated ConfigTool and Application to support modules placed in the DATAFACE_SITE_PATH/modules 
-	 directory instead of the DATAFACE_PATH/modules directory.
-	-Updated translations with latest from the translation spreadsheet
-	-Added spanish language file... it is way out of date (circa 2007) but at least it's a start
-
-
-Xataface 1.2.7 1966
-November 29, 2010
-
-	-Added forgot password action... not tied into interface yet but is functional.  
-	-Added getEmailColumn() method to AuthenticationTool.
-	-Added support for show_jump_menu preference
-	-Fixed issue that caused some errors not to display on registration form.  Added improved support for validateRegistrationForm delegate class method so that it is used in both the activate and register method.. and returning a value of 2 (int) indicates that not only did the registration data validate ok, it instructs Xataface to skip the rest of the default validation.  This is helpful if the validation for unique usernames doesn't work with the application's constrains for some reason (e.g. multi-column unique key for users)
-	-Fixed possible XSS script vulnerability with --msg parameter
-	-Updated related record tabs to respect the 'view related records' permission.
-
-
-Xataface 1.2.6 1955
-October 25, 2010
-
-	-Added check that delegate contains the filterPermissions method.  Responding to http://xataface.com/forum/viewtopic.php?f=4&t=5553
-	-Added error codes for withstanding foreign key constraint failures when adding new related records.  See http://xataface.com/forum/viewtopic.php?f=4&t=5530
-	-Updated XML output to support calculated fields on related records.
-	-Fixed xmlTail delegate method support
-	-Added date and time functions to mysql dialect for SQL parser.
-	-Added preferences options to hide related sections in view tab, and record search in view tab
-	-Fixed incorrect icons on some actions: http://xataface.com/forum/viewtopic.php?f=4&t=5507
-	-Fixed bug with container field field names on windows: http://xataface.com/forum/viewtopic.php?f=3&t=5465
-	-Fixed finfo_file() call:  http://xataface.com/forum/viewtopic.php?f=3&t=5492
-	-Changed sql parser to default to MySQL dialect.  This fixes issue in Relationship where parser was running in ansi mode
-	-Added support for external translation management systems by adding an 'External' translation status
-	-Added support for xmlTail delegate method, and xml attribute in fields.ini file to use calculated fields as part of xml dump
-	-Throws exception in relationship init() method now if there is a failure.  This exception is used to catch errors in select widget when trying to make it editable.
-	-Fixed 'otice: Undefined index: auth_type in D:\wamp\www\imm\dataface\Dataface\AuthenticationTool.php on line 84'
-	-Fixed 'Notice: Use of undefined constant key - assumed 'key' in /xataface/Dataface/SearchForm.php on line 347'
-	-Added XATAFACE_DISABLE_PROXY_VIEWS option
-	-Added test for problematic query.  Seems to be working ok.
-	-Disabled proxy views when multilingual content is enabled.  Since the view has a different name than the source table it is unable to be translated by the Query Translator.  This effectively fixes multilingual content translation when grafted fields are used in a table (e.g. __sql__='...')
-	-Fixed so that relationships derived from valuelists do not show up as actions/tabs
-	-Fixed add to select function to correct IE compatibility problems
-	-Added the ability to add new records to valuelists for select widgets inline... but only if the valuelist uses __sql__ to pull its values from the database.
-	-Added the ability to add new records to checkbox groups that are built on a relationship.  Utilizes the RecordDialog widget previously developed for the lookup widget.  Similar things should soon be created for all widgets that use valuelists or relationships.
-	-Forgot to commit update for register action to support the register permission instead of the new permission.
-	-Added check to make sure that a relationship exists in the getField() method.  This will propagate errors up another level so that they make more sense
-	-Fixed getTitles() bug ... it loaded all of the records into memory for the jump menu.. 
-
-
-Xataface 1.2.5 1870
-June 18, 2010
-
-	-Fixed metadata not being updated when saving related record.  Thanks to fantomasdm.
-	-Fixed notice at line 62 of delete_file action that caused a notice when deleting an attachment from a table where there is no mimetype field associated with the container
-	-Fixed XSS scripting vulnerability in search and full-path disclosure
-	-Fixed warning about undefined variable  on line 2046 of Table.php
-	-Added logger class to log notices and error messages
-	-Fixed PermissionsTool delegate to only contain the filterPermissions(&, &) method.  This can be used to filter the permissions on a temporary basis.  In particular it is usedby the register action right now to convert the register permission to the new permission.
-	-Added ajax_record_details, before_ajax_record_details, and after_ajax_record_details slots to the Dataface_AjaxRecordDetails.html template
-	-Added val() method as shortcut to getValue()
-	-Fixed php notice if filter is not set
-	-Fixed issue with blank queries being kept in the query.
-	-Added {filters} tag to templates to show result filters
-	-Fixed broken tags in registration template introduced by last commit
-	-Added heading to registration form and slot to override this header: registration_form_label
-	-Added Dataface_Registration.label string which is used for heading of the registration form
-	-Fixed register action to use the register permission instead of the new permission.
-	-Added support for a permissions tool delegate if you need to slightly modify how permissions are handled temporarily
-	-Added support for before_authenticate trigger in application delegate class
-	-Added support for startSession method in application delegate class
-	-Fixed 'Notice: Undefined variable: HTTP_SESSION_VARS' on line 78 of config.inc.php
-
-
-
-Xataface 1.2.4 1811
-May 13, 2010
-
-	- Updated strings to use Xataface instead of Dataface
-	- Updated fineprint finally to show 2010 and Xataface instead of Dataface
-	- Fixed toJS() method to use json_encode() instead of adhoc formation that sometimes failed for complex content
-	- Added xhtml editing and remove formatting buttons to nicEdit
-	- Fixed issue with Calendar not showing correct start times for events.
-	- Fixed issue with grafted fields overriding the field definition of already existent fields.  This would cause problems for the new related record form and possibly elsewhere (http://xataface.com/forum/viewtopic.php?f=4&t=5154)
-	- Fixed view tab bug where nothing appears if first field is part of a field group. http://xataface.com/forum/viewtopic.php?f=4&t=5168
-	- Fixed unquoted string in preg_grep (line 874 error)
-	- Default display expanded now for field groups in find form.  I'm not sure how these ever was set to default collapsed.
-	- Fixed issue with updating fields with the value 0.  Used to ignore these updates, confusing it with a blank update.
-	- Added support for getTemplateContext() delegate method
-	- If parser fails caching is aborted
-	- Fixed redirect after adding new record to go to view tab if the user doesn't have the edit permission for the record.
-	- Added after_action_activate event.
-	- fixed path of query_cache_log
-	- Added preliminary support for duplicate column names in relationships.
-
-	- Fixed error checking if unquoted string is defined.
-
-
-	- Made a whole host of changes to try to support PHP 5.3.  In particular I created a special implementation of parse_ini_file to run for PHP 5.3.0 and 5.3.1 to work around bugs in their implementation (these bugs are reportedly fixed in SVN and thus should be part of 5.3.2, but this is a stop-gap measure. Other changes include removing =& notation for new objects (as this is deprecated), and removal of all ereg() calls where I could find them (also deprecated). 
-	- All ereg calls were changed to preg_match calls.
-	- Removed explicit error reporting call.
-	- Added headings to CSV export when no relationship is present.  For consistency.
-	- Set constant when stripping slashes for magic_quotes_gpc so that future attempts can be cancelled based on it already occuring (e.g. HTML_QuickForm).
-	- Disabled strip slashes in QuickForm if they've already been stripped in config.inc.php.
-	- Fixed slashes when magic_quotes_gpc is enabled.  This was causing all kinds of problems with ajax methods like the datagrid.
-	- Fixed related record form so that grafted fields only show up if they are marked as transient.
-	- Added support for secure flag on container fields to use the get_blob method so that it respects application permissions.  Note that it is necessary to secure the directory that stores the file uploads manually to prevent unauthorized downloads.
-	- Updated skintool to support application delegate breadcrumbs method.
-	- Removed short open tags so it should now be compatible if short open tags are turned off.
-	- Changed single_record_search to respect the 'view' and 'view in rss' permissions.
-	- Added support for getSingleRecordSearchFeed delegate class method to customize the single record search feed.  Works identical to the getFeed() method except that it also takes a Dataface_Record as the first parameter.
-
-
-Xataface 1.2.3b1 1690
-Jan. 5, 2010
-	-Changed to make compatible with PHP 5.3.
-  	- Included workaround for parse_ini_file bugs until they're fixed in
-  	  PHP
-	-Removed/replaced constructs and functtions that caused deprecation
-warnings.
-
-Xataface 1.2.2 1616
-Oct. 25, 2009
-
-	-Bug fixes for query caching.
-	-Fixed bug with lookup widget getting stuck after insert new record.
-	-Added floating menu support to nicEdit
-	
-Xataface 1.2.1 1472
-Sept. 25, 2009
-	- Fixed javascript bug that prevented history tool from working properly.
-
-Xataface 1.1.5 978
-Feb. 16, 2009
-	- added delete_delete selected action to allow users to delete records by selecting
-	  them in list view.
-	- added "delete selected" permission to allow/deny access to delete_selected action
-	- df_init() now returns reference to Dataface_Application object.
-	- delete_found action now requires delete found permission instead of delete permission.
-	- implemented Dataface_Record::delete() method.
-	
-Xataface 1.1.4 971
-Feb. 11, 2009
-	- added ability to delete attached files (issue #98)
-	- Fixed issues with searches on related fields when relationship defined
-	  with table aliases as part of the query.
-	- Grafted fields are now included in related records.
-
-Xataface 1.1.3 928
-Feb. 3, 2009
-	- added label_link directive for fields.ini file.
-	- fixed bug in find form that caused fields to be pushed below instructions.
-
-Xataface 1.1.2 900
-Jan. 26, 2009
-	- added support for struct parameter in fields.ini file.
-	- fixed issue with Dataface_Table::getType() not recognizing unsigned fields properly.
-
-Xataface 1.1.1 860
-Jan. 12, 2009
-
-	- Improved functionality on SQL parser to handle more cases.  The particularly
-	  affects sites that use multilingual content.  Possibly will help relationships
-	  to support wider array of __sql__ values.
-
-Xataface 1.1 840
-Jan. 5, 2009
-	
-	- Includes quite a few bug fixes.
-	- Added triggers for after_action_login and after_action_logout
-	- Added support for nicEdit HTML editor. (Use widget:editor=nicEdit)
-	- Replaced scriptaculous with jquery to power expand/collapse of sections
-	- Added option reversion to old-style resultlist controller via preferences
-		use_old_resultlist_controller=1
-	- Changed look on tabs when tabs are used on the edit form. Much cleaner look.
-	- Added --default-preview-length GET parameter to set the maximum length to be shown of text
-      fields in list view.
-      
-    
-    For full list of changes, use SVN:
-    	svn log -r 561:840 http://weblite.ca/svn/dataface/core/trunk
-	
-Xataface 1.0.7 561
-Nov. 3, 2008
-	
-	Fixed bug #391.  This is a critical fix.
-
-Xataface 1.0.6 556
-Nov. 1, 2008
-	
-	Added feature #174 : Support for renderCell() in related list.
-
-Xataface 1.0.5 555 (bugfix release)
-Nov. 1, 2008
-	
-	Fixed bugs 198, 269, and 388
-
-Xataface 1.0.4 530 (bugfix release)
-October 30, 2008
-
-	- Many minor bug fixes.
-	- Many stability improvements.
-	- Support for alternate mail function to be specified for registration email in conf.ini file
-	- Grid widget respects permissions on front-end now.
-	- Fixed segmentation faults issue on PHP 5
-	- Fieldgroups can now have a description
-	- Empty fieldgroups no longer displayed on form.
-	- Still much internationalization to do.
-	
-
-Xataface 1.0-beta-3
-June 16, 2008
-
-	Another bug fix release - but a couple of new features have been 
-	added also:
-	
-	Bugs Fixed:
-		http://bugs.weblite.ca/view.php?id=179
-			Page cannot be found when adding new related record
-			
-		http://bugs.weblite.ca/view.php?id=180
-			Fatal Error. undefined function init()
-			
-		http://bugs.weblite.ca/view.php?id=128
-			Field groups in related record form display in-line
-			
-		http://bugs.weblite.ca/view.php?id=130
-			Submit button missing from find forms with relationships
-			
-		http://bugs.weblite.ca/view.php?id=165
-			Cannot use if() function in __sql__ of fields.ini file.
-			
-		http://bugs.weblite.ca/view.php?id=164
-			Greater than/Greater than or equal queries on Date fields do not work
-			
-		http://bugs.weblite.ca/view.php?id=149
-			Queries for value '0' result in error.
-			
-		http://bugs.weblite.ca/view.php?id=146
-			New related record form shows fields twice
-			
-		http://bugs.weblite.ca/view.php?id=119
-			Export CSV embedded quotes handled incorrectly in PHP4
-			
-		
-			
-	Features added:
-		http://bugs.weblite.ca/view.php?id=175
-			Drag & Drop reordering of related records
-			
-		
-
-Xataface 1.0-beta-2
-March 29, 2008
-
-	Bug Fix release.
-	This is an incremental release that fixes some of the bugs identified
-	by users on 1.0-beta-1.
-	
-	Bugs Fixed:
-		http://bugs.weblite.ca/view.php?id=107
-			Autocomplete broken.
-			Thanks to S.T. Stoddard for identifying this.
-			
-		http://bugs.weblite.ca/view.php?id=105
-			Checkbox alignment off
-			Thanks to S.T. Stoddard for identifying this.
-			
-		http://bugs.weblite.ca/view.php?id=106
-			Multiselect only commits one value to database
-			Thanks to S.T. Stoddard for identifying this.
-			
-		http://bugs.weblite.ca/view.php?id=115
-			Grouping fields doesn't work
-			Thanks S.T. Stoddard for identifying this.
-			
-		http://bugs.weblite.ca/view.php?id=116
-			'group' widget doesn't work (errors).
-			Thanks S.T. Stoddard for identifying this.
-			
-		http://bugs.weblite.ca/view.php?id=117
-			Readme file contains links to old web site.
-	
-
-Xataface 1.0-beta-1
-March 2008
-
-	See Xataface manual for full features.
-
-Dataface 0.8 unstable
-June 12, 2007
-	Changes
-		1. Added FormTool class to factor out all of the generic form code from
-			Dataface_QuickForm.  Also added classes Dataface_FormTool_xxx for
-			each widget type.  Creating custom widgets is not possible and 
-			easy.  This will form the foundation of a new API for building 
-			widgets.  Developers should be able to develop and install new
-			widgets easily.
-		2. Fixed bugs with Relationships using vocabulary:existing option 
-		   (variables not defined).
-		   
-Dataface 0.7.3.3
-June 11, 2007
-	Changes
-		1. Added Ontology classes:
-			The Ontology classes provide a framework for dealing with data in a more  
-			generic way.  Ontologies can be created that wrap tables in any database  
-			and allow them to be used in a common way.  For example, a news ontology  
-			could be created that would allow you to work with any table as if it 
-			stored news items.  It would find the fields that are used for the 
-			pertinent pieces of data and allow them to be accessed in a common way.
-			
-			This is used by the registration actions.
-			
-		2. Added getByID and setByID static functions to IO.php to allow records and
-			fields to be accessed by URI.
-			
-		3. Minor syntax bugfix in Table.php
-		
-		4. In templates/Dataface_RecordHistory.html:
-			Fixed action to restore records to previous version.  The previous action
-			was missing the -table POST parameter.  This parameter was important for
-			locating the correct history record.
-			
-		5. In templates/Dataface_MainTemplate.html:
-			Added more javascript global variables to make it easier to reference
-			Dataface URLs from javascript functions: DATAFACE_SITE_HREF, DATAFACE_URL
-			
-		6. In SkinTool.php:
-			Added some more user friendly error messages to appear when the compiled
-			templates directory cannot be accessed.  This is important for
-			shared servers with SAFE mode enabled because Dataface won't
-			be able to create the subdirectories that it wants to create
-			in the templates_c directory, so the user will have to create
-			them himself.  The error messages now inform the user what has happened
-			and instructs him on how to create the necessary directories himself.
-		
-		7. DB.php
-			Added debugging output option in Dataface_DB if the DATAFACE_DEBUG_DB
-			constant is set.
-			
-		8. LanguageTool.php:
-			Fixed minor bug that prevented languages other than English from showing
-			up as bold in the language selector when they are selected.
-			
-		9. Added new register action to allow users to register.  Created activate   
-			action also to allow users to activate their accounts from an automated   
-			email.
-			Modified the actions.ini file also to make it more readable, while adding
-			the two new actions.
-			
-		
-Dataface 0.7.3.2
-May 30, 2007
-
-	Changes
-	
-		1. Removed extra unused libraries from distribution.
-		
-Dataface 0.7.3
-May 30, 2007
-
-	Changes
-	
-		1. Updated SortControl.  Not dropdown anymore.  Now honours the sortable
-			parameter in the fields.ini file (e.g. sortable=1 or sortable=0)
-			
-		2. Fixed History action to now give fatal error if the record has no history yet.
-		
-		3. Added visibility:history and  visibility:summary options to make 
-		   fields visible or not in the summary view and history details view.
-		   
-		4. Added transient fields (fields which appear on the new and edit forms
-			but aren't bound to the database).  Fields.ini file option: transient = 0 
-			or transient = 1
-			
-		5. Added checkbox form options for the relationship view to allow certain
-		   relationships to be managed via simple checkboxes.
-		   
-		6. Added "delegate" actions option.  Any action can now have a delegate
-		   property to specify another action to work in its place.  This makes
-		   it easy to override any of the built-in actions.
-		   
-		7. Minor bugfixes.
-		
-Dataface 0.7.2
-May 16, 2007
-
-	Changes
-		
-		1. Fixed ENUM field searching on find form to do exact matching by default.
-		2. Small fix in RecordView.php to allow calculated fields to be used as
-			logo fields.
-			
-
-Dataface 0.7.1
-May 10, 2007
-	
-	Changes
-	
-		1. Added register action.
-
-Dataface 0.7 dev 4
-May 7, 2007
-
-	Changes
-		
-		1. Added fr.ini and de.ini language files for French and German translations
-			respectively.  Thanks to Jean Carafantan for the French translation and
-			Daniel Siefert for the German Translation.
-			
-		2. Added credits for translations to associated language ini file. 
-		   (used Google translate for the wording.
-		   
-Dataface 0.7 dev 3
-May 5, 2007
-	
-	Changes
-	
-		1. PHP 4 Compatibility.
-		2. Replaced call_user_func calls with variable function calls so that 
-			delegate class calls will pass $record by reference on PHP 4.
-		3. Fixed Output cache glitch with GZIP encoding that caused problems 
-			on IE 6.
-		
-Dataface 0.7 dev 2
-May 3, 2007
-	
-	Changes
-	
-		Made it so the view tab logo can be disabled in the preferences by setting
-		hide_record_view_logo to 1
-
-Dataface 0.7 dev 1
-May 3, 2007
-	
-	Changes
-	
-		- Almost too many to cover here, but:
-		1. Overrideable actions (using > notation)
-		2. Alternative list view (Dataface_List_View_summary.html)
-		3. New improved view tab.
-		4. Scriptaculous for collapsible sections.
-		5. Metadata can now be associated with valuelist values - and included in the "class"
-			attribute of resulting checkboxes.
-		6. _disallowed_tables and _allowed_tables sections in conf.ini file allow
-			you to disallow access to certain tables.
-		7. Improved phpthumb integration.
-		8. New summary list and glance list templates can be used to quickly
-			display an assortment of records.
-		9. Improved guessing of domain tables in relationships.
-		10. section__#section_name# methods can be used to define sections in
-			the view tab.
-		11. APC integration for Configtool so that config files will automatically
-			be cached if APC is installed.
-		12. Action Tool actions can now refer to the $record object to mean the
-			record that the action is applied to (not just the current record
-			of the request).
-			
-
-
-Dataface 0.6.14 dev 5
-March 15, 2007
-	Changes
-		
-		- Fixed FeedTool getLink() method to change the action to 'list' if it
-		  is feed.  That way the link won't take the user to the RSS feed - it
-		  will take them to the result list.
-		  
-		- Extracted out all english strings into en.ini.
-		
-		- Added xml actions to prepare for a Dataface Desktop client.
-		
-		- Added http authentication (auth_type=http)
-		
-Dataface 0.6.14 dev 4
-March 1, 2007
-
-	Changes
-	
-		- Import ModuleTool in the constructor of Application if modules are 
-		  defined in case pages use template but don't call handleRequest()
-		  
-Dataface 0.6.14 dev 3
-March 1, 2007
-	
-	Changes
-	
-		- Fixed import records action so that it returns the user to the proper
-		  part of the application after the import is complete.
-		  
-		- Cleaned up the RSS functionality.
-		
-		- Finished/Added documentation for the Feedburner module
-		
-		- Added build instructions to build.xml file to accommodate Feedburner
-		  module.
-		  
-Dataface 0.6.14 dev 2
-Feb. 28, 2007
-
-	Major Feature Additions:
-	
-		- Modules framework
-			- Define any config file inside a module directory.
-			- Override slots and blocks within a module's directory.
-			- Define actions in the actions directory of a module.
-			
-			Still to do:
-				- Allow getPermissions definition in a module (this will be huge)
-				- Improve handling of permissions.ini file within module.
-				- Allow delegate classes to be defined in a module.
-		
-		- Feedburner module
-			- Created for DataVinci (Thank you!!)
-			
-	Minor Feature Additions:
-	
-		- 'onclick' attribute added to actions.
-		
-	
-Dataface 0.6.14 dev 1
-Feb. 14, 2007
-
-	Changes
-	
-		- Basic implementation of copy records form and update records form.
-		
-		- Added ability to perform actions on particular selected records in list
-		  view.
-		  
-		- Added new selection framework to be able to perform actions on only
-		  records that are selected in list mode or in a related list.
-		  
-		- Added "Import records" action to the list view.
-		
-		- Updated the Import Records template to include better "helps".
-		
-		- Added ability to add import filter descriptions in the language ini files.
-		  using key convention import_filters:<filter name>.
-		
-		
-Dataface 0.6.14
-Feb. 12, 2007
-
-	Changes
-	
-		- Updated translate_found_babelfish action so that it will also translate
-		  records that are already machine translated but marked for update.
-		  
-		- Added ability for ConfigTool to load configuration from the database.
-		  Still incomplete but ready to build upon.
-		  
-		- Added editable.js, df_editable, and smarty editable tag that is used
-		 to make parts of the UI editable right in the browser.  This is moving 
-		 towards full layout control TTW.
-		 
-Dataface 0.6.13r4
-Feb. 9, 2007
-
-	Changes
-	
-		- Added class names to tables and cells in edit forms so that they can be
-		  more easily manipulated using CSS.
-		  
-Dataface 0.6.13r3
-Feb. 9, 2007
-
-	Changes
-	
-		- Changed the fix in Table.php to eliminate the need to import Dataface_AuthenticationTool.
-		
-Dataface 0.6.13r2
-Feb. 9, 2007
-
-	Changes
-	
-		- Fixed bug that caused ordering columns to not show up in related lists.
-		
-		- Also fixed fatal error in Table.php caused if authentication was not
-		  being used.  (Added import of AuthenticationTool).
-		  
-Dataface 0.6.13
-February 8, 2007
-
-	Changes
-	
-		- Added __filters__ section to the fields.ini file that allows users
-		  to define filters
-		  
-Dataface 0.6.12r2
-
-	Changes
-	
-		- Bug fixed with delete action that caused it to always say permission
-		  denied (Thanks Graham Geller).
-		  
-		- Added actions attribute to fields.ini to specify field actions.  Now
-		  actions can be attached to any field.  These will be reflected as buttons
-		  on the edit form.
-		  
-		- added setSecurityFilter() and getSecurityFilter() methods to Dataface_Table
-		  which limit the queries.  This allows you to limit users to only certain 
-		  records in a table.
-		  
-Dataface 0.6.12r1
-
-	Changes
-	
-		- Fixed serious bug with permissions that prevented Application delegate
-		 class from receiving record.  (Thanks Graham Geller and Martin Pruss)
-		 
-		- Improved handling of default labels.  Now underscores are converted to
-		  spaces by default for field labels.
-		  
-		- improved display of array fields (e.g. table fields) content for 
-		  view and list tabs.
-
-Dataface 0.6.12
-February 6, 2007
-
-	Changes
-		
-		- Added Content-dispoistion: filename header when downloading blob fields
-		
-		- Minor permissions fixes when no records are found.
-		
-		- Added ability to edit valuelists.
-		
-Dataface 0.6.11
-January 22, 2007
-
-	Changes
-	
-		- Added export_csv action to export result lists to CSV (comma-separated
-		  value) format.
-		  
-Dataface 0.6.10
-January 18, 2007
-
-	Changes
-		
-		- Numerous bug fixes.
-		
-		- Improved permissions handling
-		
-		- added save() method to Dataface_RelatedRecord
-		
-		- added df_get_record_by_id function in public api.
-		
-		- added dhtmlxGrid and a portal widget (not yet finished).
-		
-Dataface 0.6.9r1
-October 2, 2006
-
-	Changes
-		- Modified AuthenticationTool to more easily allow for modular plugins.
-		
-		- Support for CAS Authentication module.. not included with distribution.
-		
-Dataface 0.6.8
-September 21, 2006
-
-	Changes
-	
-		- Fixed Record tree-menu so that it works in IE 6, Safari, and Firefox (both Mac and Windows)
-		
-		- Added ajax expandable records to list tab so that users can click the "expand" button
-		  next to a row to see its record details expand below it.
-
-Dataface 0.6.7
-September 20, 2006
-
-	Changes
-		
-		- Added Record tree-menu in the left column for records. (Sponsored by Advanced Medical (advanced-medical.com))
-		
-		- Added preliminary AJAX support.  
-		
-		- Minor stylesheet changes.
-		
-		- Added toJS() method to Dataface_Record to be able to output object as Javascript object.
-
-Dataface 0.6.6
-September 16, 2006
-
-	Changes
-	
-		- Added history tab if the [history] section of the conf.ini is added.
-		
-			- Now history is kept on records.  Records can be restored to 
-				any previous version.
-				
-		- Changed default behavior to include sessions.  Session is automatically 
-		  started by the Dataface_Application::display() method.
-		  
-		- other small bugfixes.
-		
-
-Dataface 0.6.0
-April 26, 2006
-	
-	Changes
-	
-		- permissions.ini file
-		
-			- Added permission.ini file to dataface with core permissions and roles
-			
-			- Added support for overridden permissions in application/permissions.ini file
-			
-			- Added support for table-level permissions (tables/tablename/permissions.ini)
-			
-			- deprecated tablePermissions() method in delegate class - now use getPermissions()
-		
-		- language files
-		
-			- Added lang directory to dataface with ini files for each language translation.
-			
-			- Added Dataface_LanguageTool to manage translations
-			
-			- Support for application / table -level language files
-		
-		- actions.ini files
-		
-			- actions.ini file in dataface directory to define global actions
-			
-			- support for application/table level actions.ini files
-			
-			- actions directory to contain custom controllers for actions.
-			
-			- support for application/table-level actions folders
-		
-		- modular actions framework
-		
-			- Custom actions can be added at table/application level
-			
-			- permissions can be applied to each action
-		
-		- delegate class overriding of ini properties
-		
-			- any properties in the fields.ini file can now be overridden in the delegate
-			  class.
-		
-		- deprecated the TableView class in favour of templates
-			
-			- Dataface_SkinTool adds a number of tags that can be used in templates to obtain parts of UI
-			
-		- Enriched features in Application class to be able to handle requests, load records, etc...
-		
-
-Dataface 0.5.3
-March 20, 2006
-
-	Changes
-	
-		- Refactored all writing and deleting functionality into Dataface_IO class.
-		
-		- Added event handling for following events:
-		
-			- beforeSave, afterSave
-			- beforeInsert, afterInsert
-			- beforeUpdate, afterUpdate
-			- beforeDelete, afterDelete
-			- beforeAddRelatedRecord, afterAddRelatedRecord
-			- beforeAddNewRelatedRecord, afterAddNewRelatedRecord
-			- beforeAddExistingRelatedRecord, afterAddNewRelatedRecord
-			
-			Methods of the appropriate names are defined in the delegate class to handle
-			these events.
-			
-		- Fixed minor syntax errors that cause problems on some systems.
-		
-		- added toRecord() and toRecords() methods to Dataface_RelatedRecord class to extract
-		  Dataface_Record objects based on values of related records.
-		  
-		- Added more Selenium test suites for functional testing.
-		
-	Known Bugs
-	
-		- Validation for grouped fields has not been fixed yet.
-		
-		- Relationships to the same table must be done using SQL (can't use the simplified INI syntax)
-		
-
-Dataface 0.5.2r3
-March 11, 2006
-
-	Changes
-	
-		- Added PEAR.php to the distribution and removed requirement for PEAR.php
-		  until the include paths have been added properly. This corrected an error
-		  when used in Safe mode on shared hosts (so PEAR.php was inaccessible).
-
-Dataface 0.5.2
-March 10, 2006
-	
-	Major Changes
-	
-		- Added Calendar widget (widget:type = 'calendar')
-		- Made Calendar widget the default widget type for date and datetime fields.
-	
-	Minor Changes
-	
-		- Made 'static' the default widget type for Timestamp fields.
-
-Dataface 0.5.1
-March 4, 2006
-
-	Major Changes
-	
-		- Improved compatibility with Windows/IIS, and CGI
-		
-		- Improved compatibility with MySQL 5
-		
-		- Fixed serious bug with "Delete Found" records which caused "search" 
-		  field filters to be ignored.
-		  
-	Specific Changes
-	
-		- Changed path separator to be platform independent (config.inc.php)
-		
-		- Fixed redirects to use absolute urls in QuickForm.
-		
-		- Added missing "SERVER" variables that are not available to CGI
-		
-		- Fixed QueryBuilder so that it does not attempt to place empty strings
-		  into auto increment fields.
-		  
-		- Updated Serializer so that it formats data to be compliant with strict
-		  mode in MySQL 5.
-		  
-		- FIxed a number of errors caused by returning literal values from functions
-		  that are to return by reference (Author's opinion is that this is one
-		  of the dumbest things to be added to PHP).
-		  
-		- Added permissions validation to the Delete record form.  Also added recognition
-		  of the '-search' parameter when deleting records.  This was a major bug.
-		  
-	To DO:
-	
-		- Likely many more compatibility problems exist for Windows, CGI, and MySQL 5.
-			Need to create more unit tests and run them on Windows.
-			
-		- Change the makesite script to be compatible with Windows.
-		  
-		
+Index: DB/Sync.php
+===================================================================
+--- DB/Sync.php	(revision 4694)
++++ DB/Sync.php	(working copy)
+@@ -248,4 +248,4 @@
+ 	}
+ }
+ 
+-?>
+\ No newline at end of file
++?>
Index: PEAR/FixPHP5PEARWarnings.php
===================================================================
--- PEAR/FixPHP5PEARWarnings.php	(revision 4694)
+++ PEAR/FixPHP5PEARWarnings.php	(working copy)
@@ -4,4 +4,4 @@
 } else {
     $a = new $ec($message, $code, $mode, $options, $userinfo);
 }
-?>
\ No newline at end of file
+?>
Index: docs/examples/getRelatedRecords.example.php
===================================================================
--- docs/examples/getRelatedRecords.example.php	(revision 4694)
+++ docs/examples/getRelatedRecords.example.php	(working copy)
@@ -34,4 +34,4 @@
 echo '</tbody>
 	</table>
 	';
-?>
\ No newline at end of file
+?>
Index: docs/examples/Application.example.php
===================================================================
--- docs/examples/Application.example.php	(revision 4694)
+++ docs/examples/Application.example.php	(working copy)
@@ -4,4 +4,4 @@
 df_init(__FILE__, '/dataface');
 $app =& Dataface_Application::getInstance();
 $app->display();
-?>
\ No newline at end of file
+?>
Index: docs/examples/getRelatedRecords.example2.php
===================================================================
--- docs/examples/getRelatedRecords.example2.php	(revision 4694)
+++ docs/examples/getRelatedRecords.example2.php	(working copy)
@@ -26,4 +26,4 @@
 					5 /*limit*/,
 					"Semester='Spring-05'" /*where*/,
 					"LetterGrade" /*Order by*/);
-?>
\ No newline at end of file
+?>
Index: dataface_info.php
===================================================================
--- dataface_info.php	(revision 4694)
+++ dataface_info.php	(working copy)
@@ -100,4 +100,4 @@
   </p>
 </td></tr>
 </table><br />
-</div></body></html>
\ No newline at end of file
+</div></body></html>
Index: SQL/Parser/wrapper.php
===================================================================
--- SQL/Parser/wrapper.php	(revision 4694)
+++ SQL/Parser/wrapper.php	(working copy)
@@ -709,4 +709,4 @@
 	
 	
 
-}
\ No newline at end of file
+}
Index: tests/run_ValuelistToolTest.php
===================================================================
--- tests/run_ValuelistToolTest.php	(revision 4694)
+++ tests/run_ValuelistToolTest.php	(working copy)
@@ -11,4 +11,4 @@
 print $result->toHtml();
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_dhtmlxGridTest.php
===================================================================
--- tests/run_dhtmlxGridTest.php	(revision 4694)
+++ tests/run_dhtmlxGridTest.php	(working copy)
@@ -29,4 +29,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_ImportFilterTest.php
===================================================================
--- tests/run_ImportFilterTest.php	(revision 4694)
+++ tests/run_ImportFilterTest.php	(working copy)
@@ -30,4 +30,4 @@
 
 print $result->toHtml();
 
-?>
\ No newline at end of file
+?>
Index: tests/dhtmlxGridTest.php
===================================================================
--- tests/dhtmlxGridTest.php	(revision 4694)
+++ tests/dhtmlxGridTest.php	(working copy)
@@ -34,4 +34,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/ValuelistToolTest.php
===================================================================
--- tests/ValuelistToolTest.php	(revision 4694)
+++ tests/ValuelistToolTest.php	(working copy)
@@ -45,4 +45,4 @@
 	}
 }
 	
-?>
\ No newline at end of file
+?>
Index: tests/run_DB_Test.php
===================================================================
--- tests/run_DB_Test.php	(revision 4694)
+++ tests/run_DB_Test.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/PermissionsTest.php
===================================================================
--- tests/PermissionsTest.php	(revision 4694)
+++ tests/PermissionsTest.php	(working copy)
@@ -18,4 +18,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/RelatedListTest.php
===================================================================
--- tests/RelatedListTest.php	(revision 4694)
+++ tests/RelatedListTest.php	(working copy)
@@ -37,4 +37,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_TranslationToolTest.php
===================================================================
--- tests/run_TranslationToolTest.php	(revision 4694)
+++ tests/run_TranslationToolTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/ImportFilterTest.php
===================================================================
--- tests/ImportFilterTest.php	(revision 4694)
+++ tests/ImportFilterTest.php	(working copy)
@@ -66,4 +66,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_Parser_wrapperTest.php
===================================================================
--- tests/run_Parser_wrapperTest.php	(revision 4694)
+++ tests/run_Parser_wrapperTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_QueryToolTest.php
===================================================================
--- tests/run_QueryToolTest.php	(revision 4694)
+++ tests/run_QueryToolTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_ValuelistEditorFormTest.php
===================================================================
--- tests/run_ValuelistEditorFormTest.php	(revision 4694)
+++ tests/run_ValuelistEditorFormTest.php	(working copy)
@@ -9,4 +9,4 @@
 $form->display();
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_IOTest.php
===================================================================
--- tests/run_IOTest.php	(revision 4694)
+++ tests/run_IOTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/TranslationToolTest.php
===================================================================
--- tests/TranslationToolTest.php	(revision 4694)
+++ tests/TranslationToolTest.php	(working copy)
@@ -173,4 +173,4 @@
 	}
 }
 ?>
-	
\ No newline at end of file
+	
Index: tests/run_QueryBuilderTest.php
===================================================================
--- tests/run_QueryBuilderTest.php	(revision 4694)
+++ tests/run_QueryBuilderTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_RecordTest.php
===================================================================
--- tests/run_RecordTest.php	(revision 4694)
+++ tests/run_RecordTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_MetadataToolTest.php
===================================================================
--- tests/run_MetadataToolTest.php	(revision 4694)
+++ tests/run_MetadataToolTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/dhtmlxGrid_testpage.php
===================================================================
--- tests/dhtmlxGrid_testpage.php	(revision 4694)
+++ tests/dhtmlxGrid_testpage.php	(working copy)
@@ -55,4 +55,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/QueryToolTest.php
===================================================================
--- tests/QueryToolTest.php	(revision 4694)
+++ tests/QueryToolTest.php	(working copy)
@@ -132,4 +132,4 @@
 	}
 }
 ?>
-	
\ No newline at end of file
+	
Index: tests/index.php
===================================================================
--- tests/index.php	(revision 4694)
+++ tests/index.php	(working copy)
@@ -44,4 +44,4 @@
 	<li><a href="selenium/TestRunner.html?test=../Sel_TestSuite.htm">Web Tests (Using Selenium)</a></li>
 	</ul>
 </body>
-</html>
\ No newline at end of file
+</html>
Index: tests/IOTest.php
===================================================================
--- tests/IOTest.php	(revision 4694)
+++ tests/IOTest.php	(working copy)
@@ -575,4 +575,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_PermissionToolTest.php
===================================================================
--- tests/run_PermissionToolTest.php	(revision 4694)
+++ tests/run_PermissionToolTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_CompositeFormTest.php
===================================================================
--- tests/run_CompositeFormTest.php	(revision 4694)
+++ tests/run_CompositeFormTest.php	(working copy)
@@ -20,4 +20,4 @@
 $form = new Dataface_CompositeForm(array('Profiles?id=10#fname','Profiles?id=10#lname','Appointments?id=2#position'));
 $form->build();
 echo $form->display();
-?>
\ No newline at end of file
+?>
Index: tests/run_TableTest.php
===================================================================
--- tests/run_TableTest.php	(revision 4694)
+++ tests/run_TableTest.php	(working copy)
@@ -29,4 +29,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/QueryBuilderTest.php
===================================================================
--- tests/QueryBuilderTest.php	(revision 4694)
+++ tests/QueryBuilderTest.php	(working copy)
@@ -368,4 +368,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/MetadataToolTest.php
===================================================================
--- tests/MetadataToolTest.php	(revision 4694)
+++ tests/MetadataToolTest.php	(working copy)
@@ -173,4 +173,4 @@
 	
 }
 ?>
-	
\ No newline at end of file
+	
Index: tests/RecordTest.php
===================================================================
--- tests/RecordTest.php	(revision 4694)
+++ tests/RecordTest.php	(working copy)
@@ -703,4 +703,4 @@
 	
 }
 
-?>
\ No newline at end of file
+?>
Index: tests/run_LinkToolTest.php
===================================================================
--- tests/run_LinkToolTest.php	(revision 4694)
+++ tests/run_LinkToolTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_HistoryToolTest.php
===================================================================
--- tests/run_HistoryToolTest.php	(revision 4694)
+++ tests/run_HistoryToolTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_RecordTest2.php
===================================================================
--- tests/run_RecordTest2.php	(revision 4694)
+++ tests/run_RecordTest2.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_RelationshipTest.php
===================================================================
--- tests/run_RelationshipTest.php	(revision 4694)
+++ tests/run_RelationshipTest.php	(working copy)
@@ -11,4 +11,4 @@
 print $result->toHtml();
 
 
-?>
\ No newline at end of file
+?>
Index: tests/CSSToolTest.php
===================================================================
--- tests/CSSToolTest.php	(revision 4694)
+++ tests/CSSToolTest.php	(working copy)
@@ -49,4 +49,4 @@
 	$test->run($result);
 	
 	print $result->toHtml();
-}
\ No newline at end of file
+}
Index: tests/TableTest.php
===================================================================
--- tests/TableTest.php	(revision 4694)
+++ tests/TableTest.php	(working copy)
@@ -504,4 +504,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/LinkToolTest.php
===================================================================
--- tests/LinkToolTest.php	(revision 4694)
+++ tests/LinkToolTest.php	(working copy)
@@ -54,4 +54,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/HistoryToolTest.php
===================================================================
--- tests/HistoryToolTest.php	(revision 4694)
+++ tests/HistoryToolTest.php	(working copy)
@@ -294,4 +294,4 @@
 	}
 }
 ?>
-	
\ No newline at end of file
+	
Index: tests/run_UtilitiesTest.php
===================================================================
--- tests/run_UtilitiesTest.php	(revision 4694)
+++ tests/run_UtilitiesTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/RecordTest2.php
===================================================================
--- tests/RecordTest2.php	(revision 4694)
+++ tests/RecordTest2.php	(working copy)
@@ -304,4 +304,4 @@
 	
 }
 
-?>
\ No newline at end of file
+?>
Index: tests/RelationshipTest.php
===================================================================
--- tests/RelationshipTest.php	(revision 4694)
+++ tests/RelationshipTest.php	(working copy)
@@ -329,4 +329,4 @@
 	}
 }
 	
-?>
\ No newline at end of file
+?>
Index: tests/test2.php
===================================================================
--- tests/test2.php	(revision 4694)
+++ tests/test2.php	(working copy)
@@ -11,4 +11,4 @@
 print $result->toHtml();
 
 
-?>
\ No newline at end of file
+?>
Index: tests/test3.php
===================================================================
--- tests/test3.php	(revision 4694)
+++ tests/test3.php	(working copy)
@@ -11,4 +11,4 @@
 print $result->toHtml();
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_RelatedRecordTest.php
===================================================================
--- tests/run_RelatedRecordTest.php	(revision 4694)
+++ tests/run_RelatedRecordTest.php	(working copy)
@@ -29,4 +29,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/test4.php
===================================================================
--- tests/test4.php	(revision 4694)
+++ tests/test4.php	(working copy)
@@ -11,4 +11,4 @@
 print $result->toHtml();
 
 
-?>
\ No newline at end of file
+?>
Index: tests/testconfig.php
===================================================================
--- tests/testconfig.php	(revision 4694)
+++ tests/testconfig.php	(working copy)
@@ -44,4 +44,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/PermissionsToolTest.php
===================================================================
--- tests/PermissionsToolTest.php	(revision 4694)
+++ tests/PermissionsToolTest.php	(working copy)
@@ -95,4 +95,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/BaseTest.php
===================================================================
--- tests/BaseTest.php	(revision 4694)
+++ tests/BaseTest.php	(working copy)
@@ -1176,4 +1176,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/UtilitiesTest.php
===================================================================
--- tests/UtilitiesTest.php	(revision 4694)
+++ tests/UtilitiesTest.php	(working copy)
@@ -33,4 +33,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: tests/RelatedRecordTest.php
===================================================================
--- tests/RelatedRecordTest.php	(revision 4694)
+++ tests/RelatedRecordTest.php	(working copy)
@@ -105,4 +105,4 @@
 	
 }
 	
-?>
\ No newline at end of file
+?>
Index: tests/run_Table_builderTest.php
===================================================================
--- tests/run_Table_builderTest.php	(revision 4694)
+++ tests/run_Table_builderTest.php	(working copy)
@@ -29,4 +29,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/tables/Appointments/Appointments.php
===================================================================
--- tests/tables/Appointments/Appointments.php	(revision 4694)
+++ tests/tables/Appointments/Appointments.php	(working copy)
@@ -14,4 +14,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: tests/tables/Courses/Courses.php
===================================================================
--- tests/tables/Courses/Courses.php	(revision 4694)
+++ tests/tables/Courses/Courses.php	(working copy)
@@ -10,4 +10,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/tables/Profiles/Profiles.php
===================================================================
--- tests/tables/Profiles/Profiles.php	(revision 4694)
+++ tests/tables/Profiles/Profiles.php	(working copy)
@@ -110,4 +110,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/tables/formulas/formulas.php
===================================================================
--- tests/tables/formulas/formulas.php	(revision 4694)
+++ tests/tables/formulas/formulas.php	(working copy)
@@ -78,4 +78,4 @@
     function section__ingredients($record){
     	return $this->buildRelatedSection($record, 'ingredients');
     }
-}
\ No newline at end of file
+}
Index: tests/tables/Publications/Publications.php
===================================================================
--- tests/tables/Publications/Publications.php	(revision 4694)
+++ tests/tables/Publications/Publications.php	(working copy)
@@ -3,4 +3,4 @@
 
 	function titleColumn(){ return "BiblioString";}
 }
-?>
\ No newline at end of file
+?>
Index: tests/tables/Registrations/Registrations.php
===================================================================
--- tests/tables/Registrations/Registrations.php	(revision 4694)
+++ tests/tables/Registrations/Registrations.php	(working copy)
@@ -18,4 +18,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: tests/tables/RegistrationProducts/RegistrationProducts.php
===================================================================
--- tests/tables/RegistrationProducts/RegistrationProducts.php	(revision 4694)
+++ tests/tables/RegistrationProducts/RegistrationProducts.php	(working copy)
@@ -12,4 +12,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/tables/formula_ingredients/formula_ingredients.php
===================================================================
--- tests/tables/formula_ingredients/formula_ingredients.php	(revision 4694)
+++ tests/tables/formula_ingredients/formula_ingredients.php	(working copy)
@@ -17,4 +17,4 @@
 		if ( !$this->testPermissions) return null;
 		return array('view'=>1);
 	}
-}
\ No newline at end of file
+}
Index: tests/tables/lesson_plans/lesson_plans.php
===================================================================
--- tests/tables/lesson_plans/lesson_plans.php	(revision 4694)
+++ tests/tables/lesson_plans/lesson_plans.php	(working copy)
@@ -5,4 +5,4 @@
 	function created__toString($value){ return $value['month'].'/'.$value['day'].'/'.$value['year'];}
 	function modified__toString($value){ return $this->created__toString($value); }
 
-}
\ No newline at end of file
+}
Index: tests/tables/Registrants/Registrants.php
===================================================================
--- tests/tables/Registrants/Registrants.php	(revision 4694)
+++ tests/tables/Registrants/Registrants.php	(working copy)
@@ -51,4 +51,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_TreeTableTest.php
===================================================================
--- tests/run_TreeTableTest.php	(revision 4694)
+++ tests/run_TreeTableTest.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/BaseTest2.php
===================================================================
--- tests/BaseTest2.php	(revision 4694)
+++ tests/BaseTest2.php	(working copy)
@@ -53,4 +53,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/Table_builderTest.php
===================================================================
--- tests/Table_builderTest.php	(revision 4694)
+++ tests/Table_builderTest.php	(working copy)
@@ -101,4 +101,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_SQL_Parser_test.php
===================================================================
--- tests/run_SQL_Parser_test.php	(revision 4694)
+++ tests/run_SQL_Parser_test.php	(working copy)
@@ -3,4 +3,4 @@
 include 'test_parser.php';
 
 
-?>
\ No newline at end of file
+?>
Index: tests/run_QueryTranslator_Test.php
===================================================================
--- tests/run_QueryTranslator_Test.php	(revision 4694)
+++ tests/run_QueryTranslator_Test.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/run_DB_Sync_Test.php
===================================================================
--- tests/run_DB_Sync_Test.php	(revision 4694)
+++ tests/run_DB_Sync_Test.php	(working copy)
@@ -6,4 +6,4 @@
 $test->run($result);
 
 print $result->toHtml();
-?>
\ No newline at end of file
+?>
Index: tests/JavascriptToolTest.php
===================================================================
--- tests/JavascriptToolTest.php	(revision 4694)
+++ tests/JavascriptToolTest.php	(working copy)
@@ -117,4 +117,4 @@
 	$test->run($result);
 	
 	print $result->toString();
-}
\ No newline at end of file
+}
Index: tests/TreeTableTest.php
===================================================================
--- tests/TreeTableTest.php	(revision 4694)
+++ tests/TreeTableTest.php	(working copy)
@@ -114,4 +114,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: tests/DB_Sync_Test.php
===================================================================
--- tests/DB_Sync_Test.php	(revision 4694)
+++ tests/DB_Sync_Test.php	(working copy)
@@ -74,4 +74,4 @@
 	
 }
 
-?>
\ No newline at end of file
+?>
Index: tests/testApp.php
===================================================================
--- tests/testApp.php	(revision 4694)
+++ tests/testApp.php	(working copy)
@@ -23,4 +23,4 @@
 $app =& Dataface_Application::getInstance();
 $app->display();
 }
-?>
\ No newline at end of file
+?>
Index: tests/test_Models.php
===================================================================
--- tests/test_Models.php	(revision 4694)
+++ tests/test_Models.php	(working copy)
@@ -18,4 +18,4 @@
 $jt->import('xataface/store/tests/MasterDetailStoreTest.js');
 $jt->import('xataface/form/tests/FormElementTest.js');
 $jt->import('xataface/form/tests/FormTest.js');
-$jt->import('xataface/tests/ClassLoaderTest.js');
\ No newline at end of file
+$jt->import('xataface/tests/ClassLoaderTest.js');
Index: HTML/QuickForm/tests/QuickForm_table_tests.php
===================================================================
--- HTML/QuickForm/tests/QuickForm_table_tests.php	(revision 4694)
+++ HTML/QuickForm/tests/QuickForm_table_tests.php	(working copy)
@@ -59,4 +59,4 @@
 print $result->toString();
 
 
-?>
\ No newline at end of file
+?>
Index: HTML/QuickForm/Renderer/ArrayDataface.php
===================================================================
--- HTML/QuickForm/Renderer/ArrayDataface.php	(revision 4694)
+++ HTML/QuickForm/Renderer/ArrayDataface.php	(working copy)
@@ -195,4 +195,4 @@
     
 
 
-}
\ No newline at end of file
+}
Index: HTML/QuickForm/grid.php
===================================================================
--- HTML/QuickForm/grid.php	(revision 4694)
+++ HTML/QuickForm/grid.php	(working copy)
@@ -176,7 +176,7 @@
                        <?php $fieldDef = $this->getColumnFieldDef($column);$fieldTable = Dataface_Table::loadTable($fieldDef['tablename']);?>
                        
                         	
-                       <td style="padding-right: 10px;" valign="top" data-xf-grid-default-value="<?php echo htmlspecialchars($fieldTable->getDefaultValue($fieldDef['name']));?>">
+                       <td style="padding-right: 10px;" valign="top" data-xf-grid-default-value="<?php echo df_escape($fieldTable->getDefaultValue($fieldDef['name']));?>">
                        <?php unset($fieldDef, $fieldTable);?>
                         <?php
                         	//$column_definition = $this->getColumnDefinition($column);
@@ -256,7 +256,7 @@
                        <?php $fieldDef = $this->getColumnFieldDef($column);$fieldTable = Dataface_Table::loadTable($fieldDef['tablename']);?>
                        
                         	
-                       <td style="padding-right: 10px;" valign="top" data-xf-grid-default-value="<?php echo htmlspecialchars($fieldTable->getDefaultValue($fieldDef['name']));?>">
+                       <td style="padding-right: 10px;" valign="top" data-xf-grid-default-value="<?php echo df_escape($fieldTable->getDefaultValue($fieldDef['name']));?>">
                        <?php unset($fieldDef, $fieldTable);?>
                            <span >
                            <?php
@@ -409,4 +409,4 @@
     
     }
 
-}
\ No newline at end of file
+}
Index: HTML/QuickForm/yui_autocomplete.php
===================================================================
--- HTML/QuickForm/yui_autocomplete.php	(revision 4694)
+++ HTML/QuickForm/yui_autocomplete.php	(working copy)
@@ -103,4 +103,4 @@
     }
 	
 	
-}
\ No newline at end of file
+}
Index: doc/installation_files/sqldump.php
===================================================================
--- doc/installation_files/sqldump.php	(revision 4694)
+++ doc/installation_files/sqldump.php	(working copy)
@@ -71,4 +71,4 @@
 @see @ref installation for the full example.
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/installation.php
===================================================================
--- doc/installation.php	(revision 4694)
+++ doc/installation.php	(working copy)
@@ -157,4 +157,4 @@
 <img src="http://media.weblite.ca/files/photos/Screen%20shot%202011-05-24%20at%202.32.11%20PM.png?max_width=640"/>
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/modules.php
===================================================================
--- doc/modules.php	(revision 4694)
+++ doc/modules.php	(working copy)
@@ -26,4 +26,4 @@
 
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/mainpage.php
===================================================================
--- doc/mainpage.php	(revision 4694)
+++ doc/mainpage.php	(working copy)
@@ -64,4 +64,4 @@
 @ingroup formsAPI
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/modules/developer_guide/first_module.php
===================================================================
--- doc/modules/developer_guide/first_module.php	(revision 4694)
+++ doc/modules/developer_guide/first_module.php	(working copy)
@@ -118,4 +118,4 @@
 
 */
 
-?>
\ No newline at end of file
+?>
Index: doc/modules/developer_guide/actions.php
===================================================================
--- doc/modules/developer_guide/actions.php	(revision 4694)
+++ doc/modules/developer_guide/actions.php	(working copy)
@@ -143,4 +143,4 @@
 - Next: @ref module_developer_guide_javascript
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/modules/developer_guide/widget.php
===================================================================
--- doc/modules/developer_guide/widget.php	(revision 4694)
+++ doc/modules/developer_guide/widget.php	(working copy)
@@ -400,4 +400,4 @@
 
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/modules/developer_guide/withdata.php
===================================================================
--- doc/modules/developer_guide/withdata.php	(revision 4694)
+++ doc/modules/developer_guide/withdata.php	(working copy)
@@ -333,4 +333,4 @@
 
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/modules/developer_guide/javascript.php
===================================================================
--- doc/modules/developer_guide/javascript.php	(revision 4694)
+++ doc/modules/developer_guide/javascript.php	(working copy)
@@ -149,4 +149,4 @@
 
 
 
-*/
\ No newline at end of file
+*/
Index: doc/modules/developer_guide/css.php
===================================================================
--- doc/modules/developer_guide/css.php	(revision 4694)
+++ doc/modules/developer_guide/css.php	(working copy)
@@ -150,4 +150,4 @@
 - Previous @ref module_developer_guide_javascript
 - Next @ref module_developer_guide_widget
 
-*/
\ No newline at end of file
+*/
Index: doc/modules/developer_guide.php
===================================================================
--- doc/modules/developer_guide.php	(revision 4694)
+++ doc/modules/developer_guide.php	(working copy)
@@ -19,4 +19,4 @@
 
 
 */
-?>
\ No newline at end of file
+?>
Index: doc/synopsis.php
===================================================================
--- doc/synopsis.php	(revision 4694)
+++ doc/synopsis.php	(working copy)
@@ -28,4 +28,4 @@
 
 
 */
-?>
\ No newline at end of file
+?>
Index: lib/Smarty/internals/core.write_file.php
===================================================================
--- lib/Smarty/internals/core.write_file.php	(revision 4694)
+++ lib/Smarty/internals/core.write_file.php	(working copy)
@@ -51,4 +51,4 @@
 
 /* vim: set expandtab: */
 
-?>
\ No newline at end of file
+?>
Index: lib/Smarty/plugins/modifier.escape.php
===================================================================
--- lib/Smarty/plugins/modifier.escape.php	(revision 4694)
+++ lib/Smarty/plugins/modifier.escape.php	(working copy)
@@ -23,7 +23,7 @@
 {
     switch ($esc_type) {
         case 'html':
-            return htmlspecialchars($string, ENT_QUOTES, $char_set);
+            return df_escape($string, ENT_QUOTES, $char_set);
 
         case 'htmlall':
             return htmlentities($string, ENT_QUOTES, $char_set);
Index: lib/Smarty/plugins/modifier.debug_print_var.php
===================================================================
--- lib/Smarty/plugins/modifier.debug_print_var.php	(revision 4694)
+++ lib/Smarty/plugins/modifier.debug_print_var.php	(working copy)
@@ -58,20 +58,20 @@
             } elseif (null === $var) {
                 $results = 'null';
             } else {
-                $results = htmlspecialchars((string) $var);
+                $results = df_escape((string) $var);
             }
             $results = '<i>' . $results . '</i>';
             break;
         case 'integer' :
         case 'float' :
-            $results = htmlspecialchars((string) $var);
+            $results = df_escape((string) $var);
             break;
         case 'string' :
             $results = strtr($var, $_replace);
             if (strlen($var) > $length ) {
                 $results = substr($var, 0, $length - 3) . '...';
             }
-            $results = htmlspecialchars('"' . $results . '"');
+            $results = df_escape('"' . $results . '"');
             break;
         case 'unknown type' :
         default :
@@ -79,7 +79,7 @@
             if (strlen($results) > $length ) {
                 $results = substr($results, 0, $length - 3) . '...';
             }
-            $results = htmlspecialchars($results);
+            $results = df_escape($results);
     }
 
     return $results;
Index: lib/Smarty/plugins/block.collapsible_sidebar.php
===================================================================
--- lib/Smarty/plugins/block.collapsible_sidebar.php	(revision 4694)
+++ lib/Smarty/plugins/block.collapsible_sidebar.php	(working copy)
@@ -163,12 +163,12 @@
     $expansionImage = "<img src=\"$expandImage\" style=\"cursor: pointer\" class=\"expansion-handle\" alt=\"Click to minimize this section\"> ";
     
     if ( isset($section_name) ){
-    	$section_name = 'df:section_name="'.htmlspecialchars($section_name).'"';
+    	$section_name = 'df:section_name="'.df_escape($section_name).'"';
     }
     
     if ( isset($params['movable']) ) {
     	$class .= ' movable-handle';
-    	$out .= '<div class="movable" id="'.htmlspecialchars($id).'" '.$section_name.' oncollapse="'.htmlspecialchars($oncollapse).'" onexpand="'.htmlspecialchars($onexpand).'">';
+    	$out .= '<div class="movable" id="'.df_escape($id).'" '.$section_name.' oncollapse="'.df_escape($oncollapse).'" onexpand="'.df_escape($onexpand).'">';
     }
     
     if ( @$params['display'] == 'collapsed' ){
Index: lib/Smarty/plugins/shared.escape_special_chars.php
===================================================================
--- lib/Smarty/plugins/shared.escape_special_chars.php	(revision 4694)
+++ lib/Smarty/plugins/shared.escape_special_chars.php	(working copy)
@@ -20,7 +20,7 @@
 {
     if(!is_array($string)) {
         $string = preg_replace('!&(#?\w+);!', '%%%SMARTY_START%%%\\1%%%SMARTY_END%%%', $string);
-        $string = htmlspecialchars($string);
+        $string = df_escape($string);
         $string = str_replace(array('%%%SMARTY_START%%%','%%%SMARTY_END%%%'), array('&',';'), $string);
     }
     return $string;
Index: lib/Smarty/Smarty_Compiler.class.php
===================================================================
--- lib/Smarty/Smarty_Compiler.class.php	(revision 4694)
+++ lib/Smarty/Smarty_Compiler.class.php	(working copy)
@@ -292,7 +292,7 @@
                         $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', '<?php echo \''.str_replace("'", "\'", $sp_match[1][$curr_sp]).'\'; ?>'."\n", $text_blocks[$curr_tb]);
                     } else if ($this->php_handling == SMARTY_PHP_QUOTE) {
                         /* quote php tags */
-                        $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', htmlspecialchars($sp_match[1][$curr_sp]), $text_blocks[$curr_tb]);
+                        $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', df_escape($sp_match[1][$curr_sp]), $text_blocks[$curr_tb]);
                     } else if ($this->php_handling == SMARTY_PHP_REMOVE) {
                         /* remove php tags */
                         $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', '', $text_blocks[$curr_tb]);
Index: lib/Event/tests/test.php
===================================================================
--- lib/Event/tests/test.php	(revision 4694)
+++ lib/Event/tests/test.php	(working copy)
@@ -32,4 +32,4 @@
 
 $suite->run($result);
 
-?>
\ No newline at end of file
+?>
Index: lib/Event/tests/Dispatcher_testcase.php
===================================================================
--- lib/Event/tests/Dispatcher_testcase.php	(revision 4694)
+++ lib/Event/tests/Dispatcher_testcase.php	(working copy)
@@ -148,4 +148,4 @@
 
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Event/tests/Console_TestListener.php
===================================================================
--- lib/Event/tests/Console_TestListener.php	(revision 4694)
+++ lib/Event/tests/Console_TestListener.php	(working copy)
@@ -35,4 +35,4 @@
         echo get_class($test) . " : Starting " . $test->getName() .  " ...";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Event/Dispatcher.php
===================================================================
--- lib/Event/Dispatcher.php	(revision 4694)
+++ lib/Event/Dispatcher.php	(working copy)
@@ -475,4 +475,4 @@
     }
 
 }
-?>
\ No newline at end of file
+?>
Index: lib/Event/Notification.php
===================================================================
--- lib/Event/Notification.php	(revision 4694)
+++ lib/Event/Notification.php	(working copy)
@@ -191,4 +191,4 @@
         return ($this->_notificationState === EVENT_NOTIFICATION_STATE_CANCELLED);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Event/examples/notification-class.php
===================================================================
--- lib/Event/examples/notification-class.php	(revision 4694)
+++ lib/Event/examples/notification-class.php	(working copy)
@@ -73,4 +73,4 @@
 
 echo '<br />sender2->foo()<br />';
 $sender2->foo();
-?>
\ No newline at end of file
+?>
Index: lib/Event/examples/debugging.php
===================================================================
--- lib/Event/examples/debugging.php	(revision 4694)
+++ lib/Event/examples/debugging.php	(working copy)
@@ -47,4 +47,4 @@
 print_r($observers);
 echo '</pre>';
 
-?>
\ No newline at end of file
+?>
Index: lib/Event/examples/bubbling.php
===================================================================
--- lib/Event/examples/bubbling.php	(revision 4694)
+++ lib/Event/examples/bubbling.php	(working copy)
@@ -112,4 +112,4 @@
 echo '<br />';
 echo 'sender2->foo()<br />';
 $sender2->foo();
-?>
\ No newline at end of file
+?>
Index: lib/Event/examples/cancel.php
===================================================================
--- lib/Event/examples/cancel.php	(revision 4694)
+++ lib/Event/examples/cancel.php	(working copy)
@@ -57,4 +57,4 @@
 $dispatcher->addObserver('receiver2', 'onFoo');
 
 $sender->foo();
-?>
\ No newline at end of file
+?>
Index: lib/Event/examples/object.php
===================================================================
--- lib/Event/examples/object.php	(revision 4694)
+++ lib/Event/examples/object.php	(working copy)
@@ -60,4 +60,4 @@
 
 echo 'sender->foo()<br />';
 $sender->foo();
-?>
\ No newline at end of file
+?>
Index: lib/GoogleTranslate.class.php
===================================================================
--- lib/GoogleTranslate.class.php	(revision 4694)
+++ lib/GoogleTranslate.class.php	(working copy)
@@ -352,4 +352,4 @@
 
 
 } //GoogleTranslate
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/using_I18Nv2_Locale.php
===================================================================
--- lib/I18Nv2/docs/examples/using_I18Nv2_Locale.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/using_I18Nv2_Locale.php	(working copy)
@@ -37,4 +37,4 @@
 echo "Format current time:             ",
     $locale->formatTime(null, I18Nv2_DATETIME_SHORT), "\n";
 
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/setting_a_locale.php
===================================================================
--- lib/I18Nv2/docs/examples/setting_a_locale.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/setting_a_locale.php	(working copy)
@@ -24,4 +24,4 @@
     die("Locale '$locale' not available!\n");
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/using_I18Nv2_Country.php
===================================================================
--- lib/I18Nv2/docs/examples/using_I18Nv2_Country.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/using_I18Nv2_Country.php	(working copy)
@@ -19,4 +19,4 @@
 echo "German name for Italia:        ",
     $country->getName('it'), "\n";
 
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/using_I18Nv2_Language.php
===================================================================
--- lib/I18Nv2/docs/examples/using_I18Nv2_Language.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/using_I18Nv2_Language.php	(working copy)
@@ -18,4 +18,4 @@
 
 echo "Italian name for French:  ",
     $lang->getName('fr'), "\n";
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/retrieving_locale_conventions.php
===================================================================
--- lib/I18Nv2/docs/examples/retrieving_locale_conventions.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/retrieving_locale_conventions.php	(working copy)
@@ -19,4 +19,4 @@
 echo "The decimal point for the french locale is '$dec_point'.\n";
 echo "I18Nv2::getInfo() called without parameter returns all available information:\n";
 print_r(I18Nv2::getInfo());
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/using_I18Nv2_DecoratedList.php
===================================================================
--- lib/I18Nv2/docs/examples/using_I18Nv2_DecoratedList.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/using_I18Nv2_DecoratedList.php	(working copy)
@@ -26,4 +26,4 @@
 
 // print a HTML safe select box
 echo $s->getAllCodes();
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/transform_output_charset.php
===================================================================
--- lib/I18Nv2/docs/examples/transform_output_charset.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/transform_output_charset.php	(working copy)
@@ -20,4 +20,4 @@
 // output some latin1 stuff
 echo "\n";
 
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/docs/examples/using_I18Nv2_Negotiator.php
===================================================================
--- lib/I18Nv2/docs/examples/using_I18Nv2_Negotiator.php	(revision 4694)
+++ lib/I18Nv2/docs/examples/using_I18Nv2_Negotiator.php	(working copy)
@@ -28,4 +28,4 @@
 echo "User agents preferred charset:                   ",
     $neg->getCharsetMatch(), "\n";
 
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/fr_FR.php
===================================================================
--- lib/I18Nv2/Locale/fr_FR.php	(revision 4694)
+++ lib/I18Nv2/Locale/fr_FR.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/es_ES.php
===================================================================
--- lib/I18Nv2/Locale/es_ES.php	(revision 4694)
+++ lib/I18Nv2/Locale/es_ES.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/nb.php
===================================================================
--- lib/I18Nv2/Locale/nb.php	(revision 4694)
+++ lib/I18Nv2/Locale/nb.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/no.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/de_DE.php
===================================================================
--- lib/I18Nv2/Locale/de_DE.php	(revision 4694)
+++ lib/I18Nv2/Locale/de_DE.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/nl_NL.php
===================================================================
--- lib/I18Nv2/Locale/nl_NL.php	(revision 4694)
+++ lib/I18Nv2/Locale/nl_NL.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/sv_FI.php
===================================================================
--- lib/I18Nv2/Locale/sv_FI.php	(revision 4694)
+++ lib/I18Nv2/Locale/sv_FI.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/fr_LU.php
===================================================================
--- lib/I18Nv2/Locale/fr_LU.php	(revision 4694)
+++ lib/I18Nv2/Locale/fr_LU.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/fr.php
===================================================================
--- lib/I18Nv2/Locale/fr.php	(revision 4694)
+++ lib/I18Nv2/Locale/fr.php	(working copy)
@@ -17,4 +17,4 @@
     I18Nv2_DATETIME_LONG      =>  '%H:%M:%S %Z',
     I18Nv2_DATETIME_FULL      =>  '%H:%M %Z'
 );
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/nl.php
===================================================================
--- lib/I18Nv2/Locale/nl.php	(revision 4694)
+++ lib/I18Nv2/Locale/nl.php	(working copy)
@@ -17,4 +17,4 @@
     I18Nv2_DATETIME_LONG      =>  '%H:%M:%S %Z',
     I18Nv2_DATETIME_FULL      =>  '%H:%M %Z'
 );
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/nn.php
===================================================================
--- lib/I18Nv2/Locale/nn.php	(revision 4694)
+++ lib/I18Nv2/Locale/nn.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/no.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/no.php
===================================================================
--- lib/I18Nv2/Locale/no.php	(revision 4694)
+++ lib/I18Nv2/Locale/no.php	(working copy)
@@ -18,4 +18,4 @@
     I18Nv2_DATETIME_LONG      =>  '%H:%M:%S %Z',
     I18Nv2_DATETIME_FULL      =>  'kl %H.%M %Z'
 );
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/fi_FI.php
===================================================================
--- lib/I18Nv2/Locale/fi_FI.php	(revision 4694)
+++ lib/I18Nv2/Locale/fi_FI.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/en_IE.php
===================================================================
--- lib/I18Nv2/Locale/en_IE.php	(revision 4694)
+++ lib/I18Nv2/Locale/en_IE.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/pt.php
===================================================================
--- lib/I18Nv2/Locale/pt.php	(revision 4694)
+++ lib/I18Nv2/Locale/pt.php	(working copy)
@@ -17,4 +17,4 @@
     I18Nv2_DATETIME_LONG      =>  '%H:%M:%S %Z',
     I18Nv2_DATETIME_FULL      =>  '%H:%M %Z'
 );
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/fr_MC.php
===================================================================
--- lib/I18Nv2/Locale/fr_MC.php	(revision 4694)
+++ lib/I18Nv2/Locale/fr_MC.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/pt_PT.php
===================================================================
--- lib/I18Nv2/Locale/pt_PT.php	(revision 4694)
+++ lib/I18Nv2/Locale/pt_PT.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/el_GR.php
===================================================================
--- lib/I18Nv2/Locale/el_GR.php	(revision 4694)
+++ lib/I18Nv2/Locale/el_GR.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/Windows.php
===================================================================
--- lib/I18Nv2/Locale/Windows.php	(revision 4694)
+++ lib/I18Nv2/Locale/Windows.php	(working copy)
@@ -85,4 +85,4 @@
     'cs_CZ' => 'csy',
 );
 
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/it_IT.php
===================================================================
--- lib/I18Nv2/Locale/it_IT.php	(revision 4694)
+++ lib/I18Nv2/Locale/it_IT.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/de_AT.php
===================================================================
--- lib/I18Nv2/Locale/de_AT.php	(revision 4694)
+++ lib/I18Nv2/Locale/de_AT.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/fr_BE.php
===================================================================
--- lib/I18Nv2/Locale/fr_BE.php	(revision 4694)
+++ lib/I18Nv2/Locale/fr_BE.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/Locale/nl_BE.php
===================================================================
--- lib/I18Nv2/Locale/nl_BE.php	(revision 4694)
+++ lib/I18Nv2/Locale/nl_BE.php	(working copy)
@@ -4,4 +4,4 @@
 */
 
 include 'I18Nv2/Locale/EUR.php';
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/tests/I18Nv2_Locale-PHPUnit_Testcase.php
===================================================================
--- lib/I18Nv2/tests/I18Nv2_Locale-PHPUnit_Testcase.php	(revision 4694)
+++ lib/I18Nv2/tests/I18Nv2_Locale-PHPUnit_Testcase.php	(working copy)
@@ -201,4 +201,4 @@
 $ts = new PHPUnit_TestSuite('I18Nv2_LocaleTest');
 $rs = PHPUnit::run($ts);
 echo $rs->toString();
-?>
\ No newline at end of file
+?>
Index: lib/I18Nv2/I18Nv2.php
===================================================================
--- lib/I18Nv2/I18Nv2.php	(revision 4694)
+++ lib/I18Nv2/I18Nv2.php	(working copy)
@@ -440,4 +440,4 @@
 
 I18Nv2::_main();
 
-?>
\ No newline at end of file
+?>
Index: lib/PHPUnit/GUI/HTML.php
===================================================================
--- lib/PHPUnit/GUI/HTML.php	(revision 4694)
+++ lib/PHPUnit/GUI/HTML.php	(working copy)
@@ -182,21 +182,21 @@
         if (preg_match('/^(.*)expected ' . $serialized . ', actual ' . $serialized . '$/sU', $exception, $matches)) {
             ob_start();
             print_r(unserialize($matches[2]));
-            $ret['expected'] = htmlspecialchars($matches[1]) . "<pre>" . htmlspecialchars(rtrim(ob_get_contents())) . "</pre>";
+            $ret['expected'] = df_escape($matches[1]) . "<pre>" . df_escape(rtrim(ob_get_contents())) . "</pre>";
             // Improved compatibility, ob_clean() would be PHP >= 4.2.0 only.
             ob_end_clean();
 
             ob_start();
             print_r(unserialize($matches[3]));
-            $ret['actual'] = htmlspecialchars($matches[1]) . "<pre>" . htmlspecialchars(rtrim(ob_get_contents())) . "</pre>";
+            $ret['actual'] = df_escape($matches[1]) . "<pre>" . df_escape(rtrim(ob_get_contents())) . "</pre>";
             ob_end_clean();
         }
 
         else if (preg_match('/^(.*)expected (.*), actual (.*)$/sU', $exception, $matches)) {
-            $ret['expected'] = nl2br(str_replace(" ", "&nbsp;", htmlspecialchars($matches[1] . $matches[2])));
-            $ret['actual'] = nl2br(str_replace(" ", "&nbsp;", htmlspecialchars($matches[1] . $matches[3])));
+            $ret['expected'] = nl2br(str_replace(" ", "&nbsp;", df_escape($matches[1] . $matches[2])));
+            $ret['actual'] = nl2br(str_replace(" ", "&nbsp;", df_escape($matches[1] . $matches[3])));
         } else {
-            $ret['message'] = nl2br(str_replace(" ", "&nbsp;", htmlspecialchars($exception)));
+            $ret['message'] = nl2br(str_replace(" ", "&nbsp;", df_escape($exception)));
         }
 
         return $ret;
Index: lib/PHPUnit/TestResult.php
===================================================================
--- lib/PHPUnit/TestResult.php	(revision 4694)
+++ lib/PHPUnit/TestResult.php	(working copy)
@@ -268,7 +268,7 @@
      * @access public
      */
     function toHTML() {
-        return '<pre>' . htmlspecialchars($this->toString()) . '</pre>';
+        return '<pre>' . df_escape($this->toString()) . '</pre>';
     }
 
     /**
Index: lib/SQL/Compiler.php
===================================================================
--- lib/SQL/Compiler.php	(revision 4694)
+++ lib/SQL/Compiler.php	(working copy)
@@ -706,4 +706,4 @@
 	}
 
 }
-?>
\ No newline at end of file
+?>
Index: lib/SQL/Dialect_MySQL.php
===================================================================
--- lib/SQL/Dialect_MySQL.php	(revision 4694)
+++ lib/SQL/Dialect_MySQL.php	(working copy)
@@ -208,4 +208,4 @@
 
 'units' => array('microsecond','second','minute','hour','day','week','month','quarter','year','second_microsecond','minute_microsecond','hour_microsecond','hour_second','hour_minute','day_microsecond','day_second','day_minute','day_hour','year_month')
 );
-?>
\ No newline at end of file
+?>
Index: lib/SQL/Compiler/mysql.php
===================================================================
--- lib/SQL/Compiler/mysql.php	(revision 4694)
+++ lib/SQL/Compiler/mysql.php	(working copy)
@@ -52,4 +52,4 @@
 	
 
 
-}?>
\ No newline at end of file
+}?>
Index: lib/XML/Serializer.php
===================================================================
--- lib/XML/Serializer.php	(revision 4694)
+++ lib/XML/Serializer.php	(working copy)
@@ -1022,4 +1022,4 @@
         return  $tag;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/XML/Parser.php
===================================================================
--- lib/XML/Parser.php	(revision 4694)
+++ lib/XML/Parser.php	(working copy)
@@ -682,4 +682,4 @@
     }
     // }}}
 }
-?>
\ No newline at end of file
+?>
Index: lib/XML/Unserializer.php
===================================================================
--- lib/XML/Unserializer.php	(revision 4694)
+++ lib/XML/Unserializer.php	(working copy)
@@ -853,4 +853,4 @@
         return true;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/XML/Util.php
===================================================================
--- lib/XML/Util.php	(revision 4694)
+++ lib/XML/Util.php	(working copy)
@@ -740,4 +740,4 @@
         return PEAR::raiseError($msg, $code);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/XML/RSS.php
===================================================================
--- lib/XML/RSS.php	(revision 4694)
+++ lib/XML/RSS.php	(working copy)
@@ -405,4 +405,4 @@
     // }}}
 
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Simple.php
===================================================================
--- lib/Perm/Simple.php	(revision 4694)
+++ lib/Perm/Simple.php	(working copy)
@@ -323,4 +323,4 @@
         $this->_storage->disconnect();
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage/SQL.php
===================================================================
--- lib/Perm/Storage/SQL.php	(revision 4694)
+++ lib/Perm/Storage/SQL.php	(working copy)
@@ -110,4 +110,4 @@
         return true;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage/XML.php
===================================================================
--- lib/Perm/Storage/XML.php	(revision 4694)
+++ lib/Perm/Storage/XML.php	(working copy)
@@ -220,4 +220,4 @@
         $this->userObj = null;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage/MDB.php
===================================================================
--- lib/Perm/Storage/MDB.php	(revision 4694)
+++ lib/Perm/Storage/MDB.php	(working copy)
@@ -448,4 +448,4 @@
         return $result;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage/Cache.php
===================================================================
--- lib/Perm/Storage/Cache.php	(revision 4694)
+++ lib/Perm/Storage/Cache.php	(working copy)
@@ -266,4 +266,4 @@
         $this->_storage->disconnect();
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage/Globals.php
===================================================================
--- lib/Perm/Storage/Globals.php	(revision 4694)
+++ lib/Perm/Storage/Globals.php	(working copy)
@@ -290,4 +290,4 @@
     'translations' => 'translations',
 );
 
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage/MDB2.php
===================================================================
--- lib/Perm/Storage/MDB2.php	(revision 4694)
+++ lib/Perm/Storage/MDB2.php	(working copy)
@@ -449,4 +449,4 @@
         return (array)$result;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage/DB.php
===================================================================
--- lib/Perm/Storage/DB.php	(revision 4694)
+++ lib/Perm/Storage/DB.php	(working copy)
@@ -420,4 +420,4 @@
         return $result;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Medium.php
===================================================================
--- lib/Perm/Medium.php	(revision 4694)
+++ lib/Perm/Medium.php	(working copy)
@@ -221,4 +221,4 @@
         return false;
     } // end func checkGroup
 } // end class LiveUser_Perm_Container_MDB2_Medium
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Storage.php
===================================================================
--- lib/Perm/Storage.php	(revision 4694)
+++ lib/Perm/Storage.php	(working copy)
@@ -254,4 +254,4 @@
     {
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Perm/Complex.php
===================================================================
--- lib/Perm/Complex.php	(revision 4694)
+++ lib/Perm/Complex.php	(working copy)
@@ -292,4 +292,4 @@
         return $this->area_admin_areas;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/element.php
===================================================================
--- lib/HTML/QuickForm/element.php	(revision 4694)
+++ lib/HTML/QuickForm/element.php	(working copy)
@@ -239,7 +239,7 @@
     function getFrozenHtml()
     {
         $value = $this->getValue();
-        return ('' != $value? htmlspecialchars($value): '&nbsp;') .
+        return ('' != $value? df_escape($value): '&nbsp;') .
                $this->_getPersistantData();
     } //end func getFrozenHtml
     
@@ -535,4 +535,4 @@
     }
     // }}}
 } // end class HTML_QuickForm_element
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/group.php
===================================================================
--- lib/HTML/QuickForm/group.php	(revision 4694)
+++ lib/HTML/QuickForm/group.php	(working copy)
@@ -576,4 +576,4 @@
 
     // }}}
 } //end class HTML_QuickForm_group
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Rule.php
===================================================================
--- lib/HTML/QuickForm/Rule.php	(revision 4694)
+++ lib/HTML/QuickForm/Rule.php	(working copy)
@@ -64,4 +64,4 @@
         return array('', '');
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/textarea.php
===================================================================
--- lib/HTML/QuickForm/textarea.php	(revision 4694)
+++ lib/HTML/QuickForm/textarea.php	(working copy)
@@ -207,7 +207,7 @@
             return $this->_getTabs() .
                    '<textarea' . $this->_getAttrString($this->_attributes) . $freezeAtt . '>' .
                    // because we wrap the form later we don't want the text indented
-                   preg_replace("/(\r\n|\n|\r)/", '&#010;', htmlspecialchars($this->_value)) .
+                   preg_replace("/(\r\n|\n|\r)/", '&#010;', df_escape($this->_value)) .
                    '</textarea>';
         }
     } //end func toHtml
@@ -224,7 +224,7 @@
      */
     function getFrozenHtml()
     {
-        $value = htmlspecialchars($this->getValue());
+        $value = df_escape($this->getValue());
         if ($this->getAttribute('wrap') == 'off') {
             $html = $this->_getTabs() . '<pre>' . $value."</pre>\n";
         } else {
Index: lib/HTML/QuickForm/date.php
===================================================================
--- lib/HTML/QuickForm/date.php	(revision 4694)
+++ lib/HTML/QuickForm/date.php	(working copy)
@@ -487,4 +487,4 @@
 
     // }}}
 }
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Rule/Regex.php
===================================================================
--- lib/HTML/QuickForm/Rule/Regex.php	(revision 4694)
+++ lib/HTML/QuickForm/Rule/Regex.php	(working copy)
@@ -86,4 +86,4 @@
     } // end func getValidationScript
 
 } // end class HTML_QuickForm_Rule_Regex
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Rule/Callback.php
===================================================================
--- lib/HTML/QuickForm/Rule/Callback.php	(revision 4694)
+++ lib/HTML/QuickForm/Rule/Callback.php	(working copy)
@@ -110,4 +110,4 @@
     } // end func getValidationScript
 
 } // end class HTML_QuickForm_Rule_Callback
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Rule/Range.php
===================================================================
--- lib/HTML/QuickForm/Rule/Range.php	(revision 4694)
+++ lib/HTML/QuickForm/Rule/Range.php	(working copy)
@@ -61,4 +61,4 @@
     } // end func getValidationScript
 
 } // end class HTML_QuickForm_Rule_Range
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Rule/Email.php
===================================================================
--- lib/HTML/QuickForm/Rule/Email.php	(revision 4694)
+++ lib/HTML/QuickForm/Rule/Email.php	(working copy)
@@ -58,4 +58,4 @@
     } // end func getValidationScript
 
 } // end class HTML_QuickForm_Rule_Email
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/advmultiselect.php
===================================================================
--- lib/HTML/QuickForm/advmultiselect.php	(revision 4694)
+++ lib/HTML/QuickForm/advmultiselect.php	(working copy)
@@ -857,4 +857,4 @@
 if (class_exists('HTML_QuickForm')) {
     HTML_QuickForm::registerElementType('advmultiselect', 'HTML/QuickForm/advmultiselect.php', 'HTML_QuickForm_advmultiselect');
 }
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Renderer/Array.php
===================================================================
--- lib/HTML/QuickForm/Renderer/Array.php	(revision 4694)
+++ lib/HTML/QuickForm/Renderer/Array.php	(working copy)
@@ -344,4 +344,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Renderer/ArraySmarty.php
===================================================================
--- lib/HTML/QuickForm/Renderer/ArraySmarty.php	(revision 4694)
+++ lib/HTML/QuickForm/Renderer/ArraySmarty.php	(working copy)
@@ -373,4 +373,4 @@
         $this->_error = $template;
     } // end func setErrorTemplate
 }
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Renderer/Default.php
===================================================================
--- lib/HTML/QuickForm/Renderer/Default.php	(revision 4694)
+++ lib/HTML/QuickForm/Renderer/Default.php	(working copy)
@@ -473,4 +473,4 @@
         $this->_templates = array();
     } // end func clearAllTemplates
 } // end class HTML_QuickForm_Renderer_Default
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/Renderer/ITStatic.php
===================================================================
--- lib/HTML/QuickForm/Renderer/ITStatic.php	(revision 4694)
+++ lib/HTML/QuickForm/Renderer/ITStatic.php	(working copy)
@@ -487,4 +487,4 @@
         return $ret;
     }
 } // end class HTML_QuickForm_Renderer_ITStatic
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm/hierselect.php
===================================================================
--- lib/HTML/QuickForm/hierselect.php	(revision 4694)
+++ lib/HTML/QuickForm/hierselect.php	(working copy)
@@ -562,4 +562,4 @@
 
     // }}}
 } // end class HTML_QuickForm_hierselect
-?>
\ No newline at end of file
+?>
Index: lib/HTML/QuickForm.php
===================================================================
--- lib/HTML/QuickForm.php	(revision 4694)
+++ lib/HTML/QuickForm.php	(working copy)
@@ -2018,4 +2018,4 @@
 
     // }}}
 } // end class HTML_QuickForm_Error
-?>
\ No newline at end of file
+?>
Index: lib/HTML/Common.php
===================================================================
--- lib/HTML/Common.php	(revision 4694)
+++ lib/HTML/Common.php	(working copy)
@@ -137,7 +137,7 @@
 
         if (is_array($attributes)) {
             foreach ($attributes as $key => $value) {
-                $strAttr .= ' ' . $key . '="' . htmlspecialchars($value) . '"';
+                $strAttr .= ' ' . $key . '="' . df_escape($value) . '"';
             }
         }
         return $strAttr;
@@ -416,4 +416,4 @@
     } // end func display
 
 } // end class HTML_Common
-?>
\ No newline at end of file
+?>
Index: lib/jscalendar/test.php
===================================================================
--- lib/jscalendar/test.php	(revision 4694)
+++ lib/jscalendar/test.php	(working copy)
@@ -48,7 +48,7 @@
 <h1>Form submitted</h1>
 
 <?php foreach ($_REQUEST as $key => $val) {
-    echo htmlspecialchars($key) . ' = ' . htmlspecialchars($val) . '<br />';
+    echo df_escape($key) . ' = ' . df_escape($val) . '<br />';
 } ?>
 
 <?php } else { ?>
Index: lib/jscalendar/calendar.php
===================================================================
--- lib/jscalendar/calendar.php	(revision 4694)
+++ lib/jscalendar/calendar.php	(working copy)
@@ -120,4 +120,4 @@
     }
 };
 
-?>
\ No newline at end of file
+?>
Index: lib/xml2array.php
===================================================================
--- lib/xml2array.php	(revision 4694)
+++ lib/xml2array.php	(working copy)
@@ -130,4 +130,4 @@
 //print_r($data);
 
 
-?>
\ No newline at end of file
+?>
Index: lib/babelfish.class.php
===================================================================
--- lib/babelfish.class.php	(revision 4694)
+++ lib/babelfish.class.php	(working copy)
@@ -117,4 +117,4 @@
     }
 }
 /* end of class */
-?>
\ No newline at end of file
+?>
Index: lib/FCKeditor/editor/filemanager/connectors/php/connector.php
===================================================================
--- lib/FCKeditor/editor/filemanager/connectors/php/connector.php	(revision 4694)
+++ lib/FCKeditor/editor/filemanager/connectors/php/connector.php	(working copy)
@@ -84,4 +84,4 @@
 
 	exit ;
 }
-?>
\ No newline at end of file
+?>
Index: lib/FCKeditor/editor/filemanager/connectors/php/basexml.php
===================================================================
--- lib/FCKeditor/editor/filemanager/connectors/php/basexml.php	(revision 4694)
+++ lib/FCKeditor/editor/filemanager/connectors/php/basexml.php	(working copy)
@@ -88,6 +88,6 @@
 
 function SendErrorNode(  $number, $text )
 {
-	echo '<Error number="' . $number . '" text="' . htmlspecialchars( $text ) . '" />' ;
+	echo '<Error number="' . $number . '" text="' . df_escape( $text ) . '" />' ;
 }
-?>
\ No newline at end of file
+?>
Index: lib/FCKeditor/editor/filemanager/connectors/php/phpcompat.php
===================================================================
--- lib/FCKeditor/editor/filemanager/connectors/php/phpcompat.php	(revision 4694)
+++ lib/FCKeditor/editor/filemanager/connectors/php/phpcompat.php	(working copy)
@@ -14,4 +14,4 @@
     define( 'DIRECTORY_SEPARATOR',
         strtoupper(substr(PHP_OS, 0, 3) == 'WIN') ? '\\' : '/'
     ) ;
-}
\ No newline at end of file
+}
Index: lib/FCKeditor/editor/filemanager/connectors/php/util.php
===================================================================
--- lib/FCKeditor/editor/filemanager/connectors/php/util.php	(revision 4694)
+++ lib/FCKeditor/editor/filemanager/connectors/php/util.php	(working copy)
@@ -47,11 +47,11 @@
 	
 	if ( strtoupper( substr( $os, 0, 3 ) ) === 'WIN' ) 
 	{
-		return ( utf8_encode( htmlspecialchars( $value ) ) ) ;
+		return ( utf8_encode( df_escape( $value ) ) ) ;
 	} 
 	else 
 	{
-		return ( htmlspecialchars( $value ) ) ;
+		return ( df_escape( $value ) ) ;
 	}	
 }
 
@@ -182,4 +182,4 @@
 	return true;
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/FCKeditor/editor/filemanager/connectors/php/commands.php
===================================================================
--- lib/FCKeditor/editor/filemanager/connectors/php/commands.php	(revision 4694)
+++ lib/FCKeditor/editor/filemanager/connectors/php/commands.php	(working copy)
@@ -242,4 +242,4 @@
 
 	exit ;
 }
-?>
\ No newline at end of file
+?>
Index: lib/FCKeditor/editor/filemanager/connectors/php/upload.php
===================================================================
--- lib/FCKeditor/editor/filemanager/connectors/php/upload.php	(revision 4694)
+++ lib/FCKeditor/editor/filemanager/connectors/php/upload.php	(working copy)
@@ -56,4 +56,4 @@
 
 FileUpload( $sType, $sCurrentFolder, $sCommand )
 
-?>
\ No newline at end of file
+?>
Index: lib/FCKeditor/editor/filemanager/connectors/php/io.php
===================================================================
--- lib/FCKeditor/editor/filemanager/connectors/php/io.php	(revision 4694)
+++ lib/FCKeditor/editor/filemanager/connectors/php/io.php	(working copy)
@@ -269,4 +269,4 @@
 	exit ;
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/FCKeditor/fckeditor_php4.php
===================================================================
--- lib/FCKeditor/fckeditor_php4.php	(revision 4694)
+++ lib/FCKeditor/fckeditor_php4.php	(working copy)
@@ -55,7 +55,7 @@
 
 	function CreateHtml()
 	{
-		$HtmlValue = htmlspecialchars( $this->Value ) ;
+		$HtmlValue = df_escape( $this->Value ) ;
 
 		$Html = '<div>' ;
 		
Index: lib/FCKeditor/fckeditor_php5.php
===================================================================
--- lib/FCKeditor/fckeditor_php5.php	(revision 4694)
+++ lib/FCKeditor/fckeditor_php5.php	(working copy)
@@ -55,7 +55,7 @@
 
 	function CreateHtml()
 	{
-		$HtmlValue = htmlspecialchars( $this->Value ) ;
+		$HtmlValue = df_escape( $this->Value ) ;
 
 		$Html = '<div>' ;
 
@@ -139,4 +139,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/str_tools.php
===================================================================
--- lib/str_tools.php	(revision 4694)
+++ lib/str_tools.php	(working copy)
@@ -29,4 +29,4 @@
     return $key; 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/mysql_functions.php
===================================================================
--- lib/mysql_functions.php	(revision 4694)
+++ lib/mysql_functions.php	(working copy)
@@ -118,4 +118,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Highlighter/SQL.php
===================================================================
--- lib/Text/Highlighter/SQL.php	(revision 4694)
+++ lib/Text/Highlighter/SQL.php	(working copy)
@@ -416,4 +416,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/XML.php
===================================================================
--- lib/Text/Highlighter/XML.php	(revision 4694)
+++ lib/Text/Highlighter/XML.php	(working copy)
@@ -260,4 +260,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/PERL.php
===================================================================
--- lib/Text/Highlighter/PERL.php	(revision 4694)
+++ lib/Text/Highlighter/PERL.php	(working copy)
@@ -1349,4 +1349,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/HTML.php
===================================================================
--- lib/Text/Highlighter/HTML.php	(revision 4694)
+++ lib/Text/Highlighter/HTML.php	(working copy)
@@ -231,4 +231,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/MYSQL.php
===================================================================
--- lib/Text/Highlighter/MYSQL.php	(revision 4694)
+++ lib/Text/Highlighter/MYSQL.php	(working copy)
@@ -431,4 +431,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/JAVASCRIPT.php
===================================================================
--- lib/Text/Highlighter/JAVASCRIPT.php	(revision 4694)
+++ lib/Text/Highlighter/JAVASCRIPT.php	(working copy)
@@ -687,4 +687,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/DIFF.php
===================================================================
--- lib/Text/Highlighter/DIFF.php	(revision 4694)
+++ lib/Text/Highlighter/DIFF.php	(working copy)
@@ -381,4 +381,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/DTD.php
===================================================================
--- lib/Text/Highlighter/DTD.php	(revision 4694)
+++ lib/Text/Highlighter/DTD.php	(working copy)
@@ -423,4 +423,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/Renderer/Html.php
===================================================================
--- lib/Text/Highlighter/Renderer/Html.php	(revision 4694)
+++ lib/Text/Highlighter/Renderer/Html.php	(working copy)
@@ -155,7 +155,7 @@
     function acceptToken($class, $content)
     {
         $theClass = $this->_getFullClassName($class);
-        $content = htmlspecialchars($content);
+        $content = df_escape($content);
         if (!$this->_output || $class != $this->_lastClass) {
             $tag = '';
             if ($this->_output) {
Index: lib/Text/Highlighter/JAVA.php
===================================================================
--- lib/Text/Highlighter/JAVA.php	(revision 4694)
+++ lib/Text/Highlighter/JAVA.php	(working copy)
@@ -799,4 +799,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/PYTHON.php
===================================================================
--- lib/Text/Highlighter/PYTHON.php	(revision 4694)
+++ lib/Text/Highlighter/PYTHON.php	(working copy)
@@ -644,4 +644,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/RUBY.php
===================================================================
--- lib/Text/Highlighter/RUBY.php	(revision 4694)
+++ lib/Text/Highlighter/RUBY.php	(working copy)
@@ -822,4 +822,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/CPP.php
===================================================================
--- lib/Text/Highlighter/CPP.php	(revision 4694)
+++ lib/Text/Highlighter/CPP.php	(working copy)
@@ -855,4 +855,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/PHP.php
===================================================================
--- lib/Text/Highlighter/PHP.php	(revision 4694)
+++ lib/Text/Highlighter/PHP.php	(working copy)
@@ -1104,4 +1104,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Highlighter/CSS.php
===================================================================
--- lib/Text/Highlighter/CSS.php	(revision 4694)
+++ lib/Text/Highlighter/CSS.php	(working copy)
@@ -398,4 +398,4 @@
         $this->_checkDefines();
     }
     
-}
\ No newline at end of file
+}
Index: lib/Text/Wiki/Render/Xhtml.php
===================================================================
--- lib/Text/Wiki/Render/Xhtml.php	(revision 4694)
+++ lib/Text/Wiki/Render/Xhtml.php	(working copy)
@@ -84,13 +84,13 @@
 
 			// keep a copy of the translated version of the delimiter
 			// so we can convert it back.
-			$new_delim = htmlspecialchars($this->wiki->delim, $quotes,
+			$new_delim = df_escape($this->wiki->delim, $quotes,
 			    $charset);
 
 			// convert the entities.  we silence the call here so that
 			// errors about charsets don't pop up, per counsel from
 			// Jan at Horde.  (http://pear.php.net/bugs/bug.php?id=4474)
-			$text = @htmlspecialchars(
+			$text = @df_escape(
 				$text,
 				$quotes,
 				$charset
Index: lib/Text/Wiki/Render/Plain/Raw.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Raw.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Raw.php	(working copy)
@@ -20,4 +20,4 @@
         return $options['text'];
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Deflist.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Deflist.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Deflist.php	(working copy)
@@ -56,4 +56,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Horiz.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Horiz.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Horiz.php	(working copy)
@@ -20,4 +20,4 @@
         return "\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Prefilter.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Prefilter.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Prefilter.php	(working copy)
@@ -37,4 +37,4 @@
         return '';
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Revise.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Revise.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Revise.php	(working copy)
@@ -21,4 +21,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Freelink.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Freelink.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Freelink.php	(working copy)
@@ -20,4 +20,4 @@
         return $options['text'];
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Heading.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Heading.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Heading.php	(working copy)
@@ -11,4 +11,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Tighten.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Tighten.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Tighten.php	(working copy)
@@ -7,4 +7,4 @@
         return '';
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Paragraph.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Paragraph.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Paragraph.php	(working copy)
@@ -28,4 +28,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Emphasis.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Emphasis.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Emphasis.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Code.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Code.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Code.php	(working copy)
@@ -21,4 +21,4 @@
         return "\n" . $options['text'] . "\n\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Strong.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Strong.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Strong.php	(working copy)
@@ -21,4 +21,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Embed.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Embed.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Embed.php	(working copy)
@@ -20,4 +20,4 @@
         return strip_tags($options['text']);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Delimiter.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Delimiter.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Delimiter.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Center.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Center.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Center.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Image.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Image.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Image.php	(working copy)
@@ -19,4 +19,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Function.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Function.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Function.php	(working copy)
@@ -36,4 +36,4 @@
         return $output;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Newline.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Newline.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Newline.php	(working copy)
@@ -9,4 +9,4 @@
     }
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Url.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Url.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Url.php	(working copy)
@@ -22,4 +22,4 @@
         return $options['text'].(@$options['href']?' ['.$options['href'].']':'');
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Html.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Html.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Html.php	(working copy)
@@ -21,4 +21,4 @@
         return strip_tags($options['text']);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Italic.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Italic.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Italic.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Blockquote.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Blockquote.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Blockquote.php	(working copy)
@@ -36,4 +36,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/List.php
===================================================================
--- lib/Text/Wiki/Render/Plain/List.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/List.php	(working copy)
@@ -65,4 +65,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Bold.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Bold.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Bold.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Phplookup.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Phplookup.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Phplookup.php	(working copy)
@@ -22,4 +22,4 @@
         return trim($options['text']);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Wikilink.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Wikilink.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Wikilink.php	(working copy)
@@ -21,4 +21,4 @@
         return $options['text'];
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Include.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Include.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Include.php	(working copy)
@@ -5,4 +5,4 @@
         return '';
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Colortext.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Colortext.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Colortext.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Superscript.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Superscript.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Superscript.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Break.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Break.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Break.php	(working copy)
@@ -21,4 +21,4 @@
     }
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Toc.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Toc.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Toc.php	(working copy)
@@ -36,4 +36,4 @@
     }
 
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Underline.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Underline.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Underline.php	(working copy)
@@ -20,4 +20,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain/Tt.php
===================================================================
--- lib/Text/Wiki/Render/Plain/Tt.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain/Tt.php	(working copy)
@@ -21,4 +21,4 @@
         return;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex.php
===================================================================
--- lib/Text/Wiki/Render/Latex.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex.php	(working copy)
@@ -87,4 +87,4 @@
     }
     
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Plain.php
===================================================================
--- lib/Text/Wiki/Render/Plain.php	(revision 4694)
+++ lib/Text/Wiki/Render/Plain.php	(working copy)
@@ -13,4 +13,4 @@
     }
     
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Raw.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Raw.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Raw.php	(working copy)
@@ -20,4 +20,4 @@
         return "Raw: ".$options['text'];
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Deflist.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Deflist.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Deflist.php	(working copy)
@@ -50,4 +50,4 @@
             }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Horiz.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Horiz.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Horiz.php	(working copy)
@@ -20,4 +20,4 @@
         return "\n\\noindent\\rule{\\textwidth}{1pt}\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Prefilter.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Prefilter.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Prefilter.php	(working copy)
@@ -37,4 +37,4 @@
         return '';
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Revise.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Revise.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Revise.php	(working copy)
@@ -35,4 +35,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Freelink.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Freelink.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Freelink.php	(working copy)
@@ -31,4 +31,4 @@
         return "$text\\footnote\{$anchor} ";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Heading.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Heading.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Heading.php	(working copy)
@@ -30,4 +30,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Tighten.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Tighten.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Tighten.php	(working copy)
@@ -6,4 +6,4 @@
         return '';
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Paragraph.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Paragraph.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Paragraph.php	(working copy)
@@ -28,4 +28,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Emphasis.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Emphasis.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Emphasis.php	(working copy)
@@ -26,4 +26,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Code.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Code.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Code.php	(working copy)
@@ -23,4 +23,4 @@
         return "\\begin{verbatim}\n$text\n\\end{verbatim}\n\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Strong.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Strong.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Strong.php	(working copy)
@@ -27,4 +27,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Embed.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Embed.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Embed.php	(working copy)
@@ -20,4 +20,4 @@
         return "Embed: ".$options['text'];
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Delimiter.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Delimiter.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Delimiter.php	(working copy)
@@ -22,4 +22,4 @@
         return "Delimiter: ".$options['text'];
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Center.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Center.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Center.php	(working copy)
@@ -30,4 +30,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Image.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Image.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Image.php	(working copy)
@@ -67,4 +67,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Function.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Function.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Function.php	(working copy)
@@ -20,4 +20,4 @@
         return "Function: NI";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Newline.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Newline.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Newline.php	(working copy)
@@ -9,4 +9,4 @@
     }
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Url.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Url.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Url.php	(working copy)
@@ -32,4 +32,4 @@
         return " $text\\footnote\{$href}";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Html.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Html.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Html.php	(working copy)
@@ -22,4 +22,4 @@
         return '';
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Blockquote.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Blockquote.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Blockquote.php	(working copy)
@@ -33,4 +33,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Phplookup.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Phplookup.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Phplookup.php	(working copy)
@@ -31,4 +31,4 @@
         return "<a$target href=\"http://php.net/$text\">$text</a>";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Include.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Include.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Include.php	(working copy)
@@ -5,4 +5,4 @@
         return '';
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Colortext.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Colortext.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Colortext.php	(working copy)
@@ -55,4 +55,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Superscript.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Superscript.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Superscript.php	(working copy)
@@ -28,4 +28,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Break.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Break.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Break.php	(working copy)
@@ -21,4 +21,4 @@
     }
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Toc.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Toc.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Toc.php	(working copy)
@@ -27,4 +27,4 @@
     }
 
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Underline.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Underline.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Underline.php	(working copy)
@@ -27,4 +27,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render/Latex/Tt.php
===================================================================
--- lib/Text/Wiki/Render/Latex/Tt.php	(revision 4694)
+++ lib/Text/Wiki/Render/Latex/Tt.php	(working copy)
@@ -27,4 +27,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Render.php
===================================================================
--- lib/Text/Wiki/Render.php	(revision 4694)
+++ lib/Text/Wiki/Render.php	(working copy)
@@ -201,7 +201,7 @@
     }
 
     /**
-    * Default method to render text (htmlspecialchars)
+    * Default method to render text (df_escape)
     *
     * @access public
     * @param string $text the text to render
@@ -211,7 +211,7 @@
 
     function textEncode($text)
     {
-        return htmlspecialchars($text);
+        return df_escape($text);
     }
 }
 ?>
Index: lib/Text/Wiki/Parse/Default/Raw.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Raw.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Raw.php	(working copy)
@@ -70,4 +70,4 @@
         return $this->wiki->addToken($this->rule, $options);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Deflist.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Deflist.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Deflist.php	(working copy)
@@ -119,4 +119,4 @@
         return "\n" . $return . "\n\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Horiz.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Horiz.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Horiz.php	(working copy)
@@ -67,4 +67,4 @@
         return $this->wiki->addToken($this->rule);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Prefilter.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Prefilter.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Prefilter.php	(working copy)
@@ -75,4 +75,4 @@
     }
 
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Revise.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Revise.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Revise.php	(working copy)
@@ -142,4 +142,4 @@
         return $output;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Heading.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Heading.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Heading.php	(working copy)
@@ -81,7 +81,7 @@
             $id = 0;
         }
         
-        $prefix = htmlspecialchars($this->getConf('id_prefix'));
+        $prefix = df_escape($this->getConf('id_prefix'));
         
         $start = $this->wiki->addToken(
             $this->rule, 
@@ -104,4 +104,4 @@
         return $start . $matches[2] . $end . "\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Tighten.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Tighten.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Tighten.php	(working copy)
@@ -46,4 +46,4 @@
             $this->wiki->source);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Paragraph.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Paragraph.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Paragraph.php	(working copy)
@@ -143,4 +143,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Interwiki.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Interwiki.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Interwiki.php	(working copy)
@@ -135,4 +135,4 @@
         return $this->wiki->addToken($this->rule, $options);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Emphasis.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Emphasis.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Emphasis.php	(working copy)
@@ -82,4 +82,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Strong.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Strong.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Strong.php	(working copy)
@@ -83,4 +83,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Embed.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Embed.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Embed.php	(working copy)
@@ -103,4 +103,4 @@
         );
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Delimiter.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Delimiter.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Delimiter.php	(working copy)
@@ -77,4 +77,4 @@
         );
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Center.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Center.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Center.php	(working copy)
@@ -75,4 +75,4 @@
         return "\n" . $start . $matches[1] . $end . "\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Function.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Function.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Function.php	(working copy)
@@ -138,4 +138,4 @@
     }
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Newline.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Newline.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Newline.php	(working copy)
@@ -72,4 +72,4 @@
     }
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Url.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Url.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Url.php	(working copy)
@@ -278,4 +278,4 @@
         return $this->wiki->addToken($this->rule, $options);
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Html.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Html.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Html.php	(working copy)
@@ -72,4 +72,4 @@
         return $this->wiki->addToken($this->rule, $options) . $matches[2];
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Italic.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Italic.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Italic.php	(working copy)
@@ -82,4 +82,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Blockquote.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Blockquote.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Blockquote.php	(working copy)
@@ -176,4 +176,4 @@
         return "\n$return\n\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Subscript.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Subscript.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Subscript.php	(working copy)
@@ -76,4 +76,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Bold.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Bold.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Bold.php	(working copy)
@@ -76,4 +76,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Phplookup.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Phplookup.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Phplookup.php	(working copy)
@@ -70,4 +70,4 @@
         );
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Superscript.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Superscript.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Superscript.php	(working copy)
@@ -76,4 +76,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Include.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Include.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Include.php	(working copy)
@@ -97,4 +97,4 @@
         return $this->output;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Colortext.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Colortext.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Colortext.php	(working copy)
@@ -86,4 +86,4 @@
         return $start . $matches[2] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Break.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Break.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Break.php	(working copy)
@@ -69,4 +69,4 @@
     }
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Toc.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Toc.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Toc.php	(working copy)
@@ -127,4 +127,4 @@
         return "\n$output\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Underline.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Underline.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Underline.php	(working copy)
@@ -76,4 +76,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Table.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Table.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Table.php	(working copy)
@@ -223,4 +223,4 @@
         return "\n$return\n\n";
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Wiki/Parse/Default/Tt.php
===================================================================
--- lib/Text/Wiki/Parse/Default/Tt.php	(revision 4694)
+++ lib/Text/Wiki/Parse/Default/Tt.php	(working copy)
@@ -81,4 +81,4 @@
         return $start . $matches[1] . $end;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Text/Diff/Renderer/inline.php
===================================================================
--- lib/Text/Diff/Renderer/inline.php	(revision 4694)
+++ lib/Text/Diff/Renderer/inline.php	(working copy)
@@ -149,7 +149,7 @@
 
     function _encode(&$string)
     {
-        $string = htmlspecialchars($string);
+        $string = df_escape($string);
     }
 
 }
Index: lib/excel.php
===================================================================
--- lib/excel.php	(revision 4694)
+++ lib/excel.php	(working copy)
@@ -232,4 +232,4 @@
 
 stream_wrapper_register("xlsfile", "xlsStream") 
     or die("Failed to register protocol: xlsfile"); 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpthumb.gif.php
===================================================================
--- lib/phpThumb/phpthumb.gif.php	(revision 4694)
+++ lib/phpThumb/phpthumb.gif.php	(working copy)
@@ -1165,4 +1165,4 @@
 
 ///////////////////////////////////////////////////////////////////////////////////////////////////
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpthumb.class.php
===================================================================
--- lib/phpThumb/phpthumb.class.php	(revision 4694)
+++ lib/phpThumb/phpthumb.class.php	(working copy)
@@ -3510,4 +3510,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpthumb.functions.php
===================================================================
--- lib/phpThumb/phpthumb.functions.php	(revision 4694)
+++ lib/phpThumb/phpthumb.functions.php	(working copy)
@@ -918,4 +918,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpthumb.filters.php
===================================================================
--- lib/phpThumb/phpthumb.filters.php	(revision 4694)
+++ lib/phpThumb/phpthumb.filters.php	(working copy)
@@ -1356,4 +1356,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/demo/phpThumb.demo.demo.php
===================================================================
--- lib/phpThumb/demo/phpThumb.demo.demo.php	(revision 4694)
+++ lib/phpThumb/demo/phpThumb.demo.demo.php	(working copy)
@@ -278,4 +278,4 @@
 echo '</ul><hr>';
 ?>
 </body>
-</html>
\ No newline at end of file
+</html>
Index: lib/phpThumb/demo/phpThumb.demo.object.php
===================================================================
--- lib/phpThumb/demo/phpThumb.demo.object.php	(revision 4694)
+++ lib/phpThumb/demo/phpThumb.demo.object.php	(working copy)
@@ -77,4 +77,4 @@
 	unset($phpThumb);
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/demo/phpThumb.demo.showpic.php
===================================================================
--- lib/phpThumb/demo/phpThumb.demo.showpic.php	(revision 4694)
+++ lib/phpThumb/demo/phpThumb.demo.showpic.php	(working copy)
@@ -129,4 +129,4 @@
 }
 
 ?></div></body>
-</html>
\ No newline at end of file
+</html>
Index: lib/phpThumb/demo/phpThumb.demo.check.php
===================================================================
--- lib/phpThumb/demo/phpThumb.demo.check.php	(revision 4694)
+++ lib/phpThumb/demo/phpThumb.demo.check.php	(working copy)
@@ -428,4 +428,4 @@
 ?>
 </table>
 </body>
-</html>
\ No newline at end of file
+</html>
Index: lib/phpThumb/demo/index.php
===================================================================
--- lib/phpThumb/demo/index.php	(revision 4694)
+++ lib/phpThumb/demo/index.php	(working copy)
@@ -11,4 +11,4 @@
 	}
 }
 echo '</body></html>';
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/demo/phpThumb.demo.object.simple.php
===================================================================
--- lib/phpThumb/demo/phpThumb.demo.object.simple.php	(revision 4694)
+++ lib/phpThumb/demo/phpThumb.demo.object.simple.php	(working copy)
@@ -37,4 +37,4 @@
 	echo 'Failed:<pre>'.$phpThumb->fatalerror."\n\n".implode("\n\n", $phpThumb->debugmessages).'</pre>';
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpthumb.ico.php
===================================================================
--- lib/phpThumb/phpthumb.ico.php	(revision 4694)
+++ lib/phpThumb/phpthumb.ico.php	(working copy)
@@ -116,4 +116,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpthumb.bmp.php
===================================================================
--- lib/phpThumb/phpthumb.bmp.php	(revision 4694)
+++ lib/phpThumb/phpthumb.bmp.php	(working copy)
@@ -871,4 +871,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpthumb.unsharp.php
===================================================================
--- lib/phpThumb/phpthumb.unsharp.php	(revision 4694)
+++ lib/phpThumb/phpthumb.unsharp.php	(working copy)
@@ -159,4 +159,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/index.php
===================================================================
--- lib/phpThumb/index.php	(revision 4694)
+++ lib/phpThumb/index.php	(working copy)
@@ -1,3 +1,3 @@
 <?php
 header('Location: demo/phpThumb.demo.demo1.php');
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/cache/source/index.php
===================================================================
--- lib/phpThumb/cache/source/index.php	(revision 4694)
+++ lib/phpThumb/cache/source/index.php	(working copy)
@@ -1,4 +1,4 @@
 <?php
 header('Location: /');
 exit;
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/cache/index.php
===================================================================
--- lib/phpThumb/cache/index.php	(revision 4694)
+++ lib/phpThumb/cache/index.php	(working copy)
@@ -1,4 +1,4 @@
 <?php
 header('Location: /');
 exit;
-?>
\ No newline at end of file
+?>
Index: lib/phpThumb/phpThumb.php
===================================================================
--- lib/phpThumb/phpThumb.php	(revision 4694)
+++ lib/phpThumb/phpThumb.php	(working copy)
@@ -602,4 +602,4 @@
 }
 ////////////////////////////////////////////////////////////////
 
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/cookies.php
===================================================================
--- lib/simpletest/cookies.php	(revision 4694)
+++ lib/simpletest/cookies.php	(working copy)
@@ -377,4 +377,4 @@
             return $pairs;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/dumper.php
===================================================================
--- lib/simpletest/dumper.php	(revision 4694)
+++ lib/simpletest/dumper.php	(working copy)
@@ -399,4 +399,4 @@
             return false;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/shell_tester.php
===================================================================
--- lib/simpletest/shell_tester.php	(revision 4694)
+++ lib/simpletest/shell_tester.php	(working copy)
@@ -303,4 +303,4 @@
             return $shell;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/reporter.php
===================================================================
--- lib/simpletest/reporter.php	(revision 4694)
+++ lib/simpletest/reporter.php	(working copy)
@@ -364,4 +364,4 @@
             }
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/url.php
===================================================================
--- lib/simpletest/url.php	(revision 4694)
+++ lib/simpletest/url.php	(working copy)
@@ -522,4 +522,4 @@
             return 'com|edu|net|org|gov|mil|int|biz|info|name|pro|aero|coop|museum';
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/web_tester.php
===================================================================
--- lib/simpletest/web_tester.php	(revision 4694)
+++ lib/simpletest/web_tester.php	(working copy)
@@ -1452,4 +1452,4 @@
                     sprintf($message, "Not expecting cookie [$name]"));
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/tag.php
===================================================================
--- lib/simpletest/tag.php	(revision 4694)
+++ lib/simpletest/tag.php	(working copy)
@@ -1389,4 +1389,4 @@
             return false;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/authentication.php
===================================================================
--- lib/simpletest/authentication.php	(revision 4694)
+++ lib/simpletest/authentication.php	(working copy)
@@ -235,4 +235,4 @@
             }
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/exceptions.php
===================================================================
--- lib/simpletest/exceptions.php	(revision 4694)
+++ lib/simpletest/exceptions.php	(working copy)
@@ -43,4 +43,4 @@
             }
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/reflection_php4.php
===================================================================
--- lib/simpletest/reflection_php4.php	(revision 4694)
+++ lib/simpletest/reflection_php4.php	(working copy)
@@ -112,4 +112,4 @@
         	return "function &$method()";
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/collector.php
===================================================================
--- lib/simpletest/collector.php	(revision 4694)
+++ lib/simpletest/collector.php	(working copy)
@@ -112,4 +112,4 @@
         }
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/reflection_php5.php
===================================================================
--- lib/simpletest/reflection_php5.php	(revision 4694)
+++ lib/simpletest/reflection_php5.php	(working copy)
@@ -272,4 +272,4 @@
             return false;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/socket.php
===================================================================
--- lib/simpletest/socket.php	(revision 4694)
+++ lib/simpletest/socket.php	(working copy)
@@ -213,4 +213,4 @@
             return parent::_openSocket("tls://$host", $port, $error_number, $error, $timeout);
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/simpletest.php
===================================================================
--- lib/simpletest/simpletest.php	(revision 4694)
+++ lib/simpletest/simpletest.php	(working copy)
@@ -279,4 +279,4 @@
             return Simpletest::getDefaultProxyPassword();
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/all_tests.php
===================================================================
--- lib/simpletest/test/all_tests.php	(revision 4694)
+++ lib/simpletest/test/all_tests.php	(working copy)
@@ -12,4 +12,4 @@
         return ($result ? 0 : 1);
     }
     $test->run(new SelectiveReporter(new HtmlReporter(), @$_GET['c'], @$_GET['t']));
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/parser_test.php
===================================================================
--- lib/simpletest/test/parser_test.php	(revision 4694)
+++ lib/simpletest/test/parser_test.php	(working copy)
@@ -517,4 +517,4 @@
                     '<>"&');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/user_agent_test.php
===================================================================
--- lib/simpletest/test/user_agent_test.php	(revision 4694)
+++ lib/simpletest/test/user_agent_test.php	(working copy)
@@ -355,4 +355,4 @@
                     new SimpleGetEncoding());
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/shell_tester_test.php
===================================================================
--- lib/simpletest/test/shell_tester_test.php	(revision 4694)
+++ lib/simpletest/test/shell_tester_test.php	(working copy)
@@ -38,4 +38,4 @@
             $this->assertNoOutputPattern('/line 2/');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/xml_test.php
===================================================================
--- lib/simpletest/test/xml_test.php	(revision 4694)
+++ lib/simpletest/test/xml_test.php	(working copy)
@@ -175,4 +175,4 @@
             $this->sendValidEnd($parser);
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/mock_objects_test.php
===================================================================
--- lib/simpletest/test/mock_objects_test.php	(revision 4694)
+++ lib/simpletest/test/mock_objects_test.php	(working copy)
@@ -654,4 +654,4 @@
             $this->assertTrue(method_exists($mock, 'ConstructorSuperClass'));
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/unit_tests.php
===================================================================
--- lib/simpletest/test/unit_tests.php	(revision 4694)
+++ lib/simpletest/test/unit_tests.php	(working copy)
@@ -13,4 +13,4 @@
         }
         $test->run(new HtmlReporter());
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/visual_test.php
===================================================================
--- lib/simpletest/test/visual_test.php	(revision 4694)
+++ lib/simpletest/test/visual_test.php	(working copy)
@@ -400,4 +400,4 @@
         $reporter->makeDry();
     }
     exit ($test->run($reporter) ? 0 : 1);
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/web_tester_test.php
===================================================================
--- lib/simpletest/test/web_tester_test.php	(revision 4694)
+++ lib/simpletest/test/web_tester_test.php	(working copy)
@@ -151,4 +151,4 @@
             $this->assertNotEqual('a', 'A');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/shell_test.php
===================================================================
--- lib/simpletest/test/shell_test.php	(revision 4694)
+++ lib/simpletest/test/shell_test.php	(working copy)
@@ -35,4 +35,4 @@
             $this->assertNoFilePattern('/sputnik/i', dirname(__FILE__) . '/all_tests.php');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/compatibility_test.php
===================================================================
--- lib/simpletest/test/compatibility_test.php	(revision 4694)
+++ lib/simpletest/test/compatibility_test.php	(working copy)
@@ -87,4 +87,4 @@
                     'ComparisonInterface'));
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/tag_test.php
===================================================================
--- lib/simpletest/test/tag_test.php	(revision 4694)
+++ lib/simpletest/test/tag_test.php	(working copy)
@@ -552,4 +552,4 @@
             $this->assertEqual($label->getText(), 'Here are words');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/page_test.php
===================================================================
--- lib/simpletest/test/page_test.php	(revision 4694)
+++ lib/simpletest/test/page_test.php	(working copy)
@@ -882,4 +882,4 @@
             $this->assertEqual($page->getField(new SimpleByLabel('B')), 'b');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/errors_test.php
===================================================================
--- lib/simpletest/test/errors_test.php	(revision 4694)
+++ lib/simpletest/test/errors_test.php	(working copy)
@@ -136,4 +136,4 @@
             $this->assertNoErrors();
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/authentication_test.php
===================================================================
--- lib/simpletest/test/authentication_test.php	(revision 4694)
+++ lib/simpletest/test/authentication_test.php	(working copy)
@@ -141,4 +141,4 @@
                     new SimpleUrl('http://here.com/path/hello.html'));
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/test_groups.php
===================================================================
--- lib/simpletest/test/test_groups.php	(revision 4694)
+++ lib/simpletest/test/test_groups.php	(working copy)
@@ -61,4 +61,4 @@
             $this->addTestFile(dirname(__FILE__) . '/acceptance_test.php');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/adapter_test.php
===================================================================
--- lib/simpletest/test/adapter_test.php	(revision 4694)
+++ lib/simpletest/test/adapter_test.php	(working copy)
@@ -71,4 +71,4 @@
             $this->assertRegexp('/hello/', 'A big hello from me', 'PHPUnit regex');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/expectation_test.php
===================================================================
--- lib/simpletest/test/expectation_test.php	(revision 4694)
+++ lib/simpletest/test/expectation_test.php	(working copy)
@@ -300,4 +300,4 @@
             $this->assertTrue($expectation->test(5));
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/parse_error_test.php
===================================================================
--- lib/simpletest/test/parse_error_test.php	(revision 4694)
+++ lib/simpletest/test/parse_error_test.php	(working copy)
@@ -7,4 +7,4 @@
     $test = new GroupTest('This should fail');
     $test->addTestFile('test_with_parse_error.php');
     $test->run(new HtmlReporter());
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/reflection_php4_test.php
===================================================================
--- lib/simpletest/test/reflection_php4_test.php	(revision 4694)
+++ lib/simpletest/test/reflection_php4_test.php	(working copy)
@@ -56,4 +56,4 @@
             return $this->assertEqual(strtolower($a), strtolower($b));
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/encoding_test.php
===================================================================
--- lib/simpletest/test/encoding_test.php	(revision 4694)
+++ lib/simpletest/test/encoding_test.php	(working copy)
@@ -182,4 +182,4 @@
             $encoding->writeHeadersTo($socket);
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/acceptance_test.php
===================================================================
--- lib/simpletest/test/acceptance_test.php	(revision 4694)
+++ lib/simpletest/test/acceptance_test.php	(working copy)
@@ -1498,4 +1498,4 @@
             $this->assertPattern('/A target for the SimpleTest test suite/');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/simpletest_test.php
===================================================================
--- lib/simpletest/test/simpletest_test.php	(revision 4694)
+++ lib/simpletest/test/simpletest_test.php	(working copy)
@@ -11,4 +11,4 @@
     }
 
     class ShouldNeverBeRunEither extends ShouldNeverBeRun { }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/remote_test.php
===================================================================
--- lib/simpletest/test/remote_test.php	(revision 4694)
+++ lib/simpletest/test/remote_test.php	(working copy)
@@ -19,4 +19,4 @@
         exit ($test->run(new TextReporter()) ? 0 : 1);
     }
     $test->run(new HtmlReporter());
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/dumper_test.php
===================================================================
--- lib/simpletest/test/dumper_test.php	(revision 4694)
+++ lib/simpletest/test/dumper_test.php	(working copy)
@@ -84,4 +84,4 @@
                     $dumper->describeValue(new DumperDummy()));
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/cookies_test.php
===================================================================
--- lib/simpletest/test/cookies_test.php	(revision 4694)
+++ lib/simpletest/test/cookies_test.php	(working copy)
@@ -222,4 +222,4 @@
             $this->assertEqual($jar->selectAsPairs(new SimpleUrl('/')), array());
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/live_test.php
===================================================================
--- lib/simpletest/test/live_test.php	(revision 4694)
+++ lib/simpletest/test/live_test.php	(working copy)
@@ -44,4 +44,4 @@
                     "Connection: close\r\n\r\n");
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/detached_test.php
===================================================================
--- lib/simpletest/test/detached_test.php	(revision 4694)
+++ lib/simpletest/test/detached_test.php	(working copy)
@@ -12,4 +12,4 @@
         exit ($test->run(new TextReporter()) ? 0 : 1);
     }
     $test->run(new HtmlReporter());
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/url_test.php
===================================================================
--- lib/simpletest/test/url_test.php	(revision 4694)
+++ lib/simpletest/test/url_test.php	(working copy)
@@ -397,4 +397,4 @@
             $this->assertIdentical($url->getTarget(), 'A frame');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/form_test.php
===================================================================
--- lib/simpletest/test/form_test.php	(revision 4694)
+++ lib/simpletest/test/form_test.php	(working copy)
@@ -325,4 +325,4 @@
             $this->assertIdentical($form->getValue(new SimpleByName('a')), 'me');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/unit_tester_test.php
===================================================================
--- lib/simpletest/test/unit_tester_test.php	(revision 4694)
+++ lib/simpletest/test/unit_tester_test.php	(working copy)
@@ -66,4 +66,4 @@
             $this->pass('This should be run');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/frames_test.php
===================================================================
--- lib/simpletest/test/frames_test.php	(revision 4694)
+++ lib/simpletest/test/frames_test.php	(working copy)
@@ -572,4 +572,4 @@
             $this->assertIdentical($frameset->getField(new SimpleByName('a')), 'f');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/test_with_parse_error.php
===================================================================
--- lib/simpletest/test/test_with_parse_error.php	(revision 4694)
+++ lib/simpletest/test/test_with_parse_error.php	(working copy)
@@ -5,4 +5,4 @@
         wibble
     }
     
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/http_test.php
===================================================================
--- lib/simpletest/test/http_test.php	(revision 4694)
+++ lib/simpletest/test/http_test.php	(working copy)
@@ -424,4 +424,4 @@
             $this->assertEqual($headers->getLocation(), "http://www.somewhere-else.com:80/");
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/interfaces_test.php
===================================================================
--- lib/simpletest/test/interfaces_test.php	(revision 4694)
+++ lib/simpletest/test/interfaces_test.php	(working copy)
@@ -95,4 +95,4 @@
             $mock->extraMethod();
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/browser_test.php
===================================================================
--- lib/simpletest/test/browser_test.php	(revision 4694)
+++ lib/simpletest/test/browser_test.php	(working copy)
@@ -788,4 +788,4 @@
             $this->assertEqual($browser->getContent(), 'Page onePage two');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/reflection_php5_test.php
===================================================================
--- lib/simpletest/test/reflection_php5_test.php	(revision 4694)
+++ lib/simpletest/test/reflection_php5_test.php	(working copy)
@@ -148,4 +148,4 @@
     	    }
 		}
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/collector_test.php
===================================================================
--- lib/simpletest/test/collector_test.php	(revision 4694)
+++ lib/simpletest/test/collector_test.php	(working copy)
@@ -47,4 +47,4 @@
         $collector->collect($group, dirname(__FILE__) . '/support/collector/');
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/support/spl_examples.php
===================================================================
--- lib/simpletest/test/support/spl_examples.php	(revision 4694)
+++ lib/simpletest/test/support/spl_examples.php	(working copy)
@@ -12,4 +12,4 @@
     class IteratorAggregateImplementation implements IteratorAggregate {
         function getIterator() { }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/test/socket_test.php
===================================================================
--- lib/simpletest/test/socket_test.php	(revision 4694)
+++ lib/simpletest/test/socket_test.php	(working copy)
@@ -23,4 +23,4 @@
             $this->assertFalse($error->isError());
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/remote.php
===================================================================
--- lib/simpletest/remote.php	(revision 4694)
+++ lib/simpletest/remote.php	(working copy)
@@ -112,4 +112,4 @@
             return $this->_size;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/user_agent.php
===================================================================
--- lib/simpletest/user_agent.php	(revision 4694)
+++ lib/simpletest/user_agent.php	(working copy)
@@ -330,4 +330,4 @@
             }
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/parser.php
===================================================================
--- lib/simpletest/parser.php	(revision 4694)
+++ lib/simpletest/parser.php	(working copy)
@@ -770,4 +770,4 @@
         function addContent($text) {
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/scorer.php
===================================================================
--- lib/simpletest/scorer.php	(revision 4694)
+++ lib/simpletest/scorer.php	(working copy)
@@ -774,4 +774,4 @@
             }
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/detached.php
===================================================================
--- lib/simpletest/detached.php	(revision 4694)
+++ lib/simpletest/detached.php	(working copy)
@@ -93,4 +93,4 @@
             return new SimpleTestXmlParser($reporter);
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/mock_objects.php
===================================================================
--- lib/simpletest/mock_objects.php	(revision 4694)
+++ lib/simpletest/mock_objects.php	(working copy)
@@ -1270,4 +1270,4 @@
             return $code;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/errors.php
===================================================================
--- lib/simpletest/errors.php	(revision 4694)
+++ lib/simpletest/errors.php	(working copy)
@@ -179,4 +179,4 @@
             set_error_handler('simpleTestErrorHandler');
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/frames.php
===================================================================
--- lib/simpletest/frames.php	(revision 4694)
+++ lib/simpletest/frames.php	(working copy)
@@ -585,4 +585,4 @@
             return null;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/http.php
===================================================================
--- lib/simpletest/http.php	(revision 4694)
+++ lib/simpletest/http.php	(working copy)
@@ -621,4 +621,4 @@
             return ! $packet;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/selector.php
===================================================================
--- lib/simpletest/selector.php	(revision 4694)
+++ lib/simpletest/selector.php	(working copy)
@@ -130,4 +130,4 @@
             return ($widget->getName() == $this->_label);
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/browser.php
===================================================================
--- lib/simpletest/browser.php	(revision 4694)
+++ lib/simpletest/browser.php	(working copy)
@@ -1054,4 +1054,4 @@
             return $raw;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/simpletest/encoding.php
===================================================================
--- lib/simpletest/encoding.php	(revision 4694)
+++ lib/simpletest/encoding.php	(working copy)
@@ -518,4 +518,4 @@
             return $stream;
         }
     }
-?>
\ No newline at end of file
+?>
Index: lib/Auth/PEARAuth.php
===================================================================
--- lib/Auth/PEARAuth.php	(revision 4694)
+++ lib/Auth/PEARAuth.php	(working copy)
@@ -151,4 +151,4 @@
     }
 
 }
-?>
\ No newline at end of file
+?>
Index: lib/Auth/Storage/Globals.php
===================================================================
--- lib/Auth/Storage/Globals.php	(revision 4694)
+++ lib/Auth/Storage/Globals.php	(working copy)
@@ -78,4 +78,4 @@
     'users' => 'users',
 );
 
-?>
\ No newline at end of file
+?>
Index: lib/Auth/XML.php
===================================================================
--- lib/Auth/XML.php	(revision 4694)
+++ lib/Auth/XML.php	(working copy)
@@ -274,4 +274,4 @@
         return true;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Auth/MDB.php
===================================================================
--- lib/Auth/MDB.php	(revision 4694)
+++ lib/Auth/MDB.php	(working copy)
@@ -275,4 +275,4 @@
         return true;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Auth/Session.php
===================================================================
--- lib/Auth/Session.php	(revision 4694)
+++ lib/Auth/Session.php	(working copy)
@@ -143,4 +143,4 @@
         return true;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Auth/MDB2.php
===================================================================
--- lib/Auth/MDB2.php	(revision 4694)
+++ lib/Auth/MDB2.php	(working copy)
@@ -276,4 +276,4 @@
         return true;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Auth/DB.php
===================================================================
--- lib/Auth/DB.php	(revision 4694)
+++ lib/Auth/DB.php	(working copy)
@@ -265,4 +265,4 @@
         return true;
     }
 }
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump.php
===================================================================
--- lib/Var_Dump.php	(revision 4694)
+++ lib/Var_Dump.php	(working copy)
@@ -508,4 +508,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Cache/tests/bench2.php
===================================================================
--- lib/Cache/tests/bench2.php	(revision 4694)
+++ lib/Cache/tests/bench2.php	(working copy)
@@ -21,4 +21,4 @@
     $cache->end();
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Cache/tests/bench3.php
===================================================================
--- lib/Cache/tests/bench3.php	(revision 4694)
+++ lib/Cache/tests/bench3.php	(working copy)
@@ -56,4 +56,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Cache/tests/bench.php
===================================================================
--- lib/Cache/tests/bench.php	(revision 4694)
+++ lib/Cache/tests/bench.php	(working copy)
@@ -24,4 +24,4 @@
     $Cache_Lite->save($data);
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/HTML4_Text.php
===================================================================
--- lib/Var_Dump/Renderer/HTML4_Text.php	(revision 4694)
+++ lib/Var_Dump/Renderer/HTML4_Text.php	(working copy)
@@ -62,4 +62,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/HTML4_Table.php
===================================================================
--- lib/Var_Dump/Renderer/HTML4_Table.php	(revision 4694)
+++ lib/Var_Dump/Renderer/HTML4_Table.php	(working copy)
@@ -73,4 +73,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/XHTML_Text.php
===================================================================
--- lib/Var_Dump/Renderer/XHTML_Text.php	(revision 4694)
+++ lib/Var_Dump/Renderer/XHTML_Text.php	(working copy)
@@ -62,4 +62,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/XML.php
===================================================================
--- lib/Var_Dump/Renderer/XML.php	(revision 4694)
+++ lib/Var_Dump/Renderer/XML.php	(working copy)
@@ -70,8 +70,8 @@
     {
         return
             '<element>' .
-            '<type>' . htmlspecialchars($this->type[0]) . '</type>' .
-            '<value>' . htmlspecialchars($this->value[0]) . '</value>' .
+            '<type>' . df_escape($this->type[0]) . '</type>' .
+            '<value>' . df_escape($this->value[0]) . '</value>' .
             '</element>';
     }
 
@@ -96,7 +96,7 @@
                     }
                     $txt .=
                         $this->_spacer($depth) .
-                        '<group caption="' . htmlspecialchars($this->value[$c]) .
+                        '<group caption="' . df_escape($this->value[$c]) .
                         '">' . "\n";
                     break;
                 case VAR_DUMP_FINISH_GROUP :
@@ -113,17 +113,17 @@
                     $txt .=
                         $this->_spacer(++$depth) . '<element>' . "\n" .
                         $this->_spacer(++$depth) . '<key>' .
-                        htmlspecialchars($this->value[$c]) .
+                        df_escape($this->value[$c]) .
                         '</key>' . "\n";
                     break;
                 case VAR_DUMP_FINISH_ELEMENT :
                 case VAR_DUMP_FINISH_STRING :
                     $txt .=
                         $this->_spacer($depth) . '<type>' .
-                        htmlspecialchars($this->type[$c]) .
+                        df_escape($this->type[$c]) .
                         '</type>' . "\n".
                         $this->_spacer($depth--) . '<value>' .
-                        htmlspecialchars($this->value[$c]) .
+                        df_escape($this->value[$c]) .
                         '</value>' . "\n" .
                         $this->_spacer($depth--) . '</element>' . "\n";
                     break;
@@ -145,4 +145,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/XHTML_Table.php
===================================================================
--- lib/Var_Dump/Renderer/XHTML_Table.php	(revision 4694)
+++ lib/Var_Dump/Renderer/XHTML_Table.php	(working copy)
@@ -61,4 +61,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/Text.php
===================================================================
--- lib/Var_Dump/Renderer/Text.php	(revision 4694)
+++ lib/Var_Dump/Renderer/Text.php	(working copy)
@@ -47,7 +47,7 @@
      *     opening         : string,  Opening character
      *     closing         : string,  Closing character
      *     operator        : string,  Operator symbol
-     *     is_html         : bool,    Do we need to htmlspecialchars() the texts
+     *     is_html         : bool,    Do we need to df_escape() the texts
      *     before_text     : string,  Text to insert before the text
      *     after_text      : string,  Text to insert after the text
      *     before_num_key  : string,  Text to insert before a numerical key
@@ -228,7 +228,7 @@
     {
         $txt = $this->options['before_operator'];
         if ($this->options['is_html']) {
-            $txt .= htmlspecialchars($this->options['operator']);
+            $txt .= df_escape($this->options['operator']);
         } else {
             $txt .= $this->options['operator'];
         }
@@ -248,7 +248,7 @@
         $comp = ($this->family[$c] == VAR_DUMP_START_ELEMENT_NUM) ? 'num' : 'str';
         $txt = $this->options['before_' . $comp . '_key'];
         if ($this->options['is_html']) {
-            $txt .= htmlspecialchars($this->value[$c]);
+            $txt .= df_escape($this->value[$c]);
         } else {
             $txt .= $this->value[$c];
         }
@@ -267,7 +267,7 @@
     {
         $txt = $this->options['before_type'];
         if ($this->options['is_html']) {
-            $txt .= htmlspecialchars($this->type[$c]);
+            $txt .= df_escape($this->type[$c]);
         } else {
             $txt .= $this->type[$c];
         }
@@ -275,7 +275,7 @@
         if (! is_null($this->value[$c])) {
             $txt .= ' ' . $this->options['before_value'];
             if ($this->options['is_html']) {
-                $string = htmlspecialchars($this->value[$c]);
+                $string = df_escape($this->value[$c]);
             } else {
                 $string = $this->value[$c];
             }
@@ -293,4 +293,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/Table.php
===================================================================
--- lib/Var_Dump/Renderer/Table.php	(revision 4694)
+++ lib/Var_Dump/Renderer/Table.php	(working copy)
@@ -130,7 +130,7 @@
      */
     function _toString_Single()
     {
-        $string = htmlspecialchars($this->value[0]);
+        $string = df_escape($this->value[0]);
         if ($this->options['show_eol'] !== FALSE) {
             $string = str_replace(
                 "\n",
@@ -143,7 +143,7 @@
             $this->options['start_tr'] .
             $this->options['start_td_type'] .
             $this->options['before_type'] .
-            htmlspecialchars($this->type[0]) .
+            df_escape($this->type[0]) .
             $this->options['after_type'] .
             $this->options['end_td_type'] .
             $this->options['start_td_value'] .
@@ -177,7 +177,7 @@
                     if ($this->options['show_caption']) {
                         $txt .=
                             $this->options['start_caption'] .
-                            htmlspecialchars($this->value[$c]) .
+                            df_escape($this->value[$c]) .
                             $this->options['end_caption'];
                     }
                     break;
@@ -199,7 +199,7 @@
                         $this->options[$tr] .
                         $this->options['start_td_key'] .
                         $this->options['before_'.$comp.'_key'] .
-                        htmlspecialchars($this->value[$c]) .
+                        df_escape($this->value[$c]) .
                         $this->options['after_'.$comp.'_key'] .
                         $this->options['end_td_key'];
                     break;
@@ -207,7 +207,7 @@
                 case VAR_DUMP_FINISH_STRING :
                     $etr = (end($stack) == 1) ? 'end_tr' : 'end_tr_alt';
                     if (!is_null($this->value[$c])) {
-                        $string = htmlspecialchars($this->value[$c]);
+                        $string = df_escape($this->value[$c]);
                         if ($this->options['show_eol'] !== FALSE) {
                             $string = str_replace(
                                 "\n",
@@ -218,7 +218,7 @@
                         $txt .=
                             $this->options['start_td_type'] .
                             $this->options['before_type'] .
-                            htmlspecialchars($this->type[$c]) .
+                            df_escape($this->type[$c]) .
                             $this->options['after_type'] .
                             $this->options['end_td_type'] .
                             $this->options['start_td_value'] .
@@ -231,7 +231,7 @@
                         $txt .=
                             $this->options['start_td_colspan'] .
                             $this->options['before_type'] .
-                            htmlspecialchars($this->type[$c]) .
+                            df_escape($this->type[$c]) .
                             $this->options['after_type'] .
                             $this->options['end_td_colspan'] .
                             $this->options[$etr];
@@ -244,4 +244,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer/Common.php
===================================================================
--- lib/Var_Dump/Renderer/Common.php	(revision 4694)
+++ lib/Var_Dump/Renderer/Common.php	(working copy)
@@ -130,4 +130,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/Var_Dump/Renderer.php
===================================================================
--- lib/Var_Dump/Renderer.php	(revision 4694)
+++ lib/Var_Dump/Renderer.php	(working copy)
@@ -54,4 +54,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: lib/feedcreator.class.php
===================================================================
--- lib/feedcreator.class.php	(revision 4694)
+++ lib/feedcreator.class.php	(working copy)
@@ -309,9 +309,9 @@
 			$result = "<![CDATA[".$this->rawFieldContent."]]>";
 		} else {
 			if ($this->truncSize and is_int($this->truncSize)) {
-				$result = FeedCreator::iTrunc(htmlspecialchars($this->rawFieldContent),$this->truncSize);
+				$result = FeedCreator::iTrunc(df_escape($this->rawFieldContent),$this->truncSize);
 			} else {
-				$result = htmlspecialchars($this->rawFieldContent);
+				$result = df_escape($this->rawFieldContent);
 			}
 		}
 		return $result;
@@ -818,18 +818,18 @@
 		$feed.= "    xmlns:slash=\"http://purl.org/rss/1.0/modules/slash/\"\n";
 		$feed.= "    xmlns:dc=\"http://purl.org/dc/elements/1.1/\">\n";
 		$feed.= "    <channel rdf:about=\"".$this->syndicationURL."\">\n";
-		$feed.= "        <title>".htmlspecialchars($this->title)."</title>\n";
-		$feed.= "        <description>".htmlspecialchars($this->description)."</description>\n";
+		$feed.= "        <title>".df_escape($this->title)."</title>\n";
+		$feed.= "        <description>".df_escape($this->description)."</description>\n";
 		$feed.= "        <link>".$this->link."</link>\n";
 		if ($this->image!=null) {
 			$feed.= "        <image rdf:resource=\"".$this->image->url."\" />\n";
 		}
 		$now = new FeedDate();
-		$feed.= "       <dc:date>".htmlspecialchars($now->iso8601())."</dc:date>\n";
+		$feed.= "       <dc:date>".df_escape($now->iso8601())."</dc:date>\n";
 		$feed.= "        <items>\n";
 		$feed.= "            <rdf:Seq>\n";
 		for ($i=0;$i<count($this->items);$i++) {
-			$feed.= "                <rdf:li rdf:resource=\"".htmlspecialchars($this->items[$i]->link)."\"/>\n";
+			$feed.= "                <rdf:li rdf:resource=\"".df_escape($this->items[$i]->link)."\"/>\n";
 		}
 		$feed.= "            </rdf:Seq>\n";
 		$feed.= "        </items>\n";
@@ -844,22 +844,22 @@
 		$feed.= $this->_createAdditionalElements($this->additionalElements, "    ");
 		
 		for ($i=0;$i<count($this->items);$i++) {
-			$feed.= "    <item rdf:about=\"".htmlspecialchars($this->items[$i]->link)."\">\n";
+			$feed.= "    <item rdf:about=\"".df_escape($this->items[$i]->link)."\">\n";
 			//$feed.= "        <dc:type>Posting</dc:type>\n";
 			$feed.= "        <dc:format>text/html</dc:format>\n";
 			if ($this->items[$i]->date!=null) {
 				$itemDate = new FeedDate($this->items[$i]->date);
-				$feed.= "        <dc:date>".htmlspecialchars($itemDate->iso8601())."</dc:date>\n";
+				$feed.= "        <dc:date>".df_escape($itemDate->iso8601())."</dc:date>\n";
 			}
 			if ($this->items[$i]->source!="") {
-				$feed.= "        <dc:source>".htmlspecialchars($this->items[$i]->source)."</dc:source>\n";
+				$feed.= "        <dc:source>".df_escape($this->items[$i]->source)."</dc:source>\n";
 			}
 			if ($this->items[$i]->author!="") {
-				$feed.= "        <dc:creator>".htmlspecialchars($this->items[$i]->author)."</dc:creator>\n";
+				$feed.= "        <dc:creator>".df_escape($this->items[$i]->author)."</dc:creator>\n";
 			}
-			$feed.= "        <title>".htmlspecialchars(strip_tags(strtr($this->items[$i]->title,"\n\r","  ")))."</title>\n";
-			$feed.= "        <link>".htmlspecialchars($this->items[$i]->link)."</link>\n";
-			$feed.= "        <description>".htmlspecialchars($this->items[$i]->description)."</description>\n";
+			$feed.= "        <title>".df_escape(strip_tags(strtr($this->items[$i]->title,"\n\r","  ")))."</title>\n";
+			$feed.= "        <link>".df_escape($this->items[$i]->link)."</link>\n";
+			$feed.= "        <description>".df_escape($this->items[$i]->description)."</description>\n";
 			$feed.= $this->_createAdditionalElements($this->items[$i]->additionalElements, "        ");
 			$feed.= "    </item>\n";
 		}
@@ -909,18 +909,18 @@
 		$feed.= $this->_createStylesheetReferences();
 		$feed.= "<rss version=\"".$this->RSSVersion."\">\n"; 
 		$feed.= "    <channel>\n";
-		$feed.= "        <title>".FeedCreator::iTrunc(htmlspecialchars($this->title),100)."</title>\n";
+		$feed.= "        <title>".FeedCreator::iTrunc(df_escape($this->title),100)."</title>\n";
 		$this->descriptionTruncSize = 500;
 		$feed.= "        <description>".$this->getDescription()."</description>\n";
 		$feed.= "        <link>".$this->link."</link>\n";
 		$now = new FeedDate();
-		$feed.= "        <lastBuildDate>".htmlspecialchars($now->rfc822())."</lastBuildDate>\n";
+		$feed.= "        <lastBuildDate>".df_escape($now->rfc822())."</lastBuildDate>\n";
 		$feed.= "        <generator>".FEEDCREATOR_VERSION."</generator>\n";
 
 		if ($this->image!=null) {
 			$feed.= "        <image>\n";
 			$feed.= "            <url>".$this->image->url."</url>\n"; 
-			$feed.= "            <title>".FeedCreator::iTrunc(htmlspecialchars($this->image->title),100)."</title>\n"; 
+			$feed.= "            <title>".FeedCreator::iTrunc(df_escape($this->image->title),100)."</title>\n"; 
 			$feed.= "            <link>".$this->image->link."</link>\n";
 			if ($this->image->width!="") {
 				$feed.= "            <width>".$this->image->width."</width>\n";
@@ -937,65 +937,65 @@
 			$feed.= "        <language>".$this->language."</language>\n";
 		}
 		if ($this->copyright!="") {
-			$feed.= "        <copyright>".FeedCreator::iTrunc(htmlspecialchars($this->copyright),100)."</copyright>\n";
+			$feed.= "        <copyright>".FeedCreator::iTrunc(df_escape($this->copyright),100)."</copyright>\n";
 		}
 		if ($this->editor!="") {
-			$feed.= "        <managingEditor>".FeedCreator::iTrunc(htmlspecialchars($this->editor),100)."</managingEditor>\n";
+			$feed.= "        <managingEditor>".FeedCreator::iTrunc(df_escape($this->editor),100)."</managingEditor>\n";
 		}
 		if ($this->webmaster!="") {
-			$feed.= "        <webMaster>".FeedCreator::iTrunc(htmlspecialchars($this->webmaster),100)."</webMaster>\n";
+			$feed.= "        <webMaster>".FeedCreator::iTrunc(df_escape($this->webmaster),100)."</webMaster>\n";
 		}
 		if ($this->pubDate!="") {
 			$pubDate = new FeedDate($this->pubDate);
-			$feed.= "        <pubDate>".htmlspecialchars($pubDate->rfc822())."</pubDate>\n";
+			$feed.= "        <pubDate>".df_escape($pubDate->rfc822())."</pubDate>\n";
 		}
 		if ($this->category!="") {
-			$feed.= "        <category>".htmlspecialchars($this->category)."</category>\n";
+			$feed.= "        <category>".df_escape($this->category)."</category>\n";
 		}
 		if ($this->docs!="") {
-			$feed.= "        <docs>".FeedCreator::iTrunc(htmlspecialchars($this->docs),500)."</docs>\n";
+			$feed.= "        <docs>".FeedCreator::iTrunc(df_escape($this->docs),500)."</docs>\n";
 		}
 		if ($this->ttl!="") {
-			$feed.= "        <ttl>".htmlspecialchars($this->ttl)."</ttl>\n";
+			$feed.= "        <ttl>".df_escape($this->ttl)."</ttl>\n";
 		}
 		if ($this->rating!="") {
-			$feed.= "        <rating>".FeedCreator::iTrunc(htmlspecialchars($this->rating),500)."</rating>\n";
+			$feed.= "        <rating>".FeedCreator::iTrunc(df_escape($this->rating),500)."</rating>\n";
 		}
 		if ($this->skipHours!="") {
-			$feed.= "        <skipHours>".htmlspecialchars($this->skipHours)."</skipHours>\n";
+			$feed.= "        <skipHours>".df_escape($this->skipHours)."</skipHours>\n";
 		}
 		if ($this->skipDays!="") {
-			$feed.= "        <skipDays>".htmlspecialchars($this->skipDays)."</skipDays>\n";
+			$feed.= "        <skipDays>".df_escape($this->skipDays)."</skipDays>\n";
 		}
 		$feed.= $this->_createAdditionalElements($this->additionalElements, "    ");
 
 		for ($i=0;$i<count($this->items);$i++) {
 			$feed.= "        <item>\n";
-			$feed.= "            <title>".FeedCreator::iTrunc(htmlspecialchars(strip_tags($this->items[$i]->title)),100)."</title>\n";
-			$feed.= "            <link>".htmlspecialchars($this->items[$i]->link)."</link>\n";
+			$feed.= "            <title>".FeedCreator::iTrunc(df_escape(strip_tags($this->items[$i]->title)),100)."</title>\n";
+			$feed.= "            <link>".df_escape($this->items[$i]->link)."</link>\n";
 			$feed.= "            <description>".$this->items[$i]->getDescription()."</description>\n";
 			
 			if ($this->items[$i]->author!="") {
-				$feed.= "            <author>".htmlspecialchars($this->items[$i]->author)."</author>\n";
+				$feed.= "            <author>".df_escape($this->items[$i]->author)."</author>\n";
 			}
 			/*
 			// on hold
 			if ($this->items[$i]->source!="") {
-					$feed.= "            <source>".htmlspecialchars($this->items[$i]->source)."</source>\n";
+					$feed.= "            <source>".df_escape($this->items[$i]->source)."</source>\n";
 			}
 			*/
 			if ($this->items[$i]->category!="") {
-				$feed.= "            <category>".htmlspecialchars($this->items[$i]->category)."</category>\n";
+				$feed.= "            <category>".df_escape($this->items[$i]->category)."</category>\n";
 			}
 			if ($this->items[$i]->comments!="") {
-				$feed.= "            <comments>".htmlspecialchars($this->items[$i]->comments)."</comments>\n";
+				$feed.= "            <comments>".df_escape($this->items[$i]->comments)."</comments>\n";
 			}
 			if ($this->items[$i]->date!="") {
 			$itemDate = new FeedDate($this->items[$i]->date);
-				$feed.= "            <pubDate>".htmlspecialchars($itemDate->rfc822())."</pubDate>\n";
+				$feed.= "            <pubDate>".df_escape($itemDate->rfc822())."</pubDate>\n";
 			}
 			if ($this->items[$i]->guid!="") {
-				$feed.= "            <guid>".htmlspecialchars($this->items[$i]->guid)."</guid>\n";
+				$feed.= "            <guid>".df_escape($this->items[$i]->guid)."</guid>\n";
 			}
 			$feed.= $this->_createAdditionalElements($this->items[$i]->additionalElements, "        ");
 			$feed.= "        </item>\n";
@@ -1042,22 +1042,22 @@
 		$feed = "<?xml version=\"1.0\" encoding=\"".$this->encoding."\"?>\n";
 		$feed.= $this->_createStylesheetReferences();
 		$feed.= "<feed version=\"0.1\" xmlns=\"http://example.com/newformat#\">\n"; 
-		$feed.= "    <title>".FeedCreator::iTrunc(htmlspecialchars($this->title),100)."</title>\n";
+		$feed.= "    <title>".FeedCreator::iTrunc(df_escape($this->title),100)."</title>\n";
 		$this->truncSize = 500;
 		$feed.= "    <subtitle>".$this->getDescription()."</subtitle>\n";
 		$feed.= "    <link>".$this->link."</link>\n";
 		for ($i=0;$i<count($this->items);$i++) {
 			$feed.= "    <entry>\n";
-			$feed.= "        <title>".FeedCreator::iTrunc(htmlspecialchars(strip_tags($this->items[$i]->title)),100)."</title>\n";
-			$feed.= "        <link>".htmlspecialchars($this->items[$i]->link)."</link>\n";
+			$feed.= "        <title>".FeedCreator::iTrunc(df_escape(strip_tags($this->items[$i]->title)),100)."</title>\n";
+			$feed.= "        <link>".df_escape($this->items[$i]->link)."</link>\n";
 			$itemDate = new FeedDate($this->items[$i]->date);
-			$feed.= "        <created>".htmlspecialchars($itemDate->iso8601())."</created>\n";
-			$feed.= "        <issued>".htmlspecialchars($itemDate->iso8601())."</issued>\n";
-			$feed.= "        <modified>".htmlspecialchars($itemDate->iso8601())."</modified>\n";
-			$feed.= "        <id>".htmlspecialchars($this->items[$i]->guid)."</id>\n";
+			$feed.= "        <created>".df_escape($itemDate->iso8601())."</created>\n";
+			$feed.= "        <issued>".df_escape($itemDate->iso8601())."</issued>\n";
+			$feed.= "        <modified>".df_escape($itemDate->iso8601())."</modified>\n";
+			$feed.= "        <id>".df_escape($this->items[$i]->guid)."</id>\n";
 			if ($this->items[$i]->author!="") {
 				$feed.= "        <author>\n";
-				$feed.= "            <name>".htmlspecialchars($this->items[$i]->author)."</name>\n";
+				$feed.= "            <name>".df_escape($this->items[$i]->author)."</name>\n";
 				if ($this->items[$i]->authorEmail!="") {
 					$feed.= "            <email>".$this->items[$i]->authorEmail."</email>\n";
 				}
@@ -1106,12 +1106,12 @@
 			$feed.= " xml:lang=\"".$this->language."\"";
 		}
 		$feed.= ">\n"; 
-		$feed.= "    <title>".htmlspecialchars($this->title)."</title>\n";
-		$feed.= "    <tagline>".htmlspecialchars($this->description)."</tagline>\n";
-		$feed.= "    <link rel=\"alternate\" type=\"text/html\" href=\"".htmlspecialchars($this->link)."\"/>\n";
-		$feed.= "    <id>".htmlspecialchars($this->link)."</id>\n";
+		$feed.= "    <title>".df_escape($this->title)."</title>\n";
+		$feed.= "    <tagline>".df_escape($this->description)."</tagline>\n";
+		$feed.= "    <link rel=\"alternate\" type=\"text/html\" href=\"".df_escape($this->link)."\"/>\n";
+		$feed.= "    <id>".df_escape($this->link)."</id>\n";
 		$now = new FeedDate();
-		$feed.= "    <modified>".htmlspecialchars($now->iso8601())."</modified>\n";
+		$feed.= "    <modified>".df_escape($now->iso8601())."</modified>\n";
 		if ($this->editor!="") {
 			$feed.= "    <author>\n";
 			$feed.= "        <name>".$this->editor."</name>\n";
@@ -1124,24 +1124,24 @@
 		$feed.= $this->_createAdditionalElements($this->additionalElements, "    ");
 		for ($i=0;$i<count($this->items);$i++) {
 			$feed.= "    <entry>\n";
-			$feed.= "        <title>".htmlspecialchars(strip_tags($this->items[$i]->title))."</title>\n";
-			$feed.= "        <link rel=\"alternate\" type=\"text/html\" href=\"".htmlspecialchars($this->items[$i]->link)."\"/>\n";
+			$feed.= "        <title>".df_escape(strip_tags($this->items[$i]->title))."</title>\n";
+			$feed.= "        <link rel=\"alternate\" type=\"text/html\" href=\"".df_escape($this->items[$i]->link)."\"/>\n";
 			if ($this->items[$i]->date=="") {
 				$this->items[$i]->date = time();
 			}
 			$itemDate = new FeedDate($this->items[$i]->date);
-			$feed.= "        <created>".htmlspecialchars($itemDate->iso8601())."</created>\n";
-			$feed.= "        <issued>".htmlspecialchars($itemDate->iso8601())."</issued>\n";
-			$feed.= "        <modified>".htmlspecialchars($itemDate->iso8601())."</modified>\n";
-			$feed.= "        <id>".htmlspecialchars($this->items[$i]->link)."</id>\n";
+			$feed.= "        <created>".df_escape($itemDate->iso8601())."</created>\n";
+			$feed.= "        <issued>".df_escape($itemDate->iso8601())."</issued>\n";
+			$feed.= "        <modified>".df_escape($itemDate->iso8601())."</modified>\n";
+			$feed.= "        <id>".df_escape($this->items[$i]->link)."</id>\n";
 			$feed.= $this->_createAdditionalElements($this->items[$i]->additionalElements, "        ");
 			if ($this->items[$i]->author!="") {
 				$feed.= "        <author>\n";
-				$feed.= "            <name>".htmlspecialchars($this->items[$i]->author)."</name>\n";
+				$feed.= "            <name>".df_escape($this->items[$i]->author)."</name>\n";
 				$feed.= "        </author>\n";
 			}
 			if ($this->items[$i]->description!="") {
-				$feed.= "        <summary>".htmlspecialchars($this->items[$i]->description)."</summary>\n";
+				$feed.= "        <summary>".df_escape($this->items[$i]->description)."</summary>\n";
 			}
 			$feed.= "    </entry>\n";
 		}
@@ -1257,7 +1257,7 @@
 		$feed.= $this->_createStylesheetReferences();
 		$feed.= "<opml xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n";
 		$feed.= "    <head>\n";
-		$feed.= "        <title>".htmlspecialchars($this->title)."</title>\n";
+		$feed.= "        <title>".df_escape($this->title)."</title>\n";
 		if ($this->pubDate!="") {
 			$date = new FeedDate($this->pubDate);
 			$feed.= "         <dateCreated>".$date->rfc822()."</dateCreated>\n";
@@ -1276,11 +1276,11 @@
 		$feed.= "    <body>\n";
 		for ($i=0;$i<count($this->items);$i++) {
 			$feed.= "    <outline type=\"rss\" ";
-			$title = htmlspecialchars(strip_tags(strtr($this->items[$i]->title,"\n\r","  ")));
+			$title = df_escape(strip_tags(strtr($this->items[$i]->title,"\n\r","  ")));
 			$feed.= " title=\"".$title."\"";
 			$feed.= " text=\"".$title."\"";
-			//$feed.= " description=\"".htmlspecialchars($this->items[$i]->description)."\"";
-			$feed.= " url=\"".htmlspecialchars($this->items[$i]->link)."\"";
+			//$feed.= " description=\"".df_escape($this->items[$i]->description)."\"";
+			$feed.= " url=\"".df_escape($this->items[$i]->link)."\"";
 			$feed.= "/>\n";
 		}
 		$feed.= "    </body>\n";
@@ -1369,7 +1369,7 @@
 		if ($this->image!=null) {
 			$imageStr = "<a href='".$this->image->link."'".$targetInsert.">".
 							"<img src='".$this->image->url."' border='0' alt='".
-							FeedCreator::iTrunc(htmlspecialchars($this->image->title),100).
+							FeedCreator::iTrunc(df_escape($this->image->title),100).
 							"' align='".$this->imageAlign."' ";
 			if ($this->image->width) {
 				$imageStr .=" width='".$this->image->width. "' ";
@@ -1383,7 +1383,7 @@
 		
 		if ($this->title) {
 			$feedArray[] = "<div class='".$this->stylePrefix."title'><a href='".$this->link."' ".$targetInsert." class='".$this->stylePrefix."title'>".
-				FeedCreator::iTrunc(htmlspecialchars($this->title),100)."</a></div>";
+				FeedCreator::iTrunc(df_escape($this->title),100)."</a></div>";
 		}
 		if ($this->getDescription()) {
 			$feedArray[] = "<div class='".$this->stylePrefix."description'>".
@@ -1404,12 +1404,12 @@
 				if ($this->items[$i]->link) {
 					$feedArray[] = 
 						"<div class='".$this->stylePrefix."item_title'><a href='".$this->items[$i]->link."' class='".$this->stylePrefix.
-						"item_title'".$targetInsert.">".FeedCreator::iTrunc(htmlspecialchars(strip_tags($this->items[$i]->title)),100).
+						"item_title'".$targetInsert.">".FeedCreator::iTrunc(df_escape(strip_tags($this->items[$i]->title)),100).
 						"</a></div>";
 				} else {
 					$feedArray[] = 
 						"<div class='".$this->stylePrefix."item_title'>".
-						FeedCreator::iTrunc(htmlspecialchars(strip_tags($this->items[$i]->title)),100).
+						FeedCreator::iTrunc(df_escape(strip_tags($this->items[$i]->title)),100).
 						"</div>";
 				}
 			}
Index: lib/thumbnail.lib.php
===================================================================
--- lib/thumbnail.lib.php	(revision 4694)
+++ lib/thumbnail.lib.php	(working copy)
@@ -194,4 +194,4 @@
 	
 	}
 
-}
\ No newline at end of file
+}
Index: modules/XataJax/actions/xf_schemabrowser_preview_row.php
===================================================================
--- modules/XataJax/actions/xf_schemabrowser_preview_row.php	(revision 4694)
+++ modules/XataJax/actions/xf_schemabrowser_preview_row.php	(working copy)
@@ -142,4 +142,4 @@
 		header('Content-type:text/json; charset="'.Dataface_Application::getInstance()->_conf['oe'].'"');
 		echo json_encode($params);
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/actions/xatacard_layout_RecordSet_test.php
===================================================================
--- modules/XataJax/actions/xatacard_layout_RecordSet_test.php	(revision 4694)
+++ modules/XataJax/actions/xatacard_layout_RecordSet_test.php	(working copy)
@@ -12,10 +12,10 @@
 			//echo "here";exit;
 			while ($ex){
 				echo '<h3>'.$ex->getMessage().'</h3>';
-				echo nl2br(htmlspecialchars($ex->getTraceAsString()));
+				echo nl2br(df_escape($ex->getTraceAsString()));
 				$ex = $ex->getPrevious();
 			}
 		
 		}
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/actions/xf_schemabrowser_getschema.php
===================================================================
--- modules/XataJax/actions/xf_schemabrowser_getschema.php	(revision 4694)
+++ modules/XataJax/actions/xf_schemabrowser_getschema.php	(working copy)
@@ -349,4 +349,4 @@
 	}
 	
 	
-}
\ No newline at end of file
+}
Index: modules/XataJax/actions/xatajax_delete.php
===================================================================
--- modules/XataJax/actions/xatajax_delete.php	(revision 4694)
+++ modules/XataJax/actions/xatajax_delete.php	(working copy)
@@ -125,4 +125,4 @@
 				
 		}
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/actions/xatadoc.php
===================================================================
--- modules/XataJax/actions/xatadoc.php	(revision 4694)
+++ modules/XataJax/actions/xatadoc.php	(working copy)
@@ -70,4 +70,4 @@
 		}
 		
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/actions/xatajax_doc_test.php
===================================================================
--- modules/XataJax/actions/xatajax_doc_test.php	(revision 4694)
+++ modules/XataJax/actions/xatajax_doc_test.php	(working copy)
@@ -8,4 +8,4 @@
 		df_register_skin('xatajax', XATAJAX_PATH.DIRECTORY_SEPARATOR.'templates');
 		df_display(array(), 'tests/doctest.html');
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/actions/xatajax_sample_application.php
===================================================================
--- modules/XataJax/actions/xatajax_sample_application.php	(revision 4694)
+++ modules/XataJax/actions/xatajax_sample_application.php	(working copy)
@@ -8,4 +8,4 @@
 		df_register_skin('xatajax', XATAJAX_PATH.DIRECTORY_SEPARATOR.'templates');
 		df_display(array(), 'tests/xatajax_sample_application.html');
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/tests/JavascriptDocumentorTest.php
===================================================================
--- modules/XataJax/tests/JavascriptDocumentorTest.php	(revision 4694)
+++ modules/XataJax/tests/JavascriptDocumentorTest.php	(working copy)
@@ -126,4 +126,4 @@
 	$test->run($result);
 	
 	print $result->toString();
-}
\ No newline at end of file
+}
Index: modules/XataJax/XataJax.php
===================================================================
--- modules/XataJax/XataJax.php	(revision 4694)
+++ modules/XataJax/XataJax.php	(working copy)
@@ -61,4 +61,4 @@
 	public function block__javascript_tool_includes(){
 		return $this->block__after_global_footer();
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/classes/xatacard/layout/DataSource.php
===================================================================
--- modules/XataJax/classes/xatacard/layout/DataSource.php	(revision 4694)
+++ modules/XataJax/classes/xatacard/layout/DataSource.php	(working copy)
@@ -10,4 +10,4 @@
 	public function delete(xatacard_layout_Record $record);
 	
 	
-}
\ No newline at end of file
+}
Index: modules/XataJax/classes/xatacard/layout/Record.php
===================================================================
--- modules/XataJax/classes/xatacard/layout/Record.php	(revision 4694)
+++ modules/XataJax/classes/xatacard/layout/Record.php	(working copy)
@@ -138,4 +138,4 @@
 	
 	
 	
-}
\ No newline at end of file
+}
Index: modules/XataJax/classes/xatacard/layout/MySQLDataSource.php
===================================================================
--- modules/XataJax/classes/xatacard/layout/MySQLDataSource.php	(revision 4694)
+++ modules/XataJax/classes/xatacard/layout/MySQLDataSource.php	(working copy)
@@ -317,4 +317,4 @@
 	}
 	public function delete(xatacard_layout_Record $record);
 
-}
\ No newline at end of file
+}
Index: modules/XataJax/classes/xatacard/layout/Schema.php
===================================================================
--- modules/XataJax/classes/xatacard/layout/Schema.php	(revision 4694)
+++ modules/XataJax/classes/xatacard/layout/Schema.php	(working copy)
@@ -76,4 +76,4 @@
 	}
 	
 	
-}
\ No newline at end of file
+}
Index: modules/XataJax/classes/xatacard/layout/Field.php
===================================================================
--- modules/XataJax/classes/xatacard/layout/Field.php	(revision 4694)
+++ modules/XataJax/classes/xatacard/layout/Field.php	(working copy)
@@ -42,4 +42,4 @@
 		$this->readOnly = $readOnly;
 		return $this;
 	}
-}
\ No newline at end of file
+}
Index: modules/XataJax/classes/JavascriptDocumentor.php
===================================================================
--- modules/XataJax/classes/JavascriptDocumentor.php	(revision 4694)
+++ modules/XataJax/classes/JavascriptDocumentor.php	(working copy)
@@ -486,4 +486,4 @@
 	}
 	
 	
-}
\ No newline at end of file
+}
Index: tables/lesson_plans/lesson_plans.php
===================================================================
--- tables/lesson_plans/lesson_plans.php	(revision 4694)
+++ tables/lesson_plans/lesson_plans.php	(working copy)
@@ -5,4 +5,4 @@
 	function created__toString($value){ return $value['month'].'/'.$value['day'].'/'.$value['year'];}
 	function modified__toString($value){ return $this->created__toString($value); }
 
-}
\ No newline at end of file
+}
Index: tables/Profiles/Profiles.php
===================================================================
--- tables/Profiles/Profiles.php	(revision 4694)
+++ tables/Profiles/Profiles.php	(working copy)
@@ -108,4 +108,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: installer.php
===================================================================
--- installer.php	(revision 4694)
+++ installer.php	(working copy)
@@ -546,4 +546,4 @@
 	default:
 		$installer->mainMenu();
 
-}
\ No newline at end of file
+}
Index: Dataface/SearchForm.php
===================================================================
--- Dataface/SearchForm.php	(revision 4694)
+++ Dataface/SearchForm.php	(working copy)
@@ -272,7 +272,7 @@
 		$this->_build();
 		
 		
-		$tableLabel = htmlspecialchars($this->_table->getLabel());
+		$tableLabel = df_escape($this->_table->getLabel());
 		
 		df_display(array(
 			'tableLabel' => $tableLabel
Index: Dataface/Installer.php
===================================================================
--- Dataface/Installer.php	(revision 4694)
+++ Dataface/Installer.php	(working copy)
@@ -59,4 +59,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: Dataface/PreferencesTool.php
===================================================================
--- Dataface/PreferencesTool.php	(revision 4694)
+++ Dataface/PreferencesTool.php	(working copy)
@@ -200,4 +200,4 @@
 	}
 	
 	
-}
\ No newline at end of file
+}
Index: Dataface/FeedTool.php
===================================================================
--- Dataface/FeedTool.php	(revision 4694)
+++ Dataface/FeedTool.php	(working copy)
@@ -174,7 +174,7 @@
 				if ( !$record->checkPermission('view') ) continue;
 				if ( @$field['visibility']['feed'] == 'hidden' ) continue;
 				if ( $disp = @$record->val($field['name']) ){
-					$out .= '<tr><td valign="top">'.htmlspecialchars($field['widget']['label']).'</td>';
+					$out .= '<tr><td valign="top">'.df_escape($field['widget']['label']).'</td>';
 					$out .= '<td valign="top">'.@$record->htmlValue($field['name']).'</td></tr>';
 				}
 			}
Index: Dataface/SkinTool.php
===================================================================
--- Dataface/SkinTool.php	(revision 4694)
+++ Dataface/SkinTool.php	(working copy)
@@ -1086,7 +1086,7 @@
 		$app =& Dataface_Application::getInstance();
 		$appq = $app->url($query);
 		$url = $url .'?'.substr( $appq, strpos($appq,'?')+1);
-		echo '<a style="display:inline !important" class="feed-link" href="'.htmlspecialchars($url).'" title="Subscribe to feed"><img style="display:inline !important" src="'.DATAFACE_URL.'/images/'.$icon.'" alt="Feed"/></a>';
+		echo '<a style="display:inline !important" class="feed-link" href="'.df_escape($url).'" title="Subscribe to feed"><img style="display:inline !important" src="'.DATAFACE_URL.'/images/'.$icon.'" alt="Feed"/></a>';
 	}
 	
 	function abs($params, $url, &$smarty){
@@ -1106,9 +1106,9 @@
 		foreach ($query as $k=>$v){
 			if ( isset($exclude[$k]) ) continue;
 			if ( is_string($v) and strlen($k)>1 and $k{0} === '-' and $k{1} !== '-' ){
-				$fields[] = '<input type="hidden" name="'.htmlspecialchars($k).'" value="'.htmlspecialchars($v).'"/>';
+				$fields[] = '<input type="hidden" name="'.df_escape($k).'" value="'.df_escape($v).'"/>';
 			} else if ( @$params['filters'] and is_string($v) and strlen($v)>0 and strlen($k)>0 and $k{0} !== '-'){
-				$fields[] = '<input type="hidden" name="'.htmlspecialchars($k).'" value="'.htmlspecialchars($v).'"/>';
+				$fields[] = '<input type="hidden" name="'.df_escape($k).'" value="'.df_escape($v).'"/>';
 			}
 		}
 		
Index: Dataface/ConfigTool.php
===================================================================
--- Dataface/ConfigTool.php	(revision 4694)
+++ Dataface/ConfigTool.php	(working copy)
@@ -487,4 +487,4 @@
 		}
 	}
 
-}
\ No newline at end of file
+}
Index: Dataface/Index.php
===================================================================
--- Dataface/Index.php	(revision 4694)
+++ Dataface/Index.php	(working copy)
@@ -360,4 +360,4 @@
 		}
 		
 	}
-}
\ No newline at end of file
+}
Index: Dataface/ResultList.php
===================================================================
--- Dataface/ResultList.php	(revision 4694)
+++ Dataface/ResultList.php	(working copy)
@@ -106,14 +106,14 @@
  		    $out = substr($out, 0, $maxcols).'...';
  		}
  		if ( $fulltext ){
-            $fulltext = 'data-fulltext="'.htmlspecialchars($fulltext).'"';
+            $fulltext = 'data-fulltext="'.df_escape($fulltext).'"';
         }
  		if ( !@$field['noEditInListView'] and @$field['noLinkFromListView'] and $record->checkPermission('edit', array('field'=>$fieldname) ) ){
  			$recid = $record->getId();
  			
- 			$out = '<span df:showlink="1" df:id="'.$recid.'#'.$fieldname.'" class="df__editable" '.$fulltext.'>'.htmlspecialchars($out).'</span>';
+ 			$out = '<span df:showlink="1" df:id="'.$recid.'#'.$fieldname.'" class="df__editable" '.$fulltext.'>'.df_escape($out).'</span>';
  		} else {
- 		    $out = '<span '.$fulltext.'>'.htmlspecialchars($out).'</span>';
+ 		    $out = '<span '.$fulltext.'>'.df_escape($out).'</span>';
  		}
  		return $out;
  	}
@@ -253,7 +253,7 @@
 			$jt = Dataface_JavascriptTool::getInstance();
 			$jt->import('list.js');
 			echo '
-				<table data-xataface-query="'.htmlspecialchars($sq).'" id="result_list" class="listing resultList resultList--'.$this->_tablename.'">
+				<table data-xataface-query="'.df_escape($sq).'" id="result_list" class="listing resultList resultList--'.$this->_tablename.'">
 				<thead>
 				<tr>';
 			if ( $canSelect){
@@ -318,7 +318,7 @@
 						$label = $this->_table->getFieldProperty('column:label', $key);
 						$legend = $this->_table->getFieldProperty('column:legend', $key);
 						if ( $legend ){
-							$legend = '<span class="column-legend">'.htmlspecialchars($legend).'</span>';
+							$legend = '<span class="column-legend">'.df_escape($legend).'</span>';
 						}
 						
 						$colType = $this->_table->getType($key);
@@ -333,7 +333,7 @@
 						$class .= ' '.$this->getHeaderCellClass($key);
 						
 						if ( !$label ) $label = $this->_table->getFieldProperty('widget:label',$key);
-						echo "<th data-column=\"$key\" class=\"$class\"><a href=\"$link\">".htmlspecialchars($label)."</a> $legend</th>";
+						echo "<th data-column=\"$key\" class=\"$class\"><a href=\"$link\">".df_escape($label)."</a> $legend</th>";
 					}
 				}
 			}
@@ -393,8 +393,8 @@
 					foreach ($recperms as $pk=>$pv){
 						if ( $pv ) $permStr[] = $pk;
 					}
-					$permStr = htmlspecialchars(implode(',', $permStr));
-					echo '<td class="checkbox-cell"><input class="rowSelectorCheckbox" xf-record-id="'.htmlspecialchars($recordid).'" id="rowSelectorCheckbox:'.htmlspecialchars($recordid).'" type="checkbox" data-xf-permissions="'.$permStr.'"></td>';
+					$permStr = df_escape(implode(',', $permStr));
+					echo '<td class="checkbox-cell"><input class="rowSelectorCheckbox" xf-record-id="'.df_escape($recordid).'" id="rowSelectorCheckbox:'.df_escape($recordid).'" type="checkbox" data-xf-permissions="'.$permStr.'"></td>';
 				}
 				
 				
@@ -419,7 +419,7 @@
 				if ( count($actions)>0){
 					echo ' <span class="row-actions">';
 					foreach ($actions as $action){
-						echo '<a href="'.htmlspecialchars($action['url']).'" class="'.htmlspecialchars($action['class']).' '.(@$action['icon']?'with-icon':'').'" '.(@$action['icon']?' style="'.htmlspecialchars('background-image: url('.$action['icon'].')').'"':'').(@$action['target']?' target="'.htmlspecialchars($action['target']).'"':'').' title="'.htmlspecialchars(@$action['description']?$action['description']:$action['label']).'"><span>'.htmlspecialchars($action['label']).'</span></a> ';
+						echo '<a href="'.df_escape($action['url']).'" class="'.df_escape($action['class']).' '.(@$action['icon']?'with-icon':'').'" '.(@$action['icon']?' style="'.df_escape('background-image: url('.$action['icon'].')').'"':'').(@$action['target']?' target="'.df_escape($action['target']).'"':'').' title="'.df_escape(@$action['description']?$action['description']:$action['label']).'"><span>'.df_escape($action['label']).'</span></a> ';
 					}
 					echo '</span>';
 				}
@@ -479,12 +479,12 @@
 				unset($record);
 			}
 			if ( @$app->prefs['enable_resultlist_add_row'] ){
-				echo "<tr id=\"add-new-row\" df:table=\"".htmlspecialchars($this->_table->tablename)."\">";
+				echo "<tr id=\"add-new-row\" df:table=\"".df_escape($this->_table->tablename)."\">";
 				if ( $canSelect ) $colspan=2;
 				else $colspan = 1;
 				echo "<td colspan=\"$colspan\"><script language=\"javascript\">require(DATAFACE_URL+'/js/addable.js')</script><a href=\"#\" onclick=\"df_addNew('add-new-row');return false;\">".df_translate('scripts.GLOBAL.LABEL_ADD_ROW', "Add Row")."</a></td>";
 				foreach ( $this->_columns as $key ){
-					echo "<td><span df:field=\"".htmlspecialchars($key)."\"></span></td>";
+					echo "<td><span df:field=\"".df_escape($key)."\"></span></td>";
 				}
 				echo "</tr>";
 			}
@@ -498,7 +498,7 @@
 					if ( strlen($key)>1 and $key{0} == '-' and $key{1} == '-' ){
 						continue;
 					}
-					echo '<input type="hidden" name="'.urlencode($key).'" value="'.htmlspecialchars($val).'" />';
+					echo '<input type="hidden" name="'.urlencode($key).'" value="'.df_escape($val).'" />';
 				}
 				echo '<input type="hidden" name="--selected-ids" id="--selected-ids" />';
 				echo '<input type="hidden" name="-from" id="-from" value="'.$q['-action'].'" />';
@@ -617,7 +617,7 @@
 				
 			}
 			
-			echo '<li> '.htmlspecialchars($field['widget']['label']).' <select onchange="resultlist__updateFilters(\''.addslashes($col).'\', this);"><option value="">'.df_translate('scripts.GLOBAL.LABEL_ALL', 'All').'</option>';
+			echo '<li> '.df_escape($field['widget']['label']).' <select onchange="resultlist__updateFilters(\''.addslashes($col).'\', this);"><option value="">'.df_translate('scripts.GLOBAL.LABEL_ALL', 'All').'</option>';
 			
 			$res = df_query("select `$col`, count(*) as `num` ".$qb->_from()." ".$qb->_secure( $qb->_where(array($col=>null)) )." group by `$col`", null, true);
 			if ( !$res and !is_array($res)) trigger_error(mysql_error(df_db()), E_USER_ERROR);
@@ -635,7 +635,7 @@
 				
 				if ( $queryColVal == $row[$col] ) $selected = ' selected';
 				else $selected = '';
-				echo '<option value="'.htmlspecialchars($row[$col]).'"'.$selected.'>'.htmlspecialchars($val).' ('.$row['num'].')</option>';
+				echo '<option value="'.df_escape($row[$col]).'"'.$selected.'>'.df_escape($val).' ('.$row['num'].')</option>';
 				
 			}
 			//@mysql_free_result($res);
@@ -654,4 +654,4 @@
  	
  
  }
- 
\ No newline at end of file
+ 
Index: Dataface/FormTool/lookup.php
===================================================================
--- Dataface/FormTool/lookup.php	(revision 4694)
+++ Dataface/FormTool/lookup.php	(working copy)
@@ -44,4 +44,4 @@
 	
 		return $el;
 	}
-}
\ No newline at end of file
+}
Index: Dataface/FormTool/select.php
===================================================================
--- Dataface/FormTool/select.php	(revision 4702)
+++ Dataface/FormTool/select.php	(working copy)
@@ -70,7 +70,7 @@
 							$jt->import('RecordDialog/RecordDialog.js');
 							//$suffix =  '<script type="text/javascript" src="'.DATAFACE_URL.'/js/jquery-ui-1.7.2.custom.min.js"></script>';
 							//$suffix .= '<script type="text/javascript" src="'.DATAFACE_URL.'/js/RecordDialog/RecordDialog.js"></script>';
-							$suffix = '<a href="#" onclick="return false" id="'.htmlspecialchars($field['name']).'-other">Other..</a>';
+							$suffix = '<a href="#" onclick="return false" id="'.df_escape($field['name']).'-other">Other..</a>';
 							$suffix .= '<script>
 							jQuery(document).ready(function($){
 								$("#'.$field['name'].'-other").each(function(){
Index: Dataface/FormTool/WidgetHandler.php
===================================================================
--- Dataface/FormTool/WidgetHandler.php	(revision 4694)
+++ Dataface/FormTool/WidgetHandler.php	(working copy)
@@ -194,4 +194,4 @@
 		$formFieldName, 
 		$new=false);
 
-}
\ No newline at end of file
+}
Index: Dataface/FormTool/checkbox.php
===================================================================
--- Dataface/FormTool/checkbox.php	(revision 4694)
+++ Dataface/FormTool/checkbox.php	(working copy)
@@ -30,13 +30,13 @@
 				
 					$suffix =  '<script type="text/javascript" src="'.DATAFACE_URL.'/js/jquery-ui-1.7.2.custom.min.js"></script>';
         			$suffix .= '<script type="text/javascript" src="'.DATAFACE_URL.'/js/RecordDialog/RecordDialog.js"></script>';
-        			$suffix .= '<a href="#" onclick="return false" id="'.htmlspecialchars($field['name']).'-other">Other..</a>';
+        			$suffix .= '<a href="#" onclick="return false" id="'.df_escape($field['name']).'-other">Other..</a>';
         			$suffix .= '<script>
         			$(\'head\').append(\'<link rel="stylesheet" type="text/css" href="\'+DATAFACE_URL+\'/css/smoothness/jquery-ui-1.7.2.custom.css"/>\');
         			jQuery(document).ready(function($){
 						$("#'.$field['name'].'-other").each(function(){
 							var tablename = "'.addslashes($dtable->tablename).'";
-							var fldname = "'.addslashes(htmlspecialchars($field['name'])).'";
+							var fldname = "'.addslashes(df_escape($field['name'])).'";
 							var keys = '.json_encode(array_keys($dtable->keys())).';
 							var btn = this;
 							$(this).RecordDialog({
Index: Dataface/ActionHandler.php
===================================================================
--- Dataface/ActionHandler.php	(revision 4694)
+++ Dataface/ActionHandler.php	(working copy)
@@ -105,4 +105,4 @@
 	 * @see Dataface_Table::getPermissions() for available parameters.
 	 */
 	public function getPermissions($params);
-}
\ No newline at end of file
+}
Index: Dataface/Utilities.php
===================================================================
--- Dataface/Utilities.php	(revision 4694)
+++ Dataface/Utilities.php	(working copy)
@@ -269,4 +269,4 @@
 	}
 
 }
- 
\ No newline at end of file
+ 
Index: Dataface/Logger.php
===================================================================
--- Dataface/Logger.php	(revision 4694)
+++ Dataface/Logger.php	(working copy)
@@ -31,10 +31,10 @@
 			$messages[] = $i['message'];
 		}
 		if ( $this->format == 'html' ){
-			$messages = array_map('htmlspecialchars', $messages);
+			$messages = array_map('df_escape', $messages);
 		}
 		
 		echo implode($separator, $messages);
 	}
 	
-}
\ No newline at end of file
+}
Index: Dataface/RelatedRecord.php
===================================================================
--- Dataface/RelatedRecord.php	(revision 4694)
+++ Dataface/RelatedRecord.php	(working copy)
@@ -625,12 +625,12 @@
 		if ( $this->secureDisplay and !$this->checkPermission('view') ){
 			$val = $this->display($fieldname);
 			$field = $record->table()->getField($fieldname);
-			if ( !@$field['passthru'] and $record->escapeOutput) $val = nl2br(htmlspecialchars($val));
+			if ( !@$field['passthru'] and $record->escapeOutput) $val = nl2br(df_escape($val));
 			
 			$del =& $record->table()->getDelegate();
 			if ( $del and method_exists($del, 'no_access_link') ){
 				$link = $del->no_access_link($record, array('field'=>$fieldname));
-				return '<a href="'.htmlspecialchars($link).'">'.$val.'</a>';
+				return '<a href="'.df_escape($link).'">'.$val.'</a>';
 			} else {
 				return $val;
 			}
@@ -999,7 +999,7 @@
 			throw new Exception($table->toString(), E_USER_ERROR);
 		}
 		if ( !$table->isBlob($fieldname) ){
-			return htmlspecialchars($this->q($fieldname, $index));
+			return df_escape($this->q($fieldname, $index));
 		} else {
 			return $this->display($fieldname, $index);
 		}
Index: Dataface/SummaryList.php
===================================================================
--- Dataface/SummaryList.php	(revision 4694)
+++ Dataface/SummaryList.php	(working copy)
@@ -27,7 +27,7 @@
 			if ( isset($app->prefs['SummaryList_logo_width']) ) $width = $apps->prefs['SummaryList_logo_width'];
 			else $width = '60';
 			$out .= '<div class="Dataface_SummaryList-record-logo"><a href="'.$record->getURL('-action=view').'" title="Record details">
-				<img src="'.$record->display($logoField).'" width="'.htmlspecialchars($width).'"/>
+				<img src="'.$record->display($logoField).'" width="'.df_escape($width).'"/>
 				</a>
 				</div>';
 		}
@@ -37,12 +37,12 @@
 		foreach ( $this->getSummaryColumns($record) as $fieldname){
 			$field =& $record->_table->getField($fieldname);
 			$out .= '
-				<tr><th class="record-view-label">'.htmlspecialchars($field['widget']['label']).'</th><td class="record-view-value">'.$record->htmlValue($fieldname).'</td></tr>
+				<tr><th class="record-view-label">'.df_escape($field['widget']['label']).'</th><td class="record-view-value">'.$record->htmlValue($fieldname).'</td></tr>
 			';
 		}
 		$out .= '		</tbody></table>';
 		
-		//$out .= '<h5 class="Dataface_SummaryList-record-title"><a href="'.$record->getURL('-action=view').'">'.htmlspecialchars($record->callDelegateFunction('summaryTitle',$record->getTitle())).'</a></h5>';
+		//$out .= '<h5 class="Dataface_SummaryList-record-title"><a href="'.$record->getURL('-action=view').'">'.df_escape($record->callDelegateFunction('summaryTitle',$record->getTitle())).'</a></h5>';
 		//$out .= '<div class="Dataface_SummaryList-record-description">'.$record->callDelegateFunction('summaryDescription',$record->getDescription()).'</div>';
 		//$out .= ( $record->getLastModified() + $record->getCreated() > 0 ? '<div class="Dataface_SummaryLIst-record-status">'.
 		//	( $record->getLastModified() > 0 ? '<span class="Dataface_SummaryList-record-last-modified">
Index: Dataface/ResultReader.php
===================================================================
--- Dataface/ResultReader.php	(revision 4694)
+++ Dataface/ResultReader.php	(working copy)
@@ -199,4 +199,4 @@
 		$this->loadBuffer();
 		return isset($this->buffer[$this->currPos-$this->bufferStartPos]);
 	}
-}
\ No newline at end of file
+}
Index: Dataface/Application.php
===================================================================
--- Dataface/Application.php	(revision 4694)
+++ Dataface/Application.php	(working copy)
@@ -2391,8 +2391,8 @@
 			if ( df_IPv4To6($_SESSION['XATAFACE_REMOTE_ADDR']) != df_IPv4To6($_SERVER['REMOTE_ADDR']) ){
 				$msg = sprintf(
 					"Session address does not match the remote address.  Possible hacking attempt.  Session address was '%s', User address was '%s'",
-					htmlspecialchars(df_IPv4To6($_SESSION['XATAFACE_REMOTE_ADDR'])),
-					htmlspecialchars(df_IPv4To6($_SERVER['REMOTE_ADDR']))
+					df_escape(df_IPv4To6($_SESSION['XATAFACE_REMOTE_ADDR'])),
+					df_escape(df_IPv4To6($_SERVER['REMOTE_ADDR']))
 				);
 				error_log($msg);
 				//die('Your IP address doesn\'t match the session address.  To continue, please clear your cookies or restart your browser and try again.');
Index: Dataface/JavascriptTool.php
===================================================================
--- Dataface/JavascriptTool.php	(revision 4694)
+++ Dataface/JavascriptTool.php	(working copy)
@@ -278,10 +278,10 @@
 		$js = new $clazz;
 		foreach ($this->dependencies as $script=>$path){
 			$js->import($script);
-			$out[] = sprintf('<script src="%s"></script>', htmlspecialchars($js->getURL()));
+			$out[] = sprintf('<script src="%s"></script>', df_escape($js->getURL()));
 			$js->unimport($script);
 		}
-		$out[] = sprintf('<script src="%s"></script>', htmlspecialchars($this->getURL()));
+		$out[] = sprintf('<script src="%s"></script>', df_escape($this->getURL()));
 		return implode("\r\n", $out);
 	}
 	
@@ -936,4 +936,4 @@
 class JSMin_UnterminatedCommentException extends Exception {}
 class JSMin_UnterminatedRegExpException extends Exception {}
 
-//}
\ No newline at end of file
+//}
Index: Dataface/Menu.php
===================================================================
--- Dataface/Menu.php	(revision 4694)
+++ Dataface/Menu.php	(working copy)
@@ -222,7 +222,7 @@
 			if ( $i['level'] > $level ){
 				while ( $level < $i['level'] ){
 					if ( $level>0 ) $out[] = '<li>';
-					$out[] = '<ul '.($level==0?'id="'.htmlspecialchars($id).'"':'').'>';
+					$out[] = '<ul '.($level==0?'id="'.df_escape($id).'"':'').'>';
 					$level++;
 				}
 			}
@@ -239,7 +239,7 @@
 			if ( $i['selected'] ) $class[] = 'menu-selected';
 			if ( $i['breadCrumb'] ) $class[] = 'menu-breadCrumb current';
 			if ( $i['parent'] ) $class[] = 'menu-parent';
-			$out[] = '<li class="'.implode(' ',$class).'"><a href="'.htmlspecialchars($i['url']).'">'.htmlspecialchars($i['label']).'</a></li>';
+			$out[] = '<li class="'.implode(' ',$class).'"><a href="'.df_escape($i['url']).'">'.df_escape($i['label']).'</a></li>';
 			
 		}
 		while ( $level > 0 ){
Index: Dataface/Vocabulary.php
===================================================================
--- Dataface/Vocabulary.php	(revision 4694)
+++ Dataface/Vocabulary.php	(working copy)
@@ -91,4 +91,4 @@
 		unset($this->_options[$key]);
 	}
 }
-		
\ No newline at end of file
+		
Index: Dataface/TreeTable.php
===================================================================
--- Dataface/TreeTable.php	(revision 4694)
+++ Dataface/TreeTable.php	(working copy)
@@ -157,7 +157,7 @@
 			$path = explode('-',$curr_rowid);
 			$level = count($path);
 			$class = ( $rows[$curr_rowid]['hasChildren'] ? 'folder':'doc');
-			echo "<tr id=\"".htmlspecialchars($curr_rowid)."\">";
+			echo "<tr id=\"".df_escape($curr_rowid)."\">";
 			/*
 			$keyString = implode('-',$rows[$curr_rowid]['record']->getValuesAsStrings(
 					array_keys($rows[$curr_rowid]['record']->_table->keys())
@@ -165,7 +165,7 @@
 			);*/
                         $relatedRecord = new Dataface_RelatedRecord($this->record, $this->relationship,$rows[$curr_rowid]['record']->vals() );
                         $keyString = $relatedRecord->getId();
-			echo "<td class=\"\"><input id=\"remove_".htmlspecialchars($keyString)."_checkbox\" type=\"checkbox\" name=\"--remkeys[]\" value=\"".htmlspecialchars($keyString)."\"/></td>";
+			echo "<td class=\"\"><input id=\"remove_".df_escape($keyString)."_checkbox\" type=\"checkbox\" name=\"--remkeys[]\" value=\"".df_escape($keyString)."\"/></td>";
 			echo "
 				<td><div class=\"tier{$level}\"><a href=\"#\" ";
 			if ( $class == 'folder'){
@@ -175,7 +175,7 @@
 			$editURL = $rows[$curr_rowid]['record']->getURL('-action=edit');
 			$deleteURL = $rows[$curr_rowid]['record']->getURL('-action=delete');
 			echo "class=\"$class\"></a></td>
-				<td><a href=\"".htmlspecialchars($url)."\">".htmlspecialchars($rows[$curr_rowid]['record']->getTitle())."</a></td>";
+				<td><a href=\"".df_escape($url)."\">".df_escape($rows[$curr_rowid]['record']->getTitle())."</a></td>";
 
 			foreach ( $columns as $col ){
 				echo "<td>";
@@ -195,7 +195,7 @@
 				} else {
 					if ( $rows[$curr_rowid]['record']->_table->hasField($col) ){
 						
-						echo "<a href=\"".htmlspecialchars($url)."\">".$rows[$curr_rowid]['record']->htmlValue($col)."</a>";
+						echo "<a href=\"".df_escape($url)."\">".$rows[$curr_rowid]['record']->htmlValue($col)."</a>";
 					} else {
 						echo '--';
 					}
@@ -251,7 +251,7 @@
 			define('Dataface_TreeTable_JAVASCRIPT_LOADED',true);
 			echo '<script language="javascript" type="text/javascript" src="'.DATAFACE_URL.'/js/TreeTable.js"></script>';
 		}
-		echo '<form action="'.htmlspecialchars($_SERVER['PHP_SELF']).'" method="GET" onsubmit="return validateTTForm(this);">';
+		echo '<form action="'.df_escape($_SERVER['PHP_SELF']).'" method="GET" onsubmit="return validateTTForm(this);">';
 		echo '<input type="hidden" name="--selected-ids" value=""/>';
                 echo "<table width=\"100%\" id=\"$treetableid\" class=\"treetable\">";
 		
@@ -270,8 +270,8 @@
 			echo "   Perform on selected records:
 			<select name=\"-action\">";
 			foreach (array_keys($actions) as $i){
-				echo "<option value=\"".htmlspecialchars($actions[$i]['name'])."\">"
-                                        .htmlspecialchars($actions[$i]['label']).
+				echo "<option value=\"".df_escape($actions[$i]['name'])."\">"
+                                        .df_escape($actions[$i]['label']).
                                         "</option>
 				";
 			}
Index: Dataface/ResultController.php
===================================================================
--- Dataface/ResultController.php	(revision 4694)
+++ Dataface/ResultController.php	(working copy)
@@ -388,7 +388,7 @@
                 $selected = ' selected';
             else
                 $selected = '';
-            $out[] = '<li class="' . $selected . '"><a href="' . htmlspecialchars($link) . '">' . $pageno . '</a></li>';
+            $out[] = '<li class="' . $selected . '"><a href="' . df_escape($link) . '">' . $pageno . '</a></li>';
         }
         $appurl = $app->url('');
         $appurl = preg_replace('/[&\?]' . preg_quote('-' . $prefix . 'limit=') . '[^&]*/', '', $appurl);
@@ -548,4 +548,4 @@
         return '';
     }
 
-}
\ No newline at end of file
+}
Index: Dataface/ModuleTool.php
===================================================================
--- Dataface/ModuleTool.php	(revision 4694)
+++ Dataface/ModuleTool.php	(working copy)
@@ -145,7 +145,7 @@
 	 * @code
 	 * $baseURL = Dataface_ModuleTool::getInstance()->getModuleURL(__FILE__);
 	 * $app->addHeadContent(
-	 *     '<script src="'.htmlspecialchars($baseURL.'/js/tagger.js').'"></script>'
+	 *     '<script src="'.df_escape($baseURL.'/js/tagger.js').'"></script>'
 	 * );
 	 * @endcode
 	 */
Index: Dataface/RecordReader.php
===================================================================
--- Dataface/RecordReader.php	(revision 4694)
+++ Dataface/RecordReader.php	(working copy)
@@ -183,4 +183,4 @@
 		$this->loadBuffer();
 		return isset($this->buffer[$this->currPos-$this->bufferStartPos]);
 	}
-}
\ No newline at end of file
+}
Index: Dataface/XMLTool/default.php
===================================================================
--- Dataface/XMLTool/default.php	(revision 4694)
+++ Dataface/XMLTool/default.php	(working copy)
@@ -125,4 +125,4 @@
 		
 		return "</record>";
 	}
-}
\ No newline at end of file
+}
Index: Dataface/PreferencesTool/_createPreferencesTable.php
===================================================================
--- Dataface/PreferencesTool/_createPreferencesTable.php	(revision 4694)
+++ Dataface/PreferencesTool/_createPreferencesTable.php	(working copy)
@@ -19,4 +19,4 @@
 			index `record_id` (`record_id`))", df_db());
 	if ( !$res ) throw new Exception(mysql_error(df_db()), E_USER_ERROR);
 
-}
\ No newline at end of file
+}
Index: Dataface/ImportRecord.php
===================================================================
--- Dataface/ImportRecord.php	(revision 4694)
+++ Dataface/ImportRecord.php	(working copy)
@@ -99,4 +99,4 @@
 	function getClassPath(){
 		return $this->classpath;
 	}
-}
\ No newline at end of file
+}
Index: Dataface/Serializer.php
===================================================================
--- Dataface/Serializer.php	(revision 4696)
+++ Dataface/Serializer.php	(working copy)
@@ -246,4 +246,4 @@
 
 
 
-}
\ No newline at end of file
+}
Index: Dataface/Ontology.php
===================================================================
--- Dataface/Ontology.php	(revision 4694)
+++ Dataface/Ontology.php	(working copy)
@@ -160,4 +160,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: Dataface/RelatedList.php
===================================================================
--- Dataface/RelatedList.php	(revision 4694)
+++ Dataface/RelatedList.php	(working copy)
@@ -356,10 +356,10 @@
 
                     $legend = '';
                     if (@$field['column'] and @$field['column']['legend']) {
-                        $legend = '<span class="column-legend">' . htmlspecialchars($field['column']['legend']) . '</span>';
+                        $legend = '<span class="column-legend">' . df_escape($field['column']['legend']) . '</span>';
                     }
                     if (!$this->noLinks) {
-                        echo '<th><a href="' . htmlspecialchars($link) . '">' . htmlspecialchars($field['widget']['label']) . "</a> $legend</th>\n";
+                        echo '<th><a href="' . df_escape($link) . '">' . df_escape($field['widget']['label']) . "</a> $legend</th>\n";
                     } else {
                         echo '<th>' . $field['widget']['label'] . '</th>';
                     }
@@ -424,7 +424,7 @@
                         echo '
 						<td class="' . $rowClass . ' viewableColumn" nowrap>';
                         if (!$this->hideActions) {
-                            echo '<input xf-record-id="' . htmlspecialchars($rrecid) . '" class="rowSelectorCheckbox" id="rowSelectorCheckbox:' . htmlspecialchars($rrecid) . '" type="checkbox">';
+                            echo '<input xf-record-id="' . df_escape($rrecid) . '" class="rowSelectorCheckbox" id="rowSelectorCheckbox:' . df_escape($rrecid) . '" type="checkbox">';
                         }
                         echo '</td>';
                     }
@@ -463,7 +463,7 @@
                             if (isset($renderVal))
                                 $val = $renderVal;
                             else if ($link and !@$field['noLinkFromListView'] and !$this->noLinks and $rrec->checkPermission('link', array('field' => $key)))
-                                $val = "<a href=\"" . htmlspecialchars($link) . "\" title=\"" . htmlspecialchars($title) . "\" data-xf-related-record-id=\"" . htmlspecialchars($srcRecordId) . "\" class=\"xf-related-record-link\">" . $val . "</a>";
+                                $val = "<a href=\"" . df_escape($link) . "\" title=\"" . df_escape($title) . "\" data-xf-related-record-id=\"" . df_escape($srcRecordId) . "\" class=\"xf-related-record-link\">" . $val . "</a>";
                             echo "<td class=\"$cellClass $rowClass $accessClass\">$val</td>\n";
                             unset($srcRecord);
                         }
@@ -488,7 +488,7 @@
                         if (strlen($key) > 1 and $key{0} == '-' and $key{1} == '-') {
                             continue;
                         }
-                        echo '<input type="hidden" name="' . $key . '" value="' . htmlspecialchars($val) . '">';
+                        echo '<input type="hidden" name="' . $key . '" value="' . df_escape($val) . '">';
                     }
                     echo '<input type="hidden" name="--selected-ids" id="--selected-ids">';
                     echo '<input type="hidden" name="-from" id="-from" value="' . $query['-action'] . '">';
Index: Dataface/ConfigTool/setConfigParam.function.php
===================================================================
--- Dataface/ConfigTool/setConfigParam.function.php	(revision 4694)
+++ Dataface/ConfigTool/setConfigParam.function.php	(working copy)
@@ -79,4 +79,4 @@
 		return PEAR::raiseError("Could not write config value: ".mysql_error(df_db()));
 	}
 	return true;
-}
\ No newline at end of file
+}
Index: Dataface/ImportFilter.php
===================================================================
--- Dataface/ImportFilter.php	(revision 4694)
+++ Dataface/ImportFilter.php	(working copy)
@@ -87,4 +87,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: Dataface/ApplicationDelegateClass.php
===================================================================
--- Dataface/ApplicationDelegateClass.php	(revision 4694)
+++ Dataface/ApplicationDelegateClass.php	(working copy)
@@ -734,4 +734,4 @@
 	
 	function valuelist__valuelistname();
 	// @}
-}
\ No newline at end of file
+}
Index: Dataface/GlanceList.php
===================================================================
--- Dataface/GlanceList.php	(revision 4694)
+++ Dataface/GlanceList.php	(working copy)
@@ -47,14 +47,14 @@
 			return $adel->oneLineDescription($record);
 		}
 		$out = '<span class="Dataface_GlanceList-oneLineDescription">
-			<span class="Dataface_GlanceList-oneLineDescription-title"><a href="'.htmlspecialchars($record->getURL('-action=view')).'" title="View this record">'.htmlspecialchars($origRecord->getTitle()).'</a></span> ';
+			<span class="Dataface_GlanceList-oneLineDescription-title"><a href="'.df_escape($record->getURL('-action=view')).'" title="View this record">'.df_escape($origRecord->getTitle()).'</a></span> ';
 		if ( $creator = $record->getCreator()  ){
 			$show = true;
 			if ( isset($app->prefs['hide_posted_by']) and $app->prefs['hide_posted_by'] ) $show = false;
 			if ( isset($record->_table->_atts['__prefs__']['hide_posted_by']) and $record->_table->_atts['__prefs__']['hide_posted_by'] ) $show = false;
 			if ( $show ){
 				$out .=
-				'<span class="Dataface_GlanceList-oneLineDescription-posted-by">Posted by '.htmlspecialchars($creator).'.</span> ';
+				'<span class="Dataface_GlanceList-oneLineDescription-posted-by">Posted by '.df_escape($creator).'.</span> ';
 			}
 		}
 		
@@ -63,7 +63,7 @@
 			if ( isset($app->prefs['hide_updated']) and $app->prefs['hide_updated'] ) $show = false;
 			if ( isset($record->_table->_atts['__prefs__']['hide_updated']) and $record->_table->_atts['__prefs__']['hide_updated'] ) $show = false;
 			if ( $show ){
-				$out .= '<span class="Dataface_GlanceList-oneLineDescription-updated">Updated '.htmlspecialchars(df_offset(date('Y-m-d H:i:s', $modified))).'</span>';
+				$out .= '<span class="Dataface_GlanceList-oneLineDescription-updated">Updated '.df_escape(df_offset(date('Y-m-d H:i:s', $modified))).'</span>';
 			}
 		}
 		$out .= '
Index: Dataface/DelegateClass.php
===================================================================
--- Dataface/DelegateClass.php	(revision 4694)
+++ Dataface/DelegateClass.php	(working copy)
@@ -1947,4 +1947,4 @@
 	// @}
 
 
-}
\ No newline at end of file
+}
Index: Dataface/Record.php
===================================================================
--- Dataface/Record.php	(revision 4694)
+++ Dataface/Record.php	(working copy)
@@ -2694,12 +2694,12 @@
 		}	
 		$val = $this->display($fieldname, $index, $where, $sort);
 		$field = $this->_table->getField($fieldname);
-		if ( !@$field['passthru'] and $this->escapeOutput) $val = nl2br(htmlspecialchars($val));
+		if ( !@$field['passthru'] and $this->escapeOutput) $val = nl2br(df_escape($val));
 		if ( $this->secureDisplay and !Dataface_PermissionsTool::view($this, array('field'=>$fieldname)) ){
 			$del =& $this->_table->getDelegate();
 			if ( $del and method_exists($del, 'no_access_link') ){
 				$link = $del->no_access_link($this, array('field'=>$fieldname));
-				return '<a href="'.htmlspecialchars($link).'">'.$val.'</a>';
+				return '<a href="'.df_escape($link).'">'.$val.'</a>';
 			}
 		}
 		
@@ -4564,7 +4564,16 @@
 		}
 		
 	}
-	 
+	
+        function getGroupRoleMetadata(){
+            $perms = $this->_metaDataValues['__roles__'];
+	    if ( !trim($perms) ){
+	        
+	        return null;
+	    }
+            return json_decode($perms);
+        }
+        
 	function getGroupRoles(){
 	    if ( isset($this->pouch['__roles__']) ){
 	        return $this->pouch['__roles__'];
@@ -4604,14 +4613,14 @@
 	    $roles = array();
 	    
 	    foreach ( $groups as $group ){
-	        if ( isset($perms->groups) and is_array($perms->groups->{$group}) ){
+	        if ( isset($perms->groups) and is_array(@$perms->groups->{$group}) ){
 	            foreach ( $perms->groups->{$group} as $groupRole){
 	                $roles[] = $groupRole;
 	            }
 	        }
 	    }
 	    
-	    if ( isset($perms->users) and is_array($perms->users->{$userName}) ){
+	    if ( isset($perms->users) and is_array(@$perms->users->{$userName}) ){
 	        foreach ( $perms->users->{$userName}  as $userRole ){
 	            $roles[] = $userRole;
 	        }
Index: Dataface/TranslationForm.php
===================================================================
--- Dataface/TranslationForm.php	(revision 4694)
+++ Dataface/TranslationForm.php	(working copy)
@@ -278,4 +278,4 @@
 	
 	
 
-}
\ No newline at end of file
+}
Index: Dataface/CompositeForm.php
===================================================================
--- Dataface/CompositeForm.php	(revision 4694)
+++ Dataface/CompositeForm.php	(working copy)
@@ -184,4 +184,4 @@
 		}
 		return $vals;
 	}
-}
\ No newline at end of file
+}
Index: Dataface/CSSTool.php
===================================================================
--- Dataface/CSSTool.php	(revision 4694)
+++ Dataface/CSSTool.php	(working copy)
@@ -1071,4 +1071,4 @@
 			}
 		}
 	}
-?>
\ No newline at end of file
+?>
Index: actions/get_page_to_translate.php
===================================================================
--- actions/get_page_to_translate.php	(revision 4694)
+++ actions/get_page_to_translate.php	(working copy)
@@ -28,4 +28,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/search_index.php
===================================================================
--- actions/search_index.php	(revision 4694)
+++ actions/search_index.php	(working copy)
@@ -22,4 +22,4 @@
 		df_display(array('results'=>&$results, 'metadata'=>&$res['metadata'], 'search_term'=>$q['-search']), 'Dataface_Search_Results.html');
 	}
 
-}
\ No newline at end of file
+}
Index: actions/translate.php
===================================================================
--- actions/translate.php	(revision 4694)
+++ actions/translate.php	(working copy)
@@ -154,4 +154,4 @@
 		
 	}
 
-}
\ No newline at end of file
+}
Index: actions/manage_build_index.php
===================================================================
--- actions/manage_build_index.php	(revision 4694)
+++ actions/manage_build_index.php	(working copy)
@@ -55,4 +55,4 @@
 		df_display(array('tables'=>$tables), 'manage_build_index.html');
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/related_records_checkboxes.php
===================================================================
--- actions/related_records_checkboxes.php	(revision 4694)
+++ actions/related_records_checkboxes.php	(working copy)
@@ -39,4 +39,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/ajax_save.php
===================================================================
--- actions/ajax_save.php	(revision 4694)
+++ actions/ajax_save.php	(working copy)
@@ -85,4 +85,4 @@
 		flush();
 	}
 
-}
\ No newline at end of file
+}
Index: actions/rest_insert.php
===================================================================
--- actions/rest_insert.php	(revision 4694)
+++ actions/rest_insert.php	(working copy)
@@ -138,4 +138,4 @@
 		header('Content-type: application/json; charset="'.Dataface_Application::getInstance()->_conf['oe'].'"');
 		echo json_encode($params);
 	}
-}
\ No newline at end of file
+}
Index: actions/single_record_search.php
===================================================================
--- actions/single_record_search.php	(revision 4694)
+++ actions/single_record_search.php	(working copy)
@@ -103,4 +103,4 @@
 		else return ( ($amod < $bmod) ? 1:-1);
 	}
 
-}
\ No newline at end of file
+}
Index: actions/change_password.php
===================================================================
--- actions/change_password.php	(revision 4694)
+++ actions/change_password.php	(working copy)
@@ -68,4 +68,4 @@
 		header('Content-type: application/json; charset="'.Dataface_Application::getInstance()->_conf['oe'].'"');
 		echo json_encode($params);
 	}
-}
\ No newline at end of file
+}
Index: actions/delete_selected.php
===================================================================
--- actions/delete_selected.php	(revision 4694)
+++ actions/delete_selected.php	(working copy)
@@ -36,4 +36,4 @@
 		$url .= '&--msg='.urlencode($updated.' records were deleted.');
 		$app->redirect($url);
 	}
-}
\ No newline at end of file
+}
Index: actions/RecordBrowser_lookup_single.php
===================================================================
--- actions/RecordBrowser_lookup_single.php	(revision 4694)
+++ actions/RecordBrowser_lookup_single.php	(working copy)
@@ -111,4 +111,4 @@
 		}
 		exit;
 	}
-}
\ No newline at end of file
+}
Index: actions/test_Bootstrap.php
===================================================================
--- actions/test_Bootstrap.php	(revision 4694)
+++ actions/test_Bootstrap.php	(working copy)
@@ -4,4 +4,4 @@
 		Dataface_JavascriptTool::getInstance()->import('xataface/bootstrap.js');
 		df_display(array(), 'xataface/tests/test_Bootstrap.html');
 	}
-}
\ No newline at end of file
+}
Index: actions/find.php
===================================================================
--- actions/find.php	(revision 4694)
+++ actions/find.php	(working copy)
@@ -75,4 +75,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/invalidate_translations.php
===================================================================
--- actions/invalidate_translations.php	(revision 4694)
+++ actions/invalidate_translations.php	(working copy)
@@ -38,4 +38,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/forgot_password.php
===================================================================
--- actions/forgot_password.php	(revision 4701)
+++ actions/forgot_password.php	(working copy)
@@ -422,4 +422,4 @@
 		if ( !$res ) throw new Exception(mysql_error(df_db()));
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/whoami.php
===================================================================
--- actions/whoami.php	(revision 4694)
+++ actions/whoami.php	(working copy)
@@ -25,4 +25,4 @@
 			exit;
 		}
 	}
-}
\ No newline at end of file
+}
Index: actions/new.php
===================================================================
--- actions/new.php	(revision 4694)
+++ actions/new.php	(working copy)
@@ -225,4 +225,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/remove_related_record.php
===================================================================
--- actions/remove_related_record.php	(revision 4694)
+++ actions/remove_related_record.php	(working copy)
@@ -110,4 +110,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/ajax_set_preference.php
===================================================================
--- actions/ajax_set_preference.php	(revision 4694)
+++ actions/ajax_set_preference.php	(working copy)
@@ -40,4 +40,4 @@
 		exit;
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/activate.php
===================================================================
--- actions/activate.php	(revision 4694)
+++ actions/activate.php	(working copy)
@@ -143,4 +143,4 @@
 		
 	}
 }
-?>
\ No newline at end of file
+?>
Index: actions/ajax_form.php
===================================================================
--- actions/ajax_form.php	(revision 4694)
+++ actions/ajax_form.php	(working copy)
@@ -203,4 +203,4 @@
 		
 	}
 }
-?>
\ No newline at end of file
+?>
Index: actions/test_MasterDetailView.php
===================================================================
--- actions/test_MasterDetailView.php	(revision 4694)
+++ actions/test_MasterDetailView.php	(working copy)
@@ -7,4 +7,4 @@
 		$jt->import('xataface/view/tests/test_MasterDetailView.js');
 		df_display(array(), 'xataface/tests/test_MasterDetailView.html');
 	}
-}
\ No newline at end of file
+}
Index: actions/calendar.php
===================================================================
--- actions/calendar.php	(revision 4694)
+++ actions/calendar.php	(working copy)
@@ -65,4 +65,4 @@
 		df_display(array('event_data'=>$event_data,'nav'=>&$nav, 'currentTime'=>$startTime, 'filters'=>$rs->getResultFilters()), 'Dataface_Calendar.html');
 	}
 
-}
\ No newline at end of file
+}
Index: actions/clear_cache.php
===================================================================
--- actions/clear_cache.php	(revision 4694)
+++ actions/clear_cache.php	(working copy)
@@ -40,4 +40,4 @@
 		}
 	
 	}
-}
\ No newline at end of file
+}
Index: actions/test_View.php
===================================================================
--- actions/test_View.php	(revision 4694)
+++ actions/test_View.php	(working copy)
@@ -7,4 +7,4 @@
 		$jt->import('xataface/view/tests/test_View.js');
 		df_display(array(), 'xataface/tests/test_View.html');
 	}
-}
\ No newline at end of file
+}
Index: actions/custom.php
===================================================================
--- actions/custom.php	(revision 4694)
+++ actions/custom.php	(working copy)
@@ -46,4 +46,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/export_json.php
===================================================================
--- actions/export_json.php	(revision 4694)
+++ actions/export_json.php	(working copy)
@@ -246,4 +246,4 @@
 		echo $enc_out;
 		exit;
 	}
-}
\ No newline at end of file
+}
Index: actions/ajax_get_permissions.php
===================================================================
--- actions/ajax_get_permissions.php	(revision 4694)
+++ actions/ajax_get_permissions.php	(working copy)
@@ -30,4 +30,4 @@
 		echo $out;
 		flush();
 	}
-}
\ No newline at end of file
+}
Index: actions/disabled/xml_info.php
===================================================================
--- actions/disabled/xml_info.php	(revision 4694)
+++ actions/disabled/xml_info.php	(working copy)
@@ -11,4 +11,4 @@
 		exit;
 	}
 }
-?>
\ No newline at end of file
+?>
Index: actions/disabled/xml_list.php
===================================================================
--- actions/disabled/xml_list.php	(revision 4694)
+++ actions/disabled/xml_list.php	(working copy)
@@ -22,4 +22,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/disabled/load_grid.php
===================================================================
--- actions/disabled/load_grid.php	(revision 4694)
+++ actions/disabled/load_grid.php	(working copy)
@@ -14,4 +14,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/disabled/update_grid.php
===================================================================
--- actions/disabled/update_grid.php	(revision 4694)
+++ actions/disabled/update_grid.php	(working copy)
@@ -88,4 +88,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/register.php
===================================================================
--- actions/register.php	(revision 4694)
+++ actions/register.php	(working copy)
@@ -480,4 +480,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/existing_related_record.php
===================================================================
--- actions/existing_related_record.php	(revision 4694)
+++ actions/existing_related_record.php	(working copy)
@@ -133,4 +133,4 @@
 
 
 }
-?>
\ No newline at end of file
+?>
Index: actions/delete_file.php
===================================================================
--- actions/delete_file.php	(revision 4694)
+++ actions/delete_file.php	(working copy)
@@ -119,4 +119,4 @@
 		}
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/ajax_valuelist_append.php
===================================================================
--- actions/ajax_valuelist_append.php	(revision 4694)
+++ actions/ajax_valuelist_append.php	(working copy)
@@ -48,4 +48,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/clear_views.php
===================================================================
--- actions/clear_views.php	(revision 4694)
+++ actions/clear_views.php	(working copy)
@@ -18,4 +18,4 @@
 		echo "done";
 	}
 
-}
\ No newline at end of file
+}
Index: actions/load_script.php
===================================================================
--- actions/load_script.php	(revision 4694)
+++ actions/load_script.php	(working copy)
@@ -79,4 +79,4 @@
 		return $path;
 	
 	}
-}
\ No newline at end of file
+}
Index: actions/ajax_insert.php
===================================================================
--- actions/ajax_insert.php	(revision 4694)
+++ actions/ajax_insert.php	(working copy)
@@ -79,4 +79,4 @@
 		flush();
 	}
 
-}
\ No newline at end of file
+}
Index: actions/RecordBrowser_data.php
===================================================================
--- actions/RecordBrowser_data.php	(revision 4694)
+++ actions/RecordBrowser_data.php	(working copy)
@@ -110,11 +110,11 @@
 					break;
 			
 			}
-			echo '<option value="'.htmlspecialchars($value).'">'.htmlspecialchars($text).'</option>'."\n";
+			echo '<option value="'.df_escape($value).'">'.df_escape($text).'</option>'."\n";
 			
 		}
 		exit;
 		
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/ajax_nav_tree_node.php
===================================================================
--- actions/ajax_nav_tree_node.php	(revision 4694)
+++ actions/ajax_nav_tree_node.php	(working copy)
@@ -99,4 +99,4 @@
 		exit;
 		
 	}	
-}
\ No newline at end of file
+}
Index: actions/set_translation_status.php
===================================================================
--- actions/set_translation_status.php	(revision 4694)
+++ actions/set_translation_status.php	(working copy)
@@ -105,4 +105,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/test_TableView.php
===================================================================
--- actions/test_TableView.php	(revision 4694)
+++ actions/test_TableView.php	(working copy)
@@ -7,4 +7,4 @@
 		$jt->import('xataface/view/tests/test_TableView.js');
 		df_display(array(), 'xataface/tests/test_TableView.html');
 	}
-}
\ No newline at end of file
+}
Index: actions/submit_translation.php
===================================================================
--- actions/submit_translation.php	(revision 4694)
+++ actions/submit_translation.php	(working copy)
@@ -79,4 +79,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/reorder_related_records.php
===================================================================
--- actions/reorder_related_records.php	(revision 4694)
+++ actions/reorder_related_records.php	(working copy)
@@ -92,4 +92,4 @@
 	
 	}
 }
-?>
\ No newline at end of file
+?>
Index: actions/default.php
===================================================================
--- actions/default.php	(revision 4694)
+++ actions/default.php	(working copy)
@@ -55,4 +55,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/edit.php
===================================================================
--- actions/edit.php	(revision 4694)
+++ actions/edit.php	(working copy)
@@ -164,7 +164,7 @@
 						$rvals = $currentRecord->strvals();
 						$rvals['__title__'] = $currentRecord->getTitle();
 						$rvals['__id__'] = $currentRecord->getId();
-						echo htmlspecialchars(json_encode(array('response_code'=>200, 'record_data'=> $rvals, 'response_message'=>df_translate('Record Successfully Saved', 'Record Successfully Saved'))));
+						echo df_escape(json_encode(array('response_code'=>200, 'record_data'=> $rvals, 'response_message'=>df_translate('Record Successfully Saved', 'Record Successfully Saved'))));
 						return;
 					}
 					
@@ -240,7 +240,7 @@
 				$app->addMessage(
 					df_translate(
 						'Return to last modified record',
-						'No records matched your request.  Click <a href="'.$lastModifiedURL.'">here</a> to return to <em>'.htmlspecialchars($lastModifiedTitle).'</em>.',
+						'No records matched your request.  Click <a href="'.$lastModifiedURL.'">here</a> to return to <em>'.df_escape($lastModifiedTitle).'</em>.',
 						array('lastModifiedURL'=>$lastModifiedURL,
 							 'lastModifiedTitle'=>$lastModifiedTitle
 							)
@@ -270,4 +270,4 @@
 	}
 	
 }
-?>
\ No newline at end of file
+?>
Index: actions/new_related_record.php
===================================================================
--- actions/new_related_record.php	(revision 4694)
+++ actions/new_related_record.php	(working copy)
@@ -142,4 +142,4 @@
 
 
 
-?>
\ No newline at end of file
+?>
Index: actions/commit.php
===================================================================
--- actions/commit.php	(revision 4694)
+++ actions/commit.php	(working copy)
@@ -125,4 +125,4 @@
 		
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/manage_output_cache.php
===================================================================
--- actions/manage_output_cache.php	(revision 4694)
+++ actions/manage_output_cache.php	(working copy)
@@ -31,4 +31,4 @@
 		
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/export_csv.php
===================================================================
--- actions/export_csv.php	(revision 4694)
+++ actions/export_csv.php	(working copy)
@@ -154,4 +154,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/related_records_list.php
===================================================================
--- actions/related_records_list.php	(revision 4694)
+++ actions/related_records_list.php	(working copy)
@@ -32,4 +32,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/view_history_record_details.php
===================================================================
--- actions/view_history_record_details.php	(revision 4694)
+++ actions/view_history_record_details.php	(working copy)
@@ -90,4 +90,4 @@
 	}
 
 }
-?>
\ No newline at end of file
+?>
Index: actions/rest_delete.php
===================================================================
--- actions/rest_delete.php	(revision 4694)
+++ actions/rest_delete.php	(working copy)
@@ -83,4 +83,4 @@
 		header('Content-type: application/json; charset="'.Dataface_Application::getInstance()->_conf['oe'].'"');
 		echo json_encode($params);
 	}
-}
\ No newline at end of file
+}
Index: actions/manage_migrate.php
===================================================================
--- actions/manage_migrate.php	(revision 4694)
+++ actions/manage_migrate.php	(working copy)
@@ -49,4 +49,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: actions/rest_form.php
===================================================================
--- actions/rest_form.php	(revision 4694)
+++ actions/rest_form.php	(working copy)
@@ -144,4 +144,4 @@
 		header('Content-type: application/json; charset="'.Dataface_Application::getInstance()->_conf['oe'].'"');
 		echo json_encode($params);
 	}
-}
\ No newline at end of file
+}
Index: actions/ajax_sort_sections.php
===================================================================
--- actions/ajax_sort_sections.php	(revision 4694)
+++ actions/ajax_sort_sections.php	(working copy)
@@ -83,4 +83,4 @@
 		
 		echo "Sections sorted";*/
 	}
-}
\ No newline at end of file
+}
Index: actions/history.php
===================================================================
--- actions/history.php	(revision 4694)
+++ actions/history.php	(working copy)
@@ -36,4 +36,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/delete.php
===================================================================
--- actions/delete.php	(revision 4694)
+++ actions/delete.php	(working copy)
@@ -86,4 +86,4 @@
 		df_display($context, $template, true);
 	
 	}
-}
\ No newline at end of file
+}
Index: actions/history_restore_record.php
===================================================================
--- actions/history_restore_record.php	(revision 4694)
+++ actions/history_restore_record.php	(working copy)
@@ -51,4 +51,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/feed.php
===================================================================
--- actions/feed.php	(revision 4694)
+++ actions/feed.php	(working copy)
@@ -59,4 +59,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/my_profile.php
===================================================================
--- actions/my_profile.php	(revision 4694)
+++ actions/my_profile.php	(working copy)
@@ -13,4 +13,4 @@
 			$app->redirect($app->url('-action=login_prompt').'&--msg='.urlencode('Sorry, this action is only available to logged in users'));
 		}
 	}
-}
\ No newline at end of file
+}
Index: actions/copy_replace.php
===================================================================
--- actions/copy_replace.php	(revision 4694)
+++ actions/copy_replace.php	(working copy)
@@ -412,4 +412,4 @@
 
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/install.php
===================================================================
--- actions/install.php	(revision 4694)
+++ actions/install.php	(working copy)
@@ -97,4 +97,4 @@
 
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/ajax_related_find_form.php
===================================================================
--- actions/ajax_related_find_form.php	(revision 4694)
+++ actions/ajax_related_find_form.php	(working copy)
@@ -7,4 +7,4 @@
 
 	}
 	
-}
\ No newline at end of file
+}
Index: actions/import.php
===================================================================
--- actions/import.php	(revision 4694)
+++ actions/import.php	(working copy)
@@ -94,4 +94,4 @@
 }
 
 
-?>
\ No newline at end of file
+?>
Index: actions/rest_load.php
===================================================================
--- actions/rest_load.php	(revision 4694)
+++ actions/rest_load.php	(working copy)
@@ -6,4 +6,4 @@
 		
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/test_DocumentTest.php
===================================================================
--- actions/test_DocumentTest.php	(revision 4694)
+++ actions/test_DocumentTest.php	(working copy)
@@ -66,4 +66,4 @@
 		}
 		
 	}
-}
\ No newline at end of file
+}
Index: actions/getBlob.php
===================================================================
--- actions/getBlob.php	(revision 4694)
+++ actions/getBlob.php	(working copy)
@@ -10,4 +10,4 @@
 	}
 }
 
-?>
\ No newline at end of file
+?>
Index: actions/ajax_view_record_details.php
===================================================================
--- actions/ajax_view_record_details.php	(revision 4694)
+++ actions/ajax_view_record_details.php	(working copy)
@@ -68,4 +68,4 @@
 	}
 
 }
-?>
\ No newline at end of file
+?>
Index: actions/ajax_get_event_details.php
===================================================================
--- actions/ajax_get_event_details.php	(revision 4694)
+++ actions/ajax_get_event_details.php	(working copy)
@@ -31,7 +31,7 @@
 				$class = '';
 			}
 			$dl[] = array('fielddef'=>&$field, 'tdid'=> 'td-'.rand(), 'value'=>$val, 'tdclass'=>$class);
-			//$out .= '<tr><th>'.htmlspecialchars($field['widget']['label']).'</th><td id="td-'.rand().'" class="'.$class.'">'.$val.'</td></tr>';
+			//$out .= '<tr><th>'.df_escape($field['widget']['label']).'</th><td id="td-'.rand().'" class="'.$class.'">'.$val.'</td></tr>';
 			unset($field);
 		}
 		//$out .= '</tbody></table>';
@@ -57,4 +57,4 @@
 		
 	}
 	
-}
\ No newline at end of file
+}
Index: dataface-public-api.php
===================================================================
--- dataface-public-api.php	(revision 4694)
+++ dataface-public-api.php	(working copy)
@@ -1,2 +1,2 @@
 <?php
-include dirname(__FILE__).DIRECTORY_SEPARATOR.'public-api.php';
\ No newline at end of file
+include dirname(__FILE__).DIRECTORY_SEPARATOR.'public-api.php';
Index: install/FTPExtractor.class.php
===================================================================
--- install/FTPExtractor.class.php	(revision 4694)
+++ install/FTPExtractor.class.php	(working copy)
@@ -87,4 +87,4 @@
 		return array('log'=>$log, 'result'=>$result);
 	}
 	
-}
\ No newline at end of file
+}
Index: install/archive2app-results.inc.php
===================================================================
--- install/archive2app-results.inc.php	(revision 4694)
+++ install/archive2app-results.inc.php	(working copy)
@@ -24,4 +24,4 @@
 		<p><a href="installer.php">Return to main menu</a></p>
 		
 		
-<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
\ No newline at end of file
+<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
Index: install/archive2app.inc.php
===================================================================
--- install/archive2app.inc.php	(revision 4694)
+++ install/archive2app.inc.php	(working copy)
@@ -113,4 +113,4 @@
 </form>
 
 
-<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
\ No newline at end of file
+<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
Index: install/install_footer.inc.php
===================================================================
--- install/install_footer.inc.php	(revision 4694)
+++ install/install_footer.inc.php	(working copy)
@@ -1,4 +1,4 @@
 
 </div><!-- id=main-section-->
 </body>
-</html>
\ No newline at end of file
+</html>
Index: install/ftp.class.php
===================================================================
--- install/ftp.class.php	(revision 4694)
+++ install/ftp.class.php	(working copy)
@@ -556,4 +556,4 @@
 		}
 
 	}
-?>
\ No newline at end of file
+?>
Index: install/db2app.inc.php
===================================================================
--- install/db2app.inc.php	(revision 4694)
+++ install/db2app.inc.php	(working copy)
@@ -89,4 +89,4 @@
 
 </form>
 
-<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
\ No newline at end of file
+<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
Index: install/ftp.api.php
===================================================================
--- install/ftp.api.php	(revision 4694)
+++ install/ftp.api.php	(working copy)
@@ -110,4 +110,4 @@
 			return $ftp->systype();
 		}
 	}
-?>
\ No newline at end of file
+?>
Index: install/mainMenu.inc.php
===================================================================
--- install/mainMenu.inc.php	(revision 4694)
+++ install/mainMenu.inc.php	(working copy)
@@ -24,4 +24,4 @@
 			</li>
 			-->
 		</ol>
-<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
\ No newline at end of file
+<?php include 'install'.DIRECTORY_SEPARATOR.'install_footer.inc.php';?>
Index: install/install_form.js.php
===================================================================
--- install/install_form.js.php	(revision 4694)
+++ install/install_form.js.php	(working copy)
@@ -62,4 +62,4 @@
 
 	
 	
-	
\ No newline at end of file
+	
Index: install/install_header.inc.php
===================================================================
--- install/install_header.inc.php	(revision 4694)
+++ install/install_header.inc.php	(working copy)
@@ -13,4 +13,4 @@
 
 </div>
 
-<div id="main-section">
\ No newline at end of file
+<div id="main-section">
