var XMP=function(){"use strict";function r(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(){function e(r){!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=null,r instanceof ArrayBuffer?this.buffer=r:r instanceof Uint8Array?this.buffer=r.buffer:("string"==typeof r||r instanceof String)&&this.fromDataUri(r)}var n,t,f;return n=e,f=[{key:"dataUriToBuffer",value:function(r){for(var e=atob(r.split(",")[1]),n=e.length,t=new ArrayBuffer(n),f=new Uint8Array(t),i=0;i<n;i++)f[i]=e.charCodeAt(i);return t}},{key:"find",value:function(r){var n;r instanceof ArrayBuffer?n=r:r instanceof Uint8Array?this.buffer=r.buffer:("string"==typeof r||r instanceof String)&&(n=e.dataUriToBuffer(r));var t=new DataView(n);if(65496!==t.getUint16(0,!1))return console.warn("not valid JPEG"),null;for(var f="<x:xmpmeta".length,i=n.byteLength-f,a="x:xmpmeta>".length,o=n.byteLength-a,u=2,c=u+f,s=!1;u<i;){if("<x:xmpmeta"==e.stringFromBuffer(t,u,f)){s=!0;break}u++}if(!s)return console.warn("XMP not found"),null;for(;c<o&&"x:xmpmeta>"!=e.stringFromBuffer(t,c,a);)c++;return c+=a,e.stringFromBuffer(t,u,c-u)}},{key:"stringFromBuffer",value:function(r,e,n){for(var t="",f=e;f<e+n;f++)t+=String.fromCharCode(r.getUint8(f));return t}},{key:"parse",value:function(r){if(!r)return null;var e={};return["title","description","rights","creator","subject"].forEach((function(n){var t=new RegExp("<dc:".concat(n,">(.*?)</dc:").concat(n,">"),"smig").exec(r);if(t&&0!==t.length){var f=t[1].trim();if(0===f.toLowerCase().indexOf("<rdf:bag>")){for(var i=new RegExp("<rdf:li>(.*?)</rdf:li>","smig"),a=i.exec(f),o=[];a;)o.push(a[1]),a=i.exec(f);e[n]=o}else e[n]=f.replace(/<[^>]*>?/gm,"").trim()}})),e}}],(t=[{key:"fromDataUri",value:function(r){this.buffer=e.dataUriToBuffer(r)}},{key:"find",value:function(){return e.find(this.buffer)}},{key:"parse",value:function(){var r=this.find();return e.parse(r)}}])&&r(n.prototype,t),f&&r(n,f),e}()}();